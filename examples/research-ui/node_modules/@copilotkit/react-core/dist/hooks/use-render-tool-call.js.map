{"version":3,"sources":["../../src/hooks/use-render-tool-call.ts"],"sourcesContent":["import {\n  ActionRenderProps,\n  ActionRenderPropsNoArgs,\n  ActionRenderPropsWait,\n  FrontendAction,\n} from \"../types\";\nimport { Parameter, getZodParameters } from \"@copilotkit/shared\";\nimport React, { useEffect, useRef } from \"react\";\nimport { defineToolCallRenderer, useCopilotKit } from \"@copilotkitnext/react\";\nimport { parseJson } from \"@copilotkit/shared\";\n\ntype ToolCallRendererDefinition = Parameters<typeof defineToolCallRenderer>[0];\n\nexport type UseRenderToolCallArgs<T extends Parameter[] | [] = []> = Pick<\n  FrontendAction<T>,\n  \"name\" | \"description\" | \"parameters\"\n> & {\n  available?: \"disabled\" | \"enabled\";\n  render: T extends []\n    ? (props: ActionRenderPropsNoArgs<T>) => React.ReactElement\n    : (props: ActionRenderProps<T>) => React.ReactElement;\n};\n\nexport function useRenderToolCall<const T extends Parameter[] | [] = []>(\n  tool: UseRenderToolCallArgs<T>,\n  dependencies?: any[],\n) {\n  const { copilotkit } = useCopilotKit();\n\n  // Track whether we've already added this renderer to avoid duplicates\n  const hasAddedRef = useRef(false);\n\n  useEffect(() => {\n    const { name, parameters, render } = tool;\n    const zodParameters = getZodParameters(parameters);\n\n    const renderToolCall =\n      name === \"*\"\n        ? defineToolCallRenderer({\n            name: \"*\",\n            render: ((args) => {\n              return render({\n                ...args,\n                result: args.result ? parseJson(args.result, args.result) : args.result,\n              });\n            }) as ToolCallRendererDefinition[\"render\"],\n          })\n        : defineToolCallRenderer({\n            name,\n            args: zodParameters,\n            render: ((args) => {\n              return render({\n                ...args,\n                result: args.result ? parseJson(args.result, args.result) : args.result,\n              });\n            }) as ToolCallRendererDefinition[\"render\"],\n          });\n\n    // Remove any existing renderer with the same name\n    const existingIndex = copilotkit.renderToolCalls.findIndex((r) => r.name === name);\n    if (existingIndex !== -1) {\n      copilotkit.renderToolCalls.splice(existingIndex, 1);\n    }\n\n    // Add the new renderer\n    copilotkit.renderToolCalls.push(renderToolCall);\n    hasAddedRef.current = true;\n\n    // Cleanup: remove this renderer when the component unmounts or tool changes\n    return () => {\n      if (hasAddedRef.current) {\n        const index = copilotkit.renderToolCalls.findIndex((r) => r.name === name);\n        if (index !== -1) {\n          copilotkit.renderToolCalls.splice(index, 1);\n        }\n        hasAddedRef.current = false;\n      }\n    };\n  }, [tool, ...(dependencies ?? [])]);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA,oBAA4C;AAC5C,mBAAyC;AACzC,IAAAA,gBAAsD;AACtD,IAAAC,iBAA0B;AAcnB,SAAS,kBACd,MACA,cACA;AACA,QAAM,EAAE,WAAW,QAAI,6BAAc;AAGrC,QAAM,kBAAc,qBAAO,KAAK;AAEhC,8BAAU,MAAM;AACd,UAAM,EAAE,MAAM,YAAY,OAAO,IAAI;AACrC,UAAM,oBAAgB,gCAAiB,UAAU;AAEjD,UAAM,iBACJ,SAAS,UACL,sCAAuB;AAAA,MACrB,MAAM;AAAA,MACN,QAAS,CAAC,SAAS;AACjB,eAAO,OAAO,iCACT,OADS;AAAA,UAEZ,QAAQ,KAAK,aAAS,0BAAU,KAAK,QAAQ,KAAK,MAAM,IAAI,KAAK;AAAA,QACnE,EAAC;AAAA,MACH;AAAA,IACF,CAAC,QACD,sCAAuB;AAAA,MACrB;AAAA,MACA,MAAM;AAAA,MACN,QAAS,CAAC,SAAS;AACjB,eAAO,OAAO,iCACT,OADS;AAAA,UAEZ,QAAQ,KAAK,aAAS,0BAAU,KAAK,QAAQ,KAAK,MAAM,IAAI,KAAK;AAAA,QACnE,EAAC;AAAA,MACH;AAAA,IACF,CAAC;AAGP,UAAM,gBAAgB,WAAW,gBAAgB,UAAU,CAAC,MAAM,EAAE,SAAS,IAAI;AACjF,QAAI,kBAAkB,IAAI;AACxB,iBAAW,gBAAgB,OAAO,eAAe,CAAC;AAAA,IACpD;AAGA,eAAW,gBAAgB,KAAK,cAAc;AAC9C,gBAAY,UAAU;AAGtB,WAAO,MAAM;AACX,UAAI,YAAY,SAAS;AACvB,cAAM,QAAQ,WAAW,gBAAgB,UAAU,CAAC,MAAM,EAAE,SAAS,IAAI;AACzE,YAAI,UAAU,IAAI;AAChB,qBAAW,gBAAgB,OAAO,OAAO,CAAC;AAAA,QAC5C;AACA,oBAAY,UAAU;AAAA,MACxB;AAAA,IACF;AAAA,EACF,GAAG,CAAC,MAAM,GAAI,sCAAgB,CAAC,CAAE,CAAC;AACpC;","names":["import_react","import_shared"]}