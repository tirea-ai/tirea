{"version":3,"sources":["../../src/hooks/use-human-in-the-loop.ts"],"sourcesContent":["import { ActionRenderProps, ActionRenderPropsWait, FrontendAction } from \"../types\";\nimport {\n  CopilotKitError,\n  CopilotKitErrorCode,\n  MappedParameterTypes,\n  Parameter,\n  getZodParameters,\n  parseJson,\n} from \"@copilotkit/shared\";\nimport { useHumanInTheLoop as useHumanInTheLoopVNext } from \"@copilotkitnext/react\";\nimport { ToolCallStatus } from \"@copilotkitnext/core\";\nimport React, { ComponentType, FunctionComponent, useEffect, useRef } from \"react\";\n\ntype HumanInTheLoopOptions = Parameters<typeof useHumanInTheLoopVNext>[0];\ntype HumanInTheLoopRender = HumanInTheLoopOptions[\"render\"];\ntype HumanInTheLoopRenderArgs = HumanInTheLoopRender extends (props: infer P) => any ? P : never;\n\nexport type UseHumanInTheLoopArgs<T extends Parameter[] | [] = []> = {\n  available?: \"disabled\" | \"enabled\";\n  render: FrontendAction<T>[\"renderAndWaitForResponse\"];\n  followUp?: FrontendAction<T>[\"followUp\"];\n} & Pick<FrontendAction<T>, \"name\" | \"description\" | \"parameters\">;\n\ntype HitlRendererArgs =\n  | {\n      name: string;\n      description: string;\n      args: Partial<Record<string, unknown>>;\n      status: ToolCallStatus.InProgress;\n      result: undefined;\n      respond: undefined;\n    }\n  | {\n      name: string;\n      description: string;\n      args: Record<string, unknown>;\n      status: ToolCallStatus.Executing;\n      result: undefined;\n      respond: (result: unknown) => Promise<void>;\n    }\n  | {\n      name: string;\n      description: string;\n      args: Record<string, unknown>;\n      status: ToolCallStatus.Complete;\n      result: string;\n      respond: undefined;\n    };\ntype HitlRenderer = FunctionComponent<HitlRendererArgs>;\n\nexport function useHumanInTheLoop<const T extends Parameter[] | [] = []>(\n  tool: UseHumanInTheLoopArgs<T>,\n  dependencies?: any[],\n) {\n  const { render, ...toolRest } = tool;\n  const { name, description, parameters, followUp } = toolRest;\n  const zodParameters = getZodParameters(parameters);\n  const renderRef = useRef<HitlRenderer | null>(null);\n\n  useEffect(() => {\n    renderRef.current = (args: HitlRendererArgs): React.ReactElement | null => {\n      if (typeof render === \"string\") {\n        return React.createElement(React.Fragment, null, render);\n      }\n\n      if (!render) {\n        return null;\n      }\n\n      const renderProps: ActionRenderPropsWait<T> = (() => {\n        const mappedArgs = args.args as unknown as MappedParameterTypes<T>;\n\n        switch (args.status) {\n          case ToolCallStatus.InProgress:\n            return {\n              args: mappedArgs,\n              respond: args.respond,\n              status: args.status,\n              handler: undefined,\n            };\n          case ToolCallStatus.Executing:\n            return {\n              args: mappedArgs,\n              respond: args.respond,\n              status: args.status,\n              handler: () => {},\n            };\n          case ToolCallStatus.Complete:\n            return {\n              args: mappedArgs,\n              respond: args.respond,\n              status: args.status,\n              result: args.result ? parseJson(args.result, args.result) : args.result,\n              handler: undefined,\n            };\n          default:\n            throw new CopilotKitError({\n              code: CopilotKitErrorCode.UNKNOWN,\n              message: `Invalid tool call status: ${(args as unknown as { status: string }).status}`,\n            });\n        }\n      })();\n\n      const rendered = render(renderProps);\n\n      if (typeof rendered === \"string\") {\n        return React.createElement(React.Fragment, null, rendered);\n      }\n\n      return rendered ?? null;\n    };\n  }, [render, ...(dependencies ?? [])]);\n\n  useHumanInTheLoopVNext({\n    name,\n    description,\n    followUp,\n    parameters: zodParameters,\n    render: ((args: HumanInTheLoopRenderArgs) =>\n      renderRef.current?.(args as HitlRendererArgs) ?? null) as HumanInTheLoopOptions[\"render\"],\n  });\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,oBAOO;AACP,mBAA4D;AAC5D,kBAA+B;AAC/B,IAAAA,gBAA2E;AAuCpE,SAAS,kBACd,MACA,cACA;AACA,QAAgC,WAAxB,SAtDV,IAsDkC,IAAb,qBAAa,IAAb,CAAX;AACR,QAAM,EAAE,MAAM,aAAa,YAAY,SAAS,IAAI;AACpD,QAAM,oBAAgB,gCAAiB,UAAU;AACjD,QAAM,gBAAY,sBAA4B,IAAI;AAElD,+BAAU,MAAM;AACd,cAAU,UAAU,CAAC,SAAsD;AACzE,UAAI,OAAO,WAAW,UAAU;AAC9B,eAAO,cAAAC,QAAM,cAAc,cAAAA,QAAM,UAAU,MAAM,MAAM;AAAA,MACzD;AAEA,UAAI,CAAC,QAAQ;AACX,eAAO;AAAA,MACT;AAEA,YAAM,eAAyC,MAAM;AACnD,cAAM,aAAa,KAAK;AAExB,gBAAQ,KAAK,QAAQ;AAAA,UACnB,KAAK,2BAAe;AAClB,mBAAO;AAAA,cACL,MAAM;AAAA,cACN,SAAS,KAAK;AAAA,cACd,QAAQ,KAAK;AAAA,cACb,SAAS;AAAA,YACX;AAAA,UACF,KAAK,2BAAe;AAClB,mBAAO;AAAA,cACL,MAAM;AAAA,cACN,SAAS,KAAK;AAAA,cACd,QAAQ,KAAK;AAAA,cACb,SAAS,MAAM;AAAA,cAAC;AAAA,YAClB;AAAA,UACF,KAAK,2BAAe;AAClB,mBAAO;AAAA,cACL,MAAM;AAAA,cACN,SAAS,KAAK;AAAA,cACd,QAAQ,KAAK;AAAA,cACb,QAAQ,KAAK,aAAS,yBAAU,KAAK,QAAQ,KAAK,MAAM,IAAI,KAAK;AAAA,cACjE,SAAS;AAAA,YACX;AAAA,UACF;AACE,kBAAM,IAAI,8BAAgB;AAAA,cACxB,MAAM,kCAAoB;AAAA,cAC1B,SAAS,6BAA8B,KAAuC;AAAA,YAChF,CAAC;AAAA,QACL;AAAA,MACF,GAAG;AAEH,YAAM,WAAW,OAAO,WAAW;AAEnC,UAAI,OAAO,aAAa,UAAU;AAChC,eAAO,cAAAA,QAAM,cAAc,cAAAA,QAAM,UAAU,MAAM,QAAQ;AAAA,MAC3D;AAEA,aAAO,8BAAY;AAAA,IACrB;AAAA,EACF,GAAG,CAAC,QAAQ,GAAI,sCAAgB,CAAC,CAAE,CAAC;AAEpC,mBAAAC,mBAAuB;AAAA,IACrB;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAY;AAAA,IACZ,QAAS,CAAC,SAAgC;AAtH9C,UAAAC,KAAA;AAuHM,oBAAAA,MAAA,UAAU,YAAV,gBAAAA,IAAA,gBAAoB,UAApB,YAAiD;AAAA;AAAA,EACrD,CAAC;AACH;","names":["import_react","React","useHumanInTheLoopVNext","_a"]}