!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@urql/core"),require("@copilotkit/shared")):"function"==typeof define&&define.amd?define(["exports","@urql/core","@copilotkit/shared"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).CopilotKitRuntimeClientGQL={},e.UrqlCore,e.CopilotKitShared)}(this,function(e,n,t){"use strict";var a,s,i,o,d,r,l,u="1.51.3";e.ActionInputAvailability=void 0,(a=e.ActionInputAvailability||(e.ActionInputAvailability={})).Disabled="disabled",a.Enabled="enabled",a.Remote="remote",e.CopilotRequestType=void 0,(s=e.CopilotRequestType||(e.CopilotRequestType={})).Chat="Chat",s.Suggestion="Suggestion",s.Task="Task",s.TextareaCompletion="TextareaCompletion",s.TextareaPopover="TextareaPopover",e.FailedResponseStatusReason=void 0,(i=e.FailedResponseStatusReason||(e.FailedResponseStatusReason={})).GuardrailsValidationFailed="GUARDRAILS_VALIDATION_FAILED",i.MessageStreamInterrupted="MESSAGE_STREAM_INTERRUPTED",i.UnknownError="UNKNOWN_ERROR",e.MessageRole=void 0,(o=e.MessageRole||(e.MessageRole={})).Assistant="assistant",o.Developer="developer",o.System="system",o.Tool="tool",o.User="user",e.MessageStatusCode=void 0,(d=e.MessageStatusCode||(e.MessageStatusCode={})).Failed="Failed",d.Pending="Pending",d.Success="Success",e.MetaEventName=void 0,(r=e.MetaEventName||(e.MetaEventName={})).CopilotKitLangGraphInterruptEvent="CopilotKitLangGraphInterruptEvent",r.LangGraphInterruptEvent="LangGraphInterruptEvent",e.ResponseStatusCode=void 0,(l=e.ResponseStatusCode||(e.ResponseStatusCode={})).Failed="Failed",l.Pending="Pending",l.Success="Success";const c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"generateCopilotResponse"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"GenerateCopilotResponseInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"properties"}},type:{kind:"NamedType",name:{kind:"Name",value:"JSONObject"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"generateCopilotResponse"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}},{kind:"Argument",name:{kind:"Name",value:"properties"},value:{kind:"Variable",name:{kind:"Name",value:"properties"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"runId"}},{kind:"Field",name:{kind:"Name",value:"extensions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"openaiAssistantAPI"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"runId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CopilotResponse"}},directives:[{kind:"Directive",name:{kind:"Name",value:"defer"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BaseResponseStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FailedResponseStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"reason"}},{kind:"Field",name:{kind:"Name",value:"details"}}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"messages"},directives:[{kind:"Directive",name:{kind:"Name",value:"stream"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BaseMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BaseMessageOutput"}},directives:[{kind:"Directive",name:{kind:"Name",value:"defer"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SuccessMessageStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FailedMessageStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}},{kind:"Field",name:{kind:"Name",value:"reason"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PendingMessageStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}}]}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"TextMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"},directives:[{kind:"Directive",name:{kind:"Name",value:"stream"}}]},{kind:"Field",name:{kind:"Name",value:"role"}},{kind:"Field",name:{kind:"Name",value:"parentMessageId"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ImageMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"format"}},{kind:"Field",name:{kind:"Name",value:"bytes"}},{kind:"Field",name:{kind:"Name",value:"role"}},{kind:"Field",name:{kind:"Name",value:"parentMessageId"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActionExecutionMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"arguments"},directives:[{kind:"Directive",name:{kind:"Name",value:"stream"}}]},{kind:"Field",name:{kind:"Name",value:"parentMessageId"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ResultMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"result"}},{kind:"Field",name:{kind:"Name",value:"actionExecutionId"}},{kind:"Field",name:{kind:"Name",value:"actionName"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AgentStateMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"state"}},{kind:"Field",name:{kind:"Name",value:"running"}},{kind:"Field",name:{kind:"Name",value:"agentName"}},{kind:"Field",name:{kind:"Name",value:"nodeName"}},{kind:"Field",name:{kind:"Name",value:"runId"}},{kind:"Field",name:{kind:"Name",value:"active"}},{kind:"Field",name:{kind:"Name",value:"role"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"metaEvents"},directives:[{kind:"Directive",name:{kind:"Name",value:"stream"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LangGraphInterruptEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CopilotKitLangGraphInterruptEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"data"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messages"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BaseMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BaseMessageOutput"}},directives:[{kind:"Directive",name:{kind:"Name",value:"defer"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SuccessMessageStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FailedMessageStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}},{kind:"Field",name:{kind:"Name",value:"reason"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PendingMessageStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}}]}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"TextMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"role"}},{kind:"Field",name:{kind:"Name",value:"parentMessageId"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActionExecutionMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"arguments"}},{kind:"Field",name:{kind:"Name",value:"parentMessageId"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ResultMessageOutput"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"result"}},{kind:"Field",name:{kind:"Name",value:"actionExecutionId"}},{kind:"Field",name:{kind:"Name",value:"actionName"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]}}]}}]}}]},m={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"availableAgents"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"availableAgents"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"agents"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}}]}}]}}]},g={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"loadAgentState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LoadAgentStateInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"loadAgentState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"threadExists"}},{kind:"Field",name:{kind:"Name",value:"state"}},{kind:"Field",name:{kind:"Name",value:"messages"}}]}}]}}]},p={"\n  mutation generateCopilotResponse($data: GenerateCopilotResponseInput!, $properties: JSONObject) {\n    generateCopilotResponse(data: $data, properties: $properties) {\n      threadId\n      runId\n      extensions {\n        openaiAssistantAPI {\n          runId\n          threadId\n        }\n      }\n      ... on CopilotResponse @defer {\n        status {\n          ... on BaseResponseStatus {\n            code\n          }\n          ... on FailedResponseStatus {\n            reason\n            details\n          }\n        }\n      }\n      messages @stream {\n        __typename\n        ... on BaseMessageOutput {\n          id\n          createdAt\n        }\n        ... on BaseMessageOutput @defer {\n          status {\n            ... on SuccessMessageStatus {\n              code\n            }\n            ... on FailedMessageStatus {\n              code\n              reason\n            }\n            ... on PendingMessageStatus {\n              code\n            }\n          }\n        }\n        ... on TextMessageOutput {\n          content @stream\n          role\n          parentMessageId\n        }\n        ... on ImageMessageOutput {\n          format\n          bytes\n          role\n          parentMessageId\n        }\n        ... on ActionExecutionMessageOutput {\n          name\n          arguments @stream\n          parentMessageId\n        }\n        ... on ResultMessageOutput {\n          result\n          actionExecutionId\n          actionName\n        }\n        ... on AgentStateMessageOutput {\n          threadId\n          state\n          running\n          agentName\n          nodeName\n          runId\n          active\n          role\n        }\n      }\n      metaEvents @stream {\n        ... on LangGraphInterruptEvent {\n          type\n          name\n          value\n        }\n\n        ... on CopilotKitLangGraphInterruptEvent {\n          type\n          name\n          data {\n            messages {\n              __typename\n              ... on BaseMessageOutput {\n                id\n                createdAt\n              }\n              ... on BaseMessageOutput @defer {\n                status {\n                  ... on SuccessMessageStatus {\n                    code\n                  }\n                  ... on FailedMessageStatus {\n                    code\n                    reason\n                  }\n                  ... on PendingMessageStatus {\n                    code\n                  }\n                }\n              }\n              ... on TextMessageOutput {\n                content\n                role\n                parentMessageId\n              }\n              ... on ActionExecutionMessageOutput {\n                name\n                arguments\n                parentMessageId\n              }\n              ... on ResultMessageOutput {\n                result\n                actionExecutionId\n                actionName\n              }\n            }\n            value\n          }\n        }\n      }\n    }\n  }\n":c,"\n  query availableAgents {\n    availableAgents {\n      agents {\n        name\n        id\n        description\n      }\n    }\n  }\n":m,"\n  query loadAgentState($data: LoadAgentStateInput!) {\n    loadAgentState(data: $data) {\n      threadId\n      threadExists\n      state\n      messages\n    }\n  }\n":g};function k(e){var n;return null!==(n=p[e])&&void 0!==n?n:{}}const v=k("\n  mutation generateCopilotResponse($data: GenerateCopilotResponseInput!, $properties: JSONObject) {\n    generateCopilotResponse(data: $data, properties: $properties) {\n      threadId\n      runId\n      extensions {\n        openaiAssistantAPI {\n          runId\n          threadId\n        }\n      }\n      ... on CopilotResponse @defer {\n        status {\n          ... on BaseResponseStatus {\n            code\n          }\n          ... on FailedResponseStatus {\n            reason\n            details\n          }\n        }\n      }\n      messages @stream {\n        __typename\n        ... on BaseMessageOutput {\n          id\n          createdAt\n        }\n        ... on BaseMessageOutput @defer {\n          status {\n            ... on SuccessMessageStatus {\n              code\n            }\n            ... on FailedMessageStatus {\n              code\n              reason\n            }\n            ... on PendingMessageStatus {\n              code\n            }\n          }\n        }\n        ... on TextMessageOutput {\n          content @stream\n          role\n          parentMessageId\n        }\n        ... on ImageMessageOutput {\n          format\n          bytes\n          role\n          parentMessageId\n        }\n        ... on ActionExecutionMessageOutput {\n          name\n          arguments @stream\n          parentMessageId\n        }\n        ... on ResultMessageOutput {\n          result\n          actionExecutionId\n          actionName\n        }\n        ... on AgentStateMessageOutput {\n          threadId\n          state\n          running\n          agentName\n          nodeName\n          runId\n          active\n          role\n        }\n      }\n      metaEvents @stream {\n        ... on LangGraphInterruptEvent {\n          type\n          name\n          value\n        }\n\n        ... on CopilotKitLangGraphInterruptEvent {\n          type\n          name\n          data {\n            messages {\n              __typename\n              ... on BaseMessageOutput {\n                id\n                createdAt\n              }\n              ... on BaseMessageOutput @defer {\n                status {\n                  ... on SuccessMessageStatus {\n                    code\n                  }\n                  ... on FailedMessageStatus {\n                    code\n                    reason\n                  }\n                  ... on PendingMessageStatus {\n                    code\n                  }\n                }\n              }\n              ... on TextMessageOutput {\n                content\n                role\n                parentMessageId\n              }\n              ... on ActionExecutionMessageOutput {\n                name\n                arguments\n                parentMessageId\n              }\n              ... on ResultMessageOutput {\n                result\n                actionExecutionId\n                actionName\n              }\n            }\n            value\n          }\n        }\n      }\n    }\n  }\n"),N=k("\n  query availableAgents {\n    availableAgents {\n      agents {\n        name\n        id\n        description\n      }\n    }\n  }\n"),S=k("\n  query loadAgentState($data: LoadAgentStateInput!) {\n    loadAgentState(data: $data) {\n      threadId\n      threadExists\n      state\n      messages\n    }\n  }\n"),f=(e,n)=>async(...a)=>{var s,i,o;const d=null===(i=null===(s=a[1])||void 0===s?void 0:s.headers)||void 0===i?void 0:i["x-copilotcloud-public-api-key"];try{const s=await fetch(a[0],Object.assign(Object.assign({},null!==(o=a[1])&&void 0!==o?o:{}),{signal:e})),i=d?null:await t.getPossibleVersionMismatch({runtimeVersion:s.headers.get("X-CopilotKit-Runtime-Version"),runtimeClientGqlVersion:u});if(200!==s.status&&s.status>=400&&s.status<=500){if(i)throw new t.CopilotKitVersionMismatchError(i);throw new t.ResolvedCopilotKitError({status:s.status})}return i&&n&&n(i.message),s}catch(e){if(e.message.includes("BodyStreamBuffer was aborted")||e.message.includes("signal is aborted without reason"))throw e;if(e instanceof t.CopilotKitError)throw e;throw new t.CopilotKitLowLevelError({error:e,url:a[0]})}};class y{constructor(e){const t={};this.handleGQLErrors=e.handleGQLErrors,this.handleGQLWarning=e.handleGQLWarning,e.headers&&Object.assign(t,e.headers),e.publicApiKey&&(t["x-copilotcloud-public-api-key"]=e.publicApiKey),this.client=new n.Client({url:e.url,exchanges:[n.cacheExchange,n.fetchExchange],fetchOptions:Object.assign({headers:Object.assign(Object.assign({},t),{"X-CopilotKit-Runtime-Client-GQL-Version":u})},e.credentials?{credentials:e.credentials}:{})})}generateCopilotResponse({data:e,properties:n,signal:t}){const a=f(t,this.handleGQLWarning);return this.client.mutation(v,{data:e,properties:n},{fetch:a})}asStream(e){const n=this.handleGQLErrors;return new ReadableStream({start(t){e.subscribe(({data:e,hasNext:a,error:s})=>{var i;if(s){if(s.message.includes("BodyStreamBuffer was aborted")||s.message.includes("signal is aborted without reason"))return a||t.close(),void console.warn("Abort error suppressed");if(null===(i=s.extensions)||void 0===i?void 0:i.visibility){const e=Object.assign(Object.assign({},s),{graphQLErrors:[{message:s.message,extensions:s.extensions}]});return void(n&&n(e))}t.error(s),n&&n(s)}else t.enqueue(e),a||t.close()})}})}availableAgents(){const e=f();return this.client.query(N,{},{fetch:e})}loadAgentState(e){const n=f(),t=this.client.query(S,{data:e},{fetch:n});return t.toPromise().then(({error:e})=>{e&&this.handleGQLErrors&&this.handleGQLErrors(e)}).catch(()=>{}),t}static removeGraphQLTypename(e){return Array.isArray(e)?e.forEach(e=>y.removeGraphQLTypename(e)):"object"==typeof e&&null!==e&&(delete e.__typename,Object.keys(e).forEach(n=>{"object"==typeof e[n]&&null!==e[n]&&y.removeGraphQLTypename(e[n])})),e}}class M{constructor(n){var a,s,i;null!==(a=n.id)&&void 0!==a||(n.id=t.randomId()),null!==(s=n.status)&&void 0!==s||(n.status={code:e.MessageStatusCode.Success}),null!==(i=n.createdAt)&&void 0!==i||(n.createdAt=new Date),Object.assign(this,n)}isTextMessage(){return"TextMessage"===this.type}isActionExecutionMessage(){return"ActionExecutionMessage"===this.type}isResultMessage(){return"ResultMessage"===this.type}isAgentStateMessage(){return"AgentStateMessage"===this.type}isImageMessage(){return"ImageMessage"===this.type}}const I=e.MessageRole;class h extends M{constructor(e){super(e),this.type="TextMessage",this.type="TextMessage"}}class b extends M{constructor(e){super(e),this.type="ActionExecutionMessage"}}class A extends M{constructor(e){super(e),this.type="ResultMessage"}static decodeResult(e){return t.parseJson(e,e)}static encodeResult(e){return void 0===e?"":"string"==typeof e?e:JSON.stringify(e)}}class F extends M{constructor(e){super(e),this.type="AgentStateMessage"}}class C extends M{constructor(e){super(e),this.type="ImageMessage"}}function E(e){return" \r\n\t".indexOf(e)>=0}function w(e){try{return e.length?JSON.parse(function(e){for(var n,t,a,s=["topLevel"],i=0,o=function(e){return s.push(e)},d=function(e){return s[s.length-1]=e},r=function(e){null==n&&(n=i,t=s.length,a=e)},l=function(e){e===a&&(n=void 0,t=void 0,a=void 0)},u=function(){return s.pop()},c=function(){return i--},m=function(e){if("0"<=e&&e<="9")o("number");else switch(e){case'"':return void o("string");case"-":return void o("numberNeedsDigit");case"t":return void o("true");case"f":return void o("false");case"n":return void o("null");case"[":return void o("arrayNeedsValue");case"{":return void o("objectNeedsKey")}},g=e.length;i<g;i++){var p=e[i];switch(s[s.length-1]){case"topLevel":m(p);break;case"string":switch(p){case'"':u();break;case"\\":r("stringEscape"),o("stringEscaped")}break;case"stringEscaped":"u"===p?o("stringUnicode"):(l("stringEscape"),u());break;case"stringUnicode":i-e.lastIndexOf("u",i)===4&&(l("stringEscape"),u());break;case"number":"."===p?d("numberNeedsDigit"):"e"===p||"E"===p?d("numberNeedsExponent"):(p<"0"||p>"9")&&(c(),u());break;case"numberNeedsDigit":d("number");break;case"numberNeedsExponent":d("+"===p||"-"===p?"numberNeedsDigit":"number");break;case"true":case"false":case"null":(p<"a"||p>"z")&&(c(),u());break;case"arrayNeedsValue":"]"===p?u():E(p)||(l("collectionItem"),d("arrayNeedsComma"),m(p));break;case"arrayNeedsComma":"]"===p?u():","===p&&(r("collectionItem"),d("arrayNeedsValue"));break;case"objectNeedsKey":"}"===p?u():'"'===p&&(r("collectionItem"),d("objectNeedsColon"),o("string"));break;case"objectNeedsColon":":"===p&&d("objectNeedsValue");break;case"objectNeedsValue":E(p)||(l("collectionItem"),d("objectNeedsComma"),m(p));break;case"objectNeedsComma":"}"===p?u():","===p&&(r("collectionItem"),d("objectNeedsKey"))}}null!=t&&(s.length=t);for(var k=[null!=n?e.slice(0,n):e],v=function(n){return k.push(n.slice(e.length-e.lastIndexOf(n[0])))},N=s.length-1;N>=0;N--)switch(s[N]){case"string":k.push('"');break;case"numberNeedsDigit":case"numberNeedsExponent":k.push("0");break;case"true":v("true");break;case"false":v("false");break;case"null":v("null");break;case"arrayNeedsValue":case"arrayNeedsComma":k.push("]");break;case"objectNeedsKey":case"objectNeedsColon":case"objectNeedsValue":case"objectNeedsComma":k.push("}")}return k.join("")}(e.join(""))):{}}catch(e){return{}}}function O(e){if("assistant"!==e.role)throw new Error(`Cannot extract agent name from message with role ${e.role}`);return e.agentName||"unknown"}function x(e){return"assistant"===e.role&&"agentName"in e&&"state"in e}function T(e){if(!("assistant"===e.role||"user"===e.role)||void 0===e.image)return!1;return!(void 0===e.image.format||void 0===e.image.bytes)}function R(e,n,t){const a=[];e=Array.isArray(e)?e:[e];const s={};for(const i of e){if(x(i)){const e=O(i),n="state"in i&&i.state?i.state:{};a.push(new F({id:i.id,agentName:e,state:n,role:I.Assistant})),"generativeUI"in i&&i.generativeUI&&t&&(t[e]={name:e,render:i.generativeUI});continue}if(T(i))a.push(L(i));else if("assistant"===i.role&&i.toolCalls){a.push(j(i));for(const e of i.toolCalls){s[e.id]=e.function.name;const t=G(e,i.id);if("generativeUI"in i&&i.generativeUI&&n){const t=e.function.name,a=Object.values(n).find(e=>e.name===t),s=Object.values(n).find(e=>"*"===e.name);a?a.render=i.generativeUI:s&&(s.render=i.generativeUI)}a.push(t)}}else if("developer"!==i.role&&"system"!==i.role&&"assistant"!==i.role&&"user"!==i.role){if("tool"!==i.role)throw new Error(`Unknown message role: "${i.role}" in message with id: ${i.id}`);a.push(D(i,s))}else a.push(j(i))}return a}function j(e){if("developer"!==e.role&&"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role)throw new Error(`Cannot convert message with role ${e.role} to TextMessage`);let n;return n="developer"===e.role?I.Developer:"system"===e.role?I.System:"assistant"===e.role?I.Assistant:I.User,new h({id:e.id,content:e.content||"",role:n})}function G(e,n){if("function"!==e.type)throw new Error(`Unsupported tool call type: ${e.type}`);let t;if("string"==typeof e.function.arguments)try{t=JSON.parse(e.function.arguments)}catch(n){console.warn(`Failed to parse tool call arguments for ${e.function.name}:`,n),t={}}else"object"==typeof e.function.arguments&&null!==e.function.arguments?t=e.function.arguments:(console.warn(`Invalid tool call arguments type for ${e.function.name}:`,typeof e.function.arguments),t={});return new b({id:e.id,name:e.function.name,arguments:t,parentMessageId:n})}function D(e,n){if("tool"!==e.role)throw new Error(`Cannot convert message with role ${e.role} to ResultMessage`);if(!e.toolCallId)throw new Error("Tool message must have a toolCallId");const t=n[e.toolCallId]||"unknown";let a;const s=e.content||"";if("string"==typeof s)a=s;else if("object"==typeof s&&null!==s)try{a=JSON.stringify(s)}catch(e){console.warn(`Failed to stringify tool result for ${t}:`,e),a=String(s)}else a=String(s);return new A({id:e.id,result:a,actionExecutionId:e.toolCallId,actionName:e.toolName||t})}function L(e){if(!T(e))throw new Error("Cannot convert message to ImageMessage: missing format or bytes");let n;if(n="assistant"===e.role?I.Assistant:I.User,"assistant"!==e.role&&"user"!==e.role)throw new Error(`Cannot convert message with role ${e.role} to ImageMessage`);return new C({id:e.id,format:e.image.format,bytes:e.image.bytes,role:n})}const U=["jpeg","png","webp","gif"];function _(n,t,a){const s=t&&Object.values(t).some(e=>e.name===n.name),i=t&&Object.values(t).some(e=>"*"===e.name);if(!t||!s&&!i)return{id:n.id,role:"assistant",toolCalls:[P(n)],name:n.name};const o=Object.values(t).find(e=>e.name===n.name)||Object.values(t).find(e=>"*"===e.name);return{id:n.id,role:"assistant",content:"",toolCalls:[P(n)],generativeUI:(t=>{if(t)return s=>{var i,d;let r=null==a?void 0:a.get(n.id),l="inProgress";if(void 0!==r?l="complete":(null===(i=n.status)||void 0===i?void 0:i.code)!==e.MessageStatusCode.Pending&&(l="executing"),"string"==typeof(null==s?void 0:s.result))try{s.result=JSON.parse(s.result)}catch(e){}if("string"==typeof r)try{r=JSON.parse(r)}catch(e){}const u={status:(null==s?void 0:s.status)||l,args:n.arguments||{},result:(null==s?void 0:s.result)||r||void 0,messageId:n.id};if("*"===o.name)return t(Object.assign(Object.assign(Object.assign({},u),s),{name:n.name}));{const e=null!==(d=null==s?void 0:s.respond)&&void 0!==d?d:()=>{};return t(Object.assign(Object.assign(Object.assign({},u),s),{respond:e}))}}})(o.render),name:n.name}}function q(e,n){if(n&&Object.values(n).some(n=>n.name===e.agentName)){const t=Object.values(n).find(n=>n.name===e.agentName),a=n=>{if(n)return t=>{const a=e.state;return n({state:a})}};return{id:e.id,role:"assistant",generativeUI:a(t.render),agentName:e.agentName,state:e.state}}return{id:e.id,role:"assistant",agentName:e.agentName,state:e.state}}function P(e){return{id:e.id,function:{name:e.name,arguments:JSON.stringify(e.arguments)},type:"function"}}function V(e){switch(e.role){case I.Developer:return{id:e.id,role:"developer",content:e.content};case I.System:return{id:e.id,role:"system",content:e.content};case I.Assistant:return{id:e.id,role:"assistant",content:e.content};case I.User:return{id:e.id,role:"user",content:e.content};default:throw new Error("Unknown message role")}}function $(e){return{id:e.id,role:"tool",content:e.result,toolCallId:e.actionExecutionId,toolName:e.actionName}}function K(e){if(n=e.format,!U.includes(n))throw new Error(`Invalid image format: ${e.format}. Supported formats are: ${U.join(", ")}`);var n;if(!e.bytes||"string"!=typeof e.bytes||""===e.bytes.trim())throw new Error("Image bytes must be a non-empty string");const t=e.role===I.Assistant?"assistant":"user";return{id:e.id,role:t,content:"",image:{format:e.format,bytes:e.bytes}}}e.ActionExecutionMessage=b,e.AgentStateMessage=F,e.AvailableAgentsDocument=m,e.CopilotRuntimeClient=y,e.GenerateCopilotResponseDocument=c,e.ImageMessage=C,e.LoadAgentStateDocument=g,e.Message=M,e.ResultMessage=A,e.Role=I,e.TextMessage=h,e.aguiMessageWithImageToGQLMessage=L,e.aguiMessageWithRenderToGQL=function(e,n,t){if("assistant"===e.role&&"generativeUI"in e&&e.generativeUI&&!e.toolCalls){const n=[];return n.push(new F({id:e.id,agentName:"unknown",state:{},role:I.Assistant})),t&&(t.unknown={name:"unknown",render:e.generativeUI}),n}return R([e],n,t)},e.aguiTextMessageToGQLMessage=j,e.aguiToGQL=R,e.aguiToolCallToGQLActionExecution=G,e.aguiToolMessageToGQLResultMessage=D,e.convertGqlOutputToMessages=function(n){return n.map(n=>{if("TextMessageOutput"===n.__typename)return new h({id:n.id,role:n.role,content:n.content.join(""),parentMessageId:n.parentMessageId,createdAt:new Date,status:n.status||{code:e.MessageStatusCode.Pending}});if("ActionExecutionMessageOutput"===n.__typename)return new b({id:n.id,name:n.name,arguments:w(n.arguments),parentMessageId:n.parentMessageId,createdAt:new Date,status:n.status||{code:e.MessageStatusCode.Pending}});if("ResultMessageOutput"===n.__typename)return new A({id:n.id,result:n.result,actionExecutionId:n.actionExecutionId,actionName:n.actionName,createdAt:new Date,status:n.status||{code:e.MessageStatusCode.Pending}});if("AgentStateMessageOutput"===n.__typename)return new F({id:n.id,threadId:n.threadId,role:n.role,agentName:n.agentName,nodeName:n.nodeName,runId:n.runId,active:n.active,running:n.running,state:t.parseJson(n.state,{}),createdAt:new Date});if("ImageMessageOutput"===n.__typename)return new C({id:n.id,format:n.format,bytes:n.bytes,role:n.role,parentMessageId:n.parentMessageId,createdAt:new Date,status:n.status||{code:e.MessageStatusCode.Pending}});throw new Error("Unknown message type")})},e.convertMessagesToGqlInput=function(e){return e.map(e=>{if(e.isTextMessage())return{id:e.id,createdAt:e.createdAt,textMessage:{content:e.content,role:e.role,parentMessageId:e.parentMessageId}};if(e.isActionExecutionMessage())return{id:e.id,createdAt:e.createdAt,actionExecutionMessage:{name:e.name,arguments:JSON.stringify(e.arguments),parentMessageId:e.parentMessageId}};if(e.isResultMessage())return{id:e.id,createdAt:e.createdAt,resultMessage:{result:e.result,actionExecutionId:e.actionExecutionId,actionName:e.actionName}};if(e.isAgentStateMessage())return{id:e.id,createdAt:e.createdAt,agentStateMessage:{threadId:e.threadId,role:e.role,agentName:e.agentName,nodeName:e.nodeName,runId:e.runId,active:e.active,running:e.running,state:JSON.stringify(e.state)}};if(e.isImageMessage())return{id:e.id,createdAt:e.createdAt,imageMessage:{format:e.format,bytes:e.bytes,role:e.role,parentMessageId:e.parentMessageId}};throw new Error("Unknown message type")})},e.filterAdjacentAgentStateMessages=function(e){const n=[];return e.forEach((e,t)=>{if("AgentStateMessageOutput"!==e.__typename)n.push(e);else{const t=n.findIndex(n=>"AgentStateMessageOutput"===n.__typename&&n.agentName===e.agentName);-1===t?n.push(e):n[t]=e}}),n},e.filterAgentStateMessages=function(e){return e.filter(e=>!e.isAgentStateMessage())},e.gqlActionExecutionMessageToAGUIMessage=_,e.gqlImageMessageToAGUIMessage=K,e.gqlResultMessageToAGUIMessage=$,e.gqlTextMessageToAGUIMessage=V,e.gqlToAGUI=function(e,n,t){let a=[];e=Array.isArray(e)?e:[e];const s=new Map;for(const n of e)n.isResultMessage()&&s.set(n.actionExecutionId,n.result);for(const i of e)if(i.isTextMessage())a.push(V(i));else if(i.isResultMessage())a.push($(i));else if(i.isActionExecutionMessage())a.push(_(i,n,s));else if(i.isAgentStateMessage())a.push(q(i,t));else{if(!i.isImageMessage())throw new Error("Unknown message type");a.push(K(i))}return a},e.langGraphInterruptEvent=function(n){return Object.assign(Object.assign({},n),{name:e.MetaEventName.LangGraphInterruptEvent,type:"MetaEvent"})},e.loadMessagesFromJsonRepresentation=function(n){const t=[];for(const a of n)"content"in a?t.push(new h({id:a.id,role:a.role,content:a.content,parentMessageId:a.parentMessageId,createdAt:a.createdAt||new Date,status:a.status||{code:e.MessageStatusCode.Success}})):"arguments"in a?t.push(new b({id:a.id,name:a.name,arguments:a.arguments,parentMessageId:a.parentMessageId,createdAt:a.createdAt||new Date,status:a.status||{code:e.MessageStatusCode.Success}})):"result"in a?t.push(new A({id:a.id,result:a.result,actionExecutionId:a.actionExecutionId,actionName:a.actionName,createdAt:a.createdAt||new Date,status:a.status||{code:e.MessageStatusCode.Success}})):"state"in a?t.push(new F({id:a.id,threadId:a.threadId,role:a.role,agentName:a.agentName,nodeName:a.nodeName,runId:a.runId,active:a.active,running:a.running,state:a.state,createdAt:a.createdAt||new Date})):"format"in a&&"bytes"in a&&t.push(new C({id:a.id,format:a.format,bytes:a.bytes,role:a.role,parentMessageId:a.parentMessageId,createdAt:a.createdAt||new Date,status:a.status||{code:e.MessageStatusCode.Success}}));return t}});
//# sourceMappingURL=index.umd.js.map
