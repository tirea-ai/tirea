{"version":3,"sources":["../src/index.ts","../src/components/chat/CopilotChatInput.tsx","../src/providers/CopilotChatConfigurationProvider.tsx","../src/components/ui/button.tsx","../src/lib/utils.ts","../src/components/ui/tooltip.tsx","../src/components/ui/dropdown-menu.tsx","../src/components/chat/CopilotChatAudioRecorder.tsx","../src/lib/slots.tsx","../src/components/chat/CopilotChatAssistantMessage.tsx","../src/hooks/use-render-tool-call.tsx","../src/providers/CopilotKitProvider.tsx","../src/lib/react-core.ts","../src/components/CopilotKitInspector.tsx","../src/components/MCPAppsActivityRenderer.tsx","../src/hooks/use-render-custom-messages.tsx","../src/hooks/use-render-activity-message.tsx","../src/hooks/use-frontend-tool.tsx","../src/hooks/use-human-in-the-loop.tsx","../src/hooks/use-agent.tsx","../src/hooks/use-agent-context.tsx","../src/hooks/use-suggestions.tsx","../src/hooks/use-configure-suggestions.tsx","../src/components/chat/CopilotChatToolCallsView.tsx","../src/components/chat/CopilotChatUserMessage.tsx","../src/components/chat/CopilotChatSuggestionPill.tsx","../src/components/chat/CopilotChatSuggestionView.tsx","../src/components/chat/CopilotChatMessageView.tsx","../src/components/chat/CopilotChatView.tsx","../src/hooks/use-keyboard-height.tsx","../src/components/chat/CopilotChat.tsx","../src/lib/transcription-client.ts","../src/components/chat/CopilotChatToggleButton.tsx","../src/components/chat/CopilotSidebarView.tsx","../src/components/chat/CopilotModalHeader.tsx","../src/components/chat/CopilotPopupView.tsx","../src/components/chat/CopilotSidebar.tsx","../src/components/chat/CopilotPopup.tsx","../src/types/defineToolCallRenderer.ts","../src/components/WildcardToolCallRender.tsx"],"sourcesContent":["\"use client\";\n\n// Re-export AG-UI runtime and types to provide a single import surface\n// This helps avoid version mismatches by letting apps import everything from '@copilotkitnext/react'\n// Note: @ag-ui/client already re-exports everything from @ag-ui/core, so we only export from client\n// to avoid conflicting star exports during webpack builds\nexport * from \"@ag-ui/client\";\n\n// React components and hooks for CopilotKit2\nexport * from \"./components\";\nexport * from \"./hooks\";\nexport * from \"./providers\";\nexport * from \"./types\";\nexport * from \"./lib/react-core\";\n","import React, {\n  useState,\n  useRef,\n  KeyboardEvent,\n  ChangeEvent,\n  useEffect,\n  useLayoutEffect,\n  forwardRef,\n  useImperativeHandle,\n  useCallback,\n  useMemo,\n} from \"react\";\nimport { twMerge } from \"tailwind-merge\";\nimport { Plus, Mic, ArrowUp, X, Check, Square, Loader2 } from \"lucide-react\";\n\nimport {\n  CopilotChatLabels,\n  useCopilotChatConfiguration,\n  CopilotChatDefaultLabels,\n} from \"@/providers/CopilotChatConfigurationProvider\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSub,\n  DropdownMenuSubTrigger,\n  DropdownMenuSubContent,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\n\nimport { CopilotChatAudioRecorder } from \"./CopilotChatAudioRecorder\";\nimport { renderSlot, WithSlots } from \"@/lib/slots\";\n\nexport type CopilotChatInputMode = \"input\" | \"transcribe\" | \"processing\";\n\nexport type ToolsMenuItem = {\n  label: string;\n} & (\n  | {\n      action: () => void;\n      items?: never;\n    }\n  | {\n      action?: never;\n      items: (ToolsMenuItem | \"-\")[];\n    }\n);\n\ntype CopilotChatInputSlots = {\n  textArea: typeof CopilotChatInput.TextArea;\n  sendButton: typeof CopilotChatInput.SendButton;\n  startTranscribeButton: typeof CopilotChatInput.StartTranscribeButton;\n  cancelTranscribeButton: typeof CopilotChatInput.CancelTranscribeButton;\n  finishTranscribeButton: typeof CopilotChatInput.FinishTranscribeButton;\n  addMenuButton: typeof CopilotChatInput.AddMenuButton;\n  audioRecorder: typeof CopilotChatAudioRecorder;\n};\n\ntype CopilotChatInputRestProps = {\n  mode?: CopilotChatInputMode;\n  toolsMenu?: (ToolsMenuItem | \"-\")[];\n  autoFocus?: boolean;\n  onSubmitMessage?: (value: string) => void;\n  onStop?: () => void;\n  isRunning?: boolean;\n  onStartTranscribe?: () => void;\n  onCancelTranscribe?: () => void;\n  onFinishTranscribe?: () => void;\n  onFinishTranscribeWithAudio?: (audioBlob: Blob) => Promise<void>;\n  onAddFile?: () => void;\n  value?: string;\n  onChange?: (value: string) => void;\n} & Omit<React.HTMLAttributes<HTMLDivElement>, \"onChange\">;\n\ntype CopilotChatInputBaseProps = WithSlots<CopilotChatInputSlots, CopilotChatInputRestProps>;\n\ntype CopilotChatInputChildrenArgs = CopilotChatInputBaseProps extends { children?: infer C }\n  ? C extends (props: infer P) => React.ReactNode\n    ? P\n    : never\n  : never;\n\nexport type CopilotChatInputProps = Omit<CopilotChatInputBaseProps, \"children\"> & {\n  children?: (props: CopilotChatInputChildrenArgs) => React.ReactNode;\n};\n\nconst SLASH_MENU_MAX_VISIBLE_ITEMS = 5;\nconst SLASH_MENU_ITEM_HEIGHT_PX = 40;\n\nexport function CopilotChatInput({\n  mode = \"input\",\n  onSubmitMessage,\n  onStop,\n  isRunning = false,\n  onStartTranscribe,\n  onCancelTranscribe,\n  onFinishTranscribe,\n  onFinishTranscribeWithAudio,\n  onAddFile,\n  onChange,\n  value,\n  toolsMenu,\n  autoFocus = true,\n  textArea,\n  sendButton,\n  startTranscribeButton,\n  cancelTranscribeButton,\n  finishTranscribeButton,\n  addMenuButton,\n  audioRecorder,\n  children,\n  className,\n  ...props\n}: CopilotChatInputProps) {\n  const isControlled = value !== undefined;\n  const [internalValue, setInternalValue] = useState<string>(() => value ?? \"\");\n\n  useEffect(() => {\n    if (!isControlled && value !== undefined) {\n      setInternalValue(value);\n    }\n  }, [isControlled, value]);\n\n  const resolvedValue = isControlled ? (value ?? \"\") : internalValue;\n\n  const [layout, setLayout] = useState<\"compact\" | \"expanded\">(\"compact\");\n  const ignoreResizeRef = useRef(false);\n  const resizeEvaluationRafRef = useRef<number | null>(null);\n  const isExpanded = mode === \"input\" && layout === \"expanded\";\n  const [commandQuery, setCommandQuery] = useState<string | null>(null);\n  const [slashHighlightIndex, setSlashHighlightIndex] = useState(0);\n\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n  const gridRef = useRef<HTMLDivElement>(null);\n  const addButtonContainerRef = useRef<HTMLDivElement>(null);\n  const actionsContainerRef = useRef<HTMLDivElement>(null);\n  const audioRecorderRef = useRef<React.ElementRef<typeof CopilotChatAudioRecorder>>(null);\n  const slashMenuRef = useRef<HTMLDivElement>(null);\n  const config = useCopilotChatConfiguration();\n  const labels = config?.labels ?? CopilotChatDefaultLabels;\n\n  const previousModalStateRef = useRef<boolean | undefined>(undefined);\n  const measurementCanvasRef = useRef<HTMLCanvasElement | null>(null);\n  const measurementsRef = useRef({\n    singleLineHeight: 0,\n    maxHeight: 0,\n    paddingLeft: 0,\n    paddingRight: 0,\n  });\n\n  const commandItems = useMemo(() => {\n    const entries: ToolsMenuItem[] = [];\n    const seen = new Set<string>();\n\n    const pushItem = (item: ToolsMenuItem | \"-\") => {\n      if (item === \"-\") {\n        return;\n      }\n\n      if (item.items && item.items.length > 0) {\n        for (const nested of item.items) {\n          pushItem(nested);\n        }\n        return;\n      }\n\n      if (!seen.has(item.label)) {\n        seen.add(item.label);\n        entries.push(item);\n      }\n    };\n\n    if (onAddFile) {\n      pushItem({\n        label: labels.chatInputToolbarAddButtonLabel,\n        action: onAddFile,\n      });\n    }\n\n    if (toolsMenu && toolsMenu.length > 0) {\n      for (const item of toolsMenu) {\n        pushItem(item);\n      }\n    }\n\n    return entries;\n  }, [labels.chatInputToolbarAddButtonLabel, onAddFile, toolsMenu]);\n\n  const filteredCommands = useMemo(() => {\n    if (commandQuery === null) {\n      return [] as ToolsMenuItem[];\n    }\n\n    if (commandItems.length === 0) {\n      return [] as ToolsMenuItem[];\n    }\n\n    const query = commandQuery.trim().toLowerCase();\n    if (query.length === 0) {\n      return commandItems;\n    }\n\n    const startsWith: ToolsMenuItem[] = [];\n    const contains: ToolsMenuItem[] = [];\n    for (const item of commandItems) {\n      const label = item.label.toLowerCase();\n      if (label.startsWith(query)) {\n        startsWith.push(item);\n      } else if (label.includes(query)) {\n        contains.push(item);\n      }\n    }\n\n    return [...startsWith, ...contains];\n  }, [commandItems, commandQuery]);\n\n  useEffect(() => {\n    if (!autoFocus) {\n      previousModalStateRef.current = config?.isModalOpen;\n      return;\n    }\n\n    if (config?.isModalOpen && !previousModalStateRef.current) {\n      inputRef.current?.focus();\n    }\n\n    previousModalStateRef.current = config?.isModalOpen;\n  }, [config?.isModalOpen, autoFocus]);\n\n  useEffect(() => {\n    if (commandItems.length === 0 && commandQuery !== null) {\n      setCommandQuery(null);\n    }\n  }, [commandItems.length, commandQuery]);\n\n  const previousCommandQueryRef = useRef<string | null>(null);\n\n  useEffect(() => {\n    if (\n      commandQuery !== null &&\n      commandQuery !== previousCommandQueryRef.current &&\n      filteredCommands.length > 0\n    ) {\n      setSlashHighlightIndex(0);\n    }\n\n    previousCommandQueryRef.current = commandQuery;\n  }, [commandQuery, filteredCommands.length]);\n\n  useEffect(() => {\n    if (commandQuery === null) {\n      setSlashHighlightIndex(0);\n      return;\n    }\n\n    if (filteredCommands.length === 0) {\n      setSlashHighlightIndex(-1);\n    } else if (slashHighlightIndex < 0 || slashHighlightIndex >= filteredCommands.length) {\n      setSlashHighlightIndex(0);\n    }\n  }, [commandQuery, filteredCommands, slashHighlightIndex]);\n\n  // Handle recording based on mode changes\n  useEffect(() => {\n    const recorder = audioRecorderRef.current;\n    if (!recorder) {\n      return;\n    }\n\n    if (mode === \"transcribe\") {\n      // Start recording when entering transcribe mode\n      recorder.start().catch(console.error);\n    } else {\n      // Stop recording when leaving transcribe mode\n      if (recorder.state === \"recording\") {\n        recorder.stop().catch(console.error);\n      }\n    }\n  }, [mode]);\n\n  useEffect(() => {\n    if (mode !== \"input\") {\n      setLayout(\"compact\");\n      setCommandQuery(null);\n    }\n  }, [mode]);\n\n  const updateSlashState = useCallback(\n    (value: string) => {\n      if (commandItems.length === 0) {\n        setCommandQuery((prev) => (prev === null ? prev : null));\n        return;\n      }\n\n      if (value.startsWith(\"/\")) {\n        const firstLine = value.split(/\\r?\\n/, 1)[0] ?? \"\";\n        const query = firstLine.slice(1);\n        setCommandQuery((prev) => (prev === query ? prev : query));\n      } else {\n        setCommandQuery((prev) => (prev === null ? prev : null));\n      }\n    },\n    [commandItems.length],\n  );\n\n  useEffect(() => {\n    updateSlashState(resolvedValue);\n  }, [resolvedValue, updateSlashState]);\n\n  // Handlers\n  const handleChange = (e: ChangeEvent<HTMLTextAreaElement>) => {\n    const nextValue = e.target.value;\n    if (!isControlled) {\n      setInternalValue(nextValue);\n    }\n    onChange?.(nextValue);\n    updateSlashState(nextValue);\n  };\n\n  const clearInputValue = useCallback(() => {\n    if (!isControlled) {\n      setInternalValue(\"\");\n    }\n\n    if (onChange) {\n      onChange(\"\");\n    }\n  }, [isControlled, onChange]);\n\n  const runCommand = useCallback(\n    (item: ToolsMenuItem) => {\n      clearInputValue();\n\n      item.action?.();\n\n      setCommandQuery(null);\n      setSlashHighlightIndex(0);\n\n      requestAnimationFrame(() => {\n        inputRef.current?.focus();\n      });\n    },\n    [clearInputValue],\n  );\n\n  const handleKeyDown = (e: KeyboardEvent<HTMLTextAreaElement>) => {\n    if (commandQuery !== null && mode === \"input\") {\n      if (e.key === \"ArrowDown\") {\n        if (filteredCommands.length > 0) {\n          e.preventDefault();\n          setSlashHighlightIndex((prev) => {\n            if (filteredCommands.length === 0) {\n              return prev;\n            }\n            const next = prev === -1 ? 0 : (prev + 1) % filteredCommands.length;\n            return next;\n          });\n        }\n        return;\n      }\n\n      if (e.key === \"ArrowUp\") {\n        if (filteredCommands.length > 0) {\n          e.preventDefault();\n          setSlashHighlightIndex((prev) => {\n            if (filteredCommands.length === 0) {\n              return prev;\n            }\n            if (prev === -1) {\n              return filteredCommands.length - 1;\n            }\n            return prev <= 0 ? filteredCommands.length - 1 : prev - 1;\n          });\n        }\n        return;\n      }\n\n      if (e.key === \"Enter\") {\n        const selected = slashHighlightIndex >= 0 ? filteredCommands[slashHighlightIndex] : undefined;\n        if (selected) {\n          e.preventDefault();\n          runCommand(selected);\n          return;\n        }\n      }\n\n      if (e.key === \"Escape\") {\n        e.preventDefault();\n        setCommandQuery(null);\n        return;\n      }\n    }\n\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      if (isProcessing) {\n        onStop?.();\n      } else {\n        send();\n      }\n    }\n  };\n\n  const send = () => {\n    if (!onSubmitMessage) {\n      return;\n    }\n    const trimmed = resolvedValue.trim();\n    if (!trimmed) {\n      return;\n    }\n\n    onSubmitMessage(trimmed);\n\n    if (!isControlled) {\n      setInternalValue(\"\");\n      onChange?.(\"\");\n    }\n\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  };\n\n  const BoundTextArea = renderSlot(textArea, CopilotChatInput.TextArea, {\n    ref: inputRef,\n    value: resolvedValue,\n    onChange: handleChange,\n    onKeyDown: handleKeyDown,\n    autoFocus: autoFocus,\n    className: twMerge(\n      \"w-full py-3\",\n      isExpanded ? \"px-5\" : \"pr-5\",\n    ),\n  });\n\n  const isProcessing = mode !== \"transcribe\" && isRunning;\n  const canSend = resolvedValue.trim().length > 0 && !!onSubmitMessage;\n  const canStop = !!onStop;\n\n  const handleSendButtonClick = () => {\n    if (isProcessing) {\n      onStop?.();\n      return;\n    }\n    send();\n  };\n\n  const BoundAudioRecorder = renderSlot(audioRecorder, CopilotChatAudioRecorder, {\n    ref: audioRecorderRef,\n  });\n\n  const BoundSendButton = renderSlot(sendButton, CopilotChatInput.SendButton, {\n    onClick: handleSendButtonClick,\n    disabled: isProcessing ? !canStop : !canSend,\n    children: isProcessing && canStop ? <Square className=\"size-[18px] fill-current\" /> : undefined,\n  });\n\n  const BoundStartTranscribeButton = renderSlot(startTranscribeButton, CopilotChatInput.StartTranscribeButton, {\n    onClick: onStartTranscribe,\n  });\n\n  const BoundCancelTranscribeButton = renderSlot(cancelTranscribeButton, CopilotChatInput.CancelTranscribeButton, {\n    onClick: onCancelTranscribe,\n  });\n\n  // Handler for finish button - stops recording and passes audio blob\n  const handleFinishTranscribe = useCallback(async () => {\n    const recorder = audioRecorderRef.current;\n    if (recorder && recorder.state === \"recording\") {\n      try {\n        const audioBlob = await recorder.stop();\n        if (onFinishTranscribeWithAudio) {\n          await onFinishTranscribeWithAudio(audioBlob);\n        }\n      } catch (error) {\n        console.error(\"Failed to stop recording:\", error);\n      }\n    }\n    // Always call the original handler to reset mode\n    onFinishTranscribe?.();\n  }, [onFinishTranscribe, onFinishTranscribeWithAudio]);\n\n  const BoundFinishTranscribeButton = renderSlot(finishTranscribeButton, CopilotChatInput.FinishTranscribeButton, {\n    onClick: handleFinishTranscribe,\n  });\n\n  const BoundAddMenuButton = renderSlot(addMenuButton, CopilotChatInput.AddMenuButton, {\n    disabled: mode === \"transcribe\",\n    onAddFile,\n    toolsMenu,\n  });\n\n  if (children) {\n    const childProps = {\n      textArea: BoundTextArea,\n      audioRecorder: BoundAudioRecorder,\n      sendButton: BoundSendButton,\n      startTranscribeButton: BoundStartTranscribeButton,\n      cancelTranscribeButton: BoundCancelTranscribeButton,\n      finishTranscribeButton: BoundFinishTranscribeButton,\n      addMenuButton: BoundAddMenuButton,\n      onSubmitMessage,\n      onStop,\n      isRunning,\n      onStartTranscribe,\n      onCancelTranscribe,\n      onFinishTranscribe,\n      onAddFile,\n      mode,\n      toolsMenu,\n      autoFocus,\n    } as CopilotChatInputChildrenArgs;\n\n    return <>{children(childProps)}</>;\n  }\n\n  const handleContainerClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    // Don't focus if clicking on buttons or other interactive elements\n    const target = e.target as HTMLElement;\n    if (target.tagName !== \"BUTTON\" && !target.closest(\"button\") && inputRef.current && mode === \"input\") {\n      inputRef.current.focus();\n    }\n  };\n\n  const ensureMeasurements = useCallback(() => {\n    const textarea = inputRef.current;\n    if (!textarea) {\n      return;\n    }\n\n    const previousValue = textarea.value;\n    const previousHeight = textarea.style.height;\n\n    textarea.style.height = \"auto\";\n\n    const computedStyle = window.getComputedStyle(textarea);\n    const paddingLeft = parseFloat(computedStyle.paddingLeft) || 0;\n    const paddingRight = parseFloat(computedStyle.paddingRight) || 0;\n    const paddingTop = parseFloat(computedStyle.paddingTop) || 0;\n    const paddingBottom = parseFloat(computedStyle.paddingBottom) || 0;\n\n    textarea.value = \"\";\n    const singleLineHeight = textarea.scrollHeight;\n    textarea.value = previousValue;\n\n    const contentHeight = singleLineHeight - paddingTop - paddingBottom;\n    const maxHeight = contentHeight * 5 + paddingTop + paddingBottom;\n\n    measurementsRef.current = {\n      singleLineHeight,\n      maxHeight,\n      paddingLeft,\n      paddingRight,\n    };\n\n    textarea.style.height = previousHeight;\n    textarea.style.maxHeight = `${maxHeight}px`;\n  }, []);\n\n  const adjustTextareaHeight = useCallback(() => {\n    const textarea = inputRef.current;\n    if (!textarea) {\n      return 0;\n    }\n\n    if (measurementsRef.current.singleLineHeight === 0) {\n      ensureMeasurements();\n    }\n\n    const { maxHeight } = measurementsRef.current;\n    if (maxHeight) {\n      textarea.style.maxHeight = `${maxHeight}px`;\n    }\n\n    textarea.style.height = \"auto\";\n    const scrollHeight = textarea.scrollHeight;\n    if (maxHeight) {\n      textarea.style.height = `${Math.min(scrollHeight, maxHeight)}px`;\n    } else {\n      textarea.style.height = `${scrollHeight}px`;\n    }\n\n    return scrollHeight;\n  }, [ensureMeasurements]);\n\n  const updateLayout = useCallback((nextLayout: \"compact\" | \"expanded\") => {\n    setLayout((prev) => {\n      if (prev === nextLayout) {\n        return prev;\n      }\n      ignoreResizeRef.current = true;\n      return nextLayout;\n    });\n  }, []);\n\n  const evaluateLayout = useCallback(() => {\n    if (mode !== \"input\") {\n      updateLayout(\"compact\");\n      return;\n    }\n\n    if (typeof window !== \"undefined\" && typeof window.matchMedia === \"function\") {\n      const isMobileViewport = window.matchMedia(\"(max-width: 767px)\").matches;\n      if (isMobileViewport) {\n        ensureMeasurements();\n        adjustTextareaHeight();\n        updateLayout(\"expanded\");\n        return;\n      }\n    }\n\n    const textarea = inputRef.current;\n    const grid = gridRef.current;\n    const addContainer = addButtonContainerRef.current;\n    const actionsContainer = actionsContainerRef.current;\n\n    if (!textarea || !grid || !addContainer || !actionsContainer) {\n      return;\n    }\n\n    if (measurementsRef.current.singleLineHeight === 0) {\n      ensureMeasurements();\n    }\n\n    const scrollHeight = adjustTextareaHeight();\n    const baseline = measurementsRef.current.singleLineHeight;\n    const hasExplicitBreak = resolvedValue.includes(\"\\n\");\n    const renderedMultiline = baseline > 0 ? scrollHeight > baseline + 1 : false;\n    let shouldExpand = hasExplicitBreak || renderedMultiline;\n\n    if (!shouldExpand) {\n      const gridStyles = window.getComputedStyle(grid);\n      const paddingLeft = parseFloat(gridStyles.paddingLeft) || 0;\n      const paddingRight = parseFloat(gridStyles.paddingRight) || 0;\n      const columnGap = parseFloat(gridStyles.columnGap) || 0;\n      const gridAvailableWidth = grid.clientWidth - paddingLeft - paddingRight;\n\n      if (gridAvailableWidth > 0) {\n        const addWidth = addContainer.getBoundingClientRect().width;\n        const actionsWidth = actionsContainer.getBoundingClientRect().width;\n        const compactWidth = Math.max(gridAvailableWidth - addWidth - actionsWidth - columnGap * 2, 0);\n\n        const canvas = measurementCanvasRef.current ?? document.createElement(\"canvas\");\n        if (!measurementCanvasRef.current) {\n          measurementCanvasRef.current = canvas;\n        }\n\n        const context = canvas.getContext(\"2d\");\n        if (context) {\n          const textareaStyles = window.getComputedStyle(textarea);\n          const font =\n            textareaStyles.font ||\n            `${textareaStyles.fontStyle} ${textareaStyles.fontVariant} ${textareaStyles.fontWeight} ${textareaStyles.fontSize}/${textareaStyles.lineHeight} ${textareaStyles.fontFamily}`;\n          context.font = font;\n\n          const compactInnerWidth = Math.max(\n            compactWidth - (measurementsRef.current.paddingLeft || 0) - (measurementsRef.current.paddingRight || 0),\n            0,\n          );\n\n          if (compactInnerWidth > 0) {\n            const lines = resolvedValue.length > 0 ? resolvedValue.split(\"\\n\") : [\"\"];\n            let longestWidth = 0;\n            for (const line of lines) {\n              const metrics = context.measureText(line || \" \");\n              if (metrics.width > longestWidth) {\n                longestWidth = metrics.width;\n              }\n            }\n\n            if (longestWidth > compactInnerWidth) {\n              shouldExpand = true;\n            }\n          }\n        }\n      }\n    }\n\n    const nextLayout = shouldExpand ? \"expanded\" : \"compact\";\n    updateLayout(nextLayout);\n  }, [adjustTextareaHeight, ensureMeasurements, mode, resolvedValue, updateLayout]);\n\n  useLayoutEffect(() => {\n    evaluateLayout();\n  }, [evaluateLayout]);\n\n  useEffect(() => {\n    if (typeof ResizeObserver === \"undefined\") {\n      return;\n    }\n\n    const textarea = inputRef.current;\n    const grid = gridRef.current;\n    const addContainer = addButtonContainerRef.current;\n    const actionsContainer = actionsContainerRef.current;\n\n    if (!textarea || !grid || !addContainer || !actionsContainer) {\n      return;\n    }\n\n    const scheduleEvaluation = () => {\n      if (ignoreResizeRef.current) {\n        ignoreResizeRef.current = false;\n        return;\n      }\n\n      if (typeof window === \"undefined\") {\n        evaluateLayout();\n        return;\n      }\n\n      if (resizeEvaluationRafRef.current !== null) {\n        cancelAnimationFrame(resizeEvaluationRafRef.current);\n      }\n\n      resizeEvaluationRafRef.current = window.requestAnimationFrame(() => {\n        resizeEvaluationRafRef.current = null;\n        evaluateLayout();\n      });\n    };\n\n    const observer = new ResizeObserver(() => {\n      scheduleEvaluation();\n    });\n\n    observer.observe(grid);\n    observer.observe(addContainer);\n    observer.observe(actionsContainer);\n    observer.observe(textarea);\n\n    return () => {\n      observer.disconnect();\n      if (typeof window !== \"undefined\" && resizeEvaluationRafRef.current !== null) {\n        cancelAnimationFrame(resizeEvaluationRafRef.current);\n        resizeEvaluationRafRef.current = null;\n      }\n    };\n  }, [evaluateLayout]);\n\n  const slashMenuVisible = commandQuery !== null && commandItems.length > 0;\n\n  useEffect(() => {\n    if (!slashMenuVisible || slashHighlightIndex < 0) {\n      return;\n    }\n\n    const active = slashMenuRef.current?.querySelector<HTMLElement>(\n      `[data-slash-index=\"${slashHighlightIndex}\"]`,\n    );\n    active?.scrollIntoView({ block: \"nearest\" });\n  }, [slashMenuVisible, slashHighlightIndex]);\n\n  const slashMenu = slashMenuVisible ? (\n    <div\n      data-testid=\"copilot-slash-menu\"\n      role=\"listbox\"\n      aria-label=\"Slash commands\"\n      ref={slashMenuRef}\n      className=\"absolute bottom-full left-0 right-0 z-30 mb-2 max-h-64 overflow-y-auto rounded-lg border border-border bg-white shadow-lg dark:border-[#3a3a3a] dark:bg-[#1f1f1f]\"\n      style={{ maxHeight: `${SLASH_MENU_MAX_VISIBLE_ITEMS * SLASH_MENU_ITEM_HEIGHT_PX}px` }}\n    >\n      {filteredCommands.length === 0 ? (\n        <div className=\"px-3 py-2 text-sm text-muted-foreground\">No commands found</div>\n      ) : (\n        filteredCommands.map((item, index) => {\n          const isActive = index === slashHighlightIndex;\n          return (\n            <button\n              key={`${item.label}-${index}`}\n              type=\"button\"\n              role=\"option\"\n              aria-selected={isActive}\n              data-active={isActive ? \"true\" : undefined}\n              data-slash-index={index}\n              className={twMerge(\n                \"w-full px-3 py-2 text-left text-sm transition-colors\",\n                \"hover:bg-muted dark:hover:bg-[#2f2f2f]\",\n                isActive ? \"bg-muted dark:bg-[#2f2f2f]\" : \"bg-transparent\",\n              )}\n              onMouseEnter={() => setSlashHighlightIndex(index)}\n              onMouseDown={(event) => {\n                event.preventDefault();\n                runCommand(item);\n              }}\n            >\n              {item.label}\n            </button>\n          );\n        })\n      )}\n    </div>\n  ) : null;\n\n  return (\n    <div\n      className={twMerge(\n        // Layout\n        \"flex w-full flex-col items-center justify-center\",\n        // Interaction\n        \"cursor-text\",\n        // Overflow and clipping\n        \"overflow-visible bg-clip-padding contain-inline-size\",\n        // Background\n        \"bg-white dark:bg-[#303030]\",\n        // Visual effects\n        \"shadow-[0_4px_4px_0_#0000000a,0_0_1px_0_#0000009e] rounded-[28px]\",\n        className,\n      )}\n      onClick={handleContainerClick}\n      {...props}\n      data-layout={isExpanded ? \"expanded\" : \"compact\"}\n    >\n      <div\n        ref={gridRef}\n        className={twMerge(\n          \"grid w-full gap-x-3 gap-y-3 px-3 py-2\",\n          isExpanded\n            ? \"grid-cols-[auto_minmax(0,1fr)_auto] grid-rows-[auto_auto]\"\n            : \"grid-cols-[auto_minmax(0,1fr)_auto] items-center\",\n        )}\n        data-layout={isExpanded ? \"expanded\" : \"compact\"}\n      >\n        <div\n          ref={addButtonContainerRef}\n          className={twMerge(\n            \"flex items-center\",\n            isExpanded ? \"row-start-2\" : \"row-start-1\",\n            \"col-start-1\",\n          )}\n        >\n          {BoundAddMenuButton}\n        </div>\n        <div\n          className={twMerge(\n            \"relative flex min-w-0 flex-col min-h-[50px] justify-center\",\n            isExpanded ? \"col-span-3 row-start-1\" : \"col-start-2 row-start-1\",\n          )}\n        >\n          {mode === \"transcribe\" ? (\n            BoundAudioRecorder\n          ) : mode === \"processing\" ? (\n            <div className=\"flex w-full items-center justify-center py-3 px-5\">\n              <Loader2 className=\"size-[26px] animate-spin text-muted-foreground\" />\n            </div>\n          ) : (\n            <>\n              {BoundTextArea}\n              {slashMenu}\n            </>\n          )}\n        </div>\n        <div\n          ref={actionsContainerRef}\n          className={twMerge(\n            \"flex items-center justify-end gap-2\",\n            isExpanded ? \"col-start-3 row-start-2\" : \"col-start-3 row-start-1\",\n          )}\n        >\n          {mode === \"transcribe\" ? (\n            <>\n              {onCancelTranscribe && BoundCancelTranscribeButton}\n              {onFinishTranscribe && BoundFinishTranscribeButton}\n            </>\n          ) : (\n            <>\n              {onStartTranscribe && BoundStartTranscribeButton}\n              {BoundSendButton}\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace CopilotChatInput {\n  export const SendButton: React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>> = ({ className, children, ...props }) => (\n    <div className=\"mr-[10px]\">\n      <Button\n        type=\"button\"\n        variant=\"chatInputToolbarPrimary\"\n        size=\"chatInputToolbarIcon\"\n        className={className}\n        {...props}\n      >\n        {children ?? <ArrowUp className=\"size-[18px]\" />}\n      </Button>\n    </div>\n  );\n\n  export const ToolbarButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement> & {\n      icon: React.ReactNode;\n      labelKey: keyof CopilotChatLabels;\n      defaultClassName?: string;\n    }\n  > = ({ icon, labelKey, defaultClassName, className, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            type=\"button\"\n            variant=\"chatInputToolbarSecondary\"\n            size=\"chatInputToolbarIcon\"\n            className={twMerge(defaultClassName, className)}\n            {...props}\n          >\n            {icon}\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent side=\"bottom\">\n          <p>{labels[labelKey]}</p>\n        </TooltipContent>\n      </Tooltip>\n    );\n  };\n\n  export const StartTranscribeButton: React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>> = (props) => (\n    <ToolbarButton\n      icon={<Mic className=\"size-[18px]\" />}\n      labelKey=\"chatInputToolbarStartTranscribeButtonLabel\"\n      defaultClassName=\"mr-2\"\n      {...props}\n    />\n  );\n\n  export const CancelTranscribeButton: React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>> = (props) => (\n    <ToolbarButton\n      icon={<X className=\"size-[18px]\" />}\n      labelKey=\"chatInputToolbarCancelTranscribeButtonLabel\"\n      defaultClassName=\"mr-2\"\n      {...props}\n    />\n  );\n\n  export const FinishTranscribeButton: React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>> = (props) => (\n    <ToolbarButton\n      icon={<Check className=\"size-[18px]\" />}\n      labelKey=\"chatInputToolbarFinishTranscribeButtonLabel\"\n      defaultClassName=\"mr-[10px]\"\n      {...props}\n    />\n  );\n\n  export const AddMenuButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement> & {\n      toolsMenu?: (ToolsMenuItem | \"-\")[];\n      onAddFile?: () => void;\n    }\n  > = ({ className, toolsMenu, onAddFile, disabled, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n\n    const menuItems = useMemo<(ToolsMenuItem | \"-\")[]>(() => {\n      const items: (ToolsMenuItem | \"-\")[] = [];\n\n      if (onAddFile) {\n        items.push({\n          label: labels.chatInputToolbarAddButtonLabel,\n          action: onAddFile,\n        });\n      }\n\n      if (toolsMenu && toolsMenu.length > 0) {\n        if (items.length > 0) {\n          items.push(\"-\");\n        }\n\n        for (const item of toolsMenu) {\n          if (item === \"-\") {\n            if (items.length === 0 || items[items.length - 1] === \"-\") {\n              continue;\n            }\n            items.push(item);\n          } else {\n            items.push(item);\n          }\n        }\n\n        while (items.length > 0 && items[items.length - 1] === \"-\") {\n          items.pop();\n        }\n      }\n\n      return items;\n    }, [onAddFile, toolsMenu, labels.chatInputToolbarAddButtonLabel]);\n\n    const renderMenuItems = useCallback(\n      (items: (ToolsMenuItem | \"-\")[]): React.ReactNode =>\n        items.map((item, index) => {\n          if (item === \"-\") {\n            return <DropdownMenuSeparator key={`separator-${index}`} />;\n          }\n\n          if (item.items && item.items.length > 0) {\n            return (\n              <DropdownMenuSub key={`group-${index}`}>\n                <DropdownMenuSubTrigger>{item.label}</DropdownMenuSubTrigger>\n                <DropdownMenuSubContent>{renderMenuItems(item.items)}</DropdownMenuSubContent>\n              </DropdownMenuSub>\n            );\n          }\n\n          return (\n            <DropdownMenuItem key={`item-${index}`} onClick={item.action}>\n              {item.label}\n            </DropdownMenuItem>\n          );\n        }),\n      [],\n    );\n\n    const hasMenuItems = menuItems.length > 0;\n    const isDisabled = disabled || !hasMenuItems;\n\n    return (\n      <DropdownMenu>\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <DropdownMenuTrigger asChild>\n              <Button\n                type=\"button\"\n                variant=\"chatInputToolbarSecondary\"\n                size=\"chatInputToolbarIcon\"\n                className={twMerge(\"ml-1\", className)}\n                disabled={isDisabled}\n                {...props}\n              >\n                <Plus className=\"size-[20px]\" />\n              </Button>\n            </DropdownMenuTrigger>\n          </TooltipTrigger>\n          <TooltipContent side=\"bottom\">\n            <p className=\"flex items-center gap-1 text-xs font-medium\">\n              <span>Add files and more</span>\n              <code className=\"rounded bg-[#4a4a4a] px-1 py-[1px] font-mono text-[11px] text-white dark:bg-[#e0e0e0] dark:text-black\">/</code>\n            </p>\n          </TooltipContent>\n        </Tooltip>\n        {hasMenuItems && (\n          <DropdownMenuContent side=\"top\" align=\"start\">\n            {renderMenuItems(menuItems)}\n          </DropdownMenuContent>\n        )}\n      </DropdownMenu>\n    );\n  };\n\n  export type TextAreaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>;\n\n  export const TextArea = forwardRef<HTMLTextAreaElement, TextAreaProps>(function TextArea(\n    { style, className, autoFocus, ...props },\n    ref,\n  ) {\n    const internalTextareaRef = useRef<HTMLTextAreaElement>(null);\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n\n    useImperativeHandle(ref, () => internalTextareaRef.current as HTMLTextAreaElement);\n\n    // Auto-scroll input into view on mobile when focused\n    useEffect(() => {\n      const textarea = internalTextareaRef.current;\n      if (!textarea) return;\n\n      const handleFocus = () => {\n        // Small delay to let the keyboard start appearing\n        setTimeout(() => {\n          textarea.scrollIntoView({ behavior: \"smooth\", block: \"nearest\" });\n        }, 300);\n      };\n\n      textarea.addEventListener(\"focus\", handleFocus);\n      return () => textarea.removeEventListener(\"focus\", handleFocus);\n    }, []);\n\n    useEffect(() => {\n      if (autoFocus) {\n        internalTextareaRef.current?.focus();\n      }\n    }, [autoFocus]);\n\n    return (\n      <textarea\n        ref={internalTextareaRef}\n        {...props}\n        style={{\n          overflow: \"auto\",\n          resize: \"none\",\n          ...style,\n        }}\n        placeholder={labels.chatInputPlaceholder}\n        className={twMerge(\n          \"bg-transparent outline-none antialiased font-regular leading-relaxed text-[16px] placeholder:text-[#00000077] dark:placeholder:text-[#fffc]\",\n          className,\n        )}\n        rows={1}\n      />\n    );\n  });\n\n  export const AudioRecorder = CopilotChatAudioRecorder;\n}\n\nCopilotChatInput.TextArea.displayName = \"CopilotChatInput.TextArea\";\nCopilotChatInput.SendButton.displayName = \"CopilotChatInput.SendButton\";\nCopilotChatInput.ToolbarButton.displayName = \"CopilotChatInput.ToolbarButton\";\nCopilotChatInput.StartTranscribeButton.displayName = \"CopilotChatInput.StartTranscribeButton\";\nCopilotChatInput.CancelTranscribeButton.displayName = \"CopilotChatInput.CancelTranscribeButton\";\nCopilotChatInput.FinishTranscribeButton.displayName = \"CopilotChatInput.FinishTranscribeButton\";\nCopilotChatInput.AddMenuButton.displayName = \"CopilotChatInput.AddMenuButton\";\n\nexport default CopilotChatInput;\n","import React, { createContext, useContext, ReactNode, useMemo, useState } from \"react\";\nimport { DEFAULT_AGENT_ID, randomUUID } from \"@copilotkitnext/shared\";\n\n// Default labels\nexport const CopilotChatDefaultLabels = {\n  chatInputPlaceholder: \"Type a message...\",\n  chatInputToolbarStartTranscribeButtonLabel: \"Transcribe\",\n  chatInputToolbarCancelTranscribeButtonLabel: \"Cancel\",\n  chatInputToolbarFinishTranscribeButtonLabel: \"Finish\",\n  chatInputToolbarAddButtonLabel: \"Add photos or files\",\n  chatInputToolbarToolsButtonLabel: \"Tools\",\n  assistantMessageToolbarCopyCodeLabel: \"Copy\",\n  assistantMessageToolbarCopyCodeCopiedLabel: \"Copied\",\n  assistantMessageToolbarCopyMessageLabel: \"Copy\",\n  assistantMessageToolbarThumbsUpLabel: \"Good response\",\n  assistantMessageToolbarThumbsDownLabel: \"Bad response\",\n  assistantMessageToolbarReadAloudLabel: \"Read aloud\",\n  assistantMessageToolbarRegenerateLabel: \"Regenerate\",\n  userMessageToolbarCopyMessageLabel: \"Copy\",\n  userMessageToolbarEditMessageLabel: \"Edit\",\n  chatDisclaimerText: \"AI can make mistakes. Please verify important information.\",\n  chatToggleOpenLabel: \"Open chat\",\n  chatToggleCloseLabel: \"Close chat\",\n  modalHeaderTitle: \"CopilotKit Chat\",\n  welcomeMessageText: \"How can I help you today?\",\n};\n\nexport type CopilotChatLabels = typeof CopilotChatDefaultLabels;\n\n// Define the full configuration interface\nexport interface CopilotChatConfigurationValue {\n  labels: CopilotChatLabels;\n  agentId: string;\n  threadId: string;\n  isModalOpen: boolean;\n  setModalOpen: (open: boolean) => void;\n  isModalDefaultOpen: boolean;\n}\n\n// Create the configuration context\nconst CopilotChatConfiguration =\n  createContext<CopilotChatConfigurationValue | null>(null);\n\n// Provider props interface\nexport interface CopilotChatConfigurationProviderProps {\n  children: ReactNode;\n  labels?: Partial<CopilotChatLabels>;\n  agentId?: string;\n  threadId?: string;\n  isModalDefaultOpen?: boolean;\n}\n\n// Provider component\nexport const CopilotChatConfigurationProvider: React.FC<\n  CopilotChatConfigurationProviderProps\n> = ({ children, labels, agentId, threadId, isModalDefaultOpen }) => {\n  const parentConfig = useContext(CopilotChatConfiguration);\n\n  const mergedLabels: CopilotChatLabels = useMemo(\n    () => ({\n      ...CopilotChatDefaultLabels,\n      ...(parentConfig?.labels ?? {}),\n      ...(labels ?? {}),\n    }),\n    [labels, parentConfig?.labels],\n  );\n\n  const resolvedAgentId = agentId ?? parentConfig?.agentId ?? DEFAULT_AGENT_ID;\n\n  const resolvedThreadId = useMemo(() => {\n    if (threadId) {\n      return threadId;\n    }\n    if (parentConfig?.threadId) {\n      return parentConfig.threadId;\n    }\n    return randomUUID();\n  }, [threadId, parentConfig?.threadId]);\n\n  const resolvedDefaultOpen = isModalDefaultOpen ?? parentConfig?.isModalDefaultOpen ?? true;\n\n  const [internalModalOpen, setInternalModalOpen] = useState<boolean>(\n    parentConfig?.isModalOpen ?? resolvedDefaultOpen,\n  );\n\n  const resolvedIsModalOpen = parentConfig?.isModalOpen ?? internalModalOpen;\n  const resolvedSetModalOpen = parentConfig?.setModalOpen ?? setInternalModalOpen;\n\n  const configurationValue: CopilotChatConfigurationValue = useMemo(\n    () => ({\n      labels: mergedLabels,\n      agentId: resolvedAgentId,\n      threadId: resolvedThreadId,\n      isModalOpen: resolvedIsModalOpen,\n      setModalOpen: resolvedSetModalOpen,\n      isModalDefaultOpen: resolvedDefaultOpen,\n    }),\n    [\n      mergedLabels,\n      resolvedAgentId,\n      resolvedThreadId,\n      resolvedIsModalOpen,\n      resolvedSetModalOpen,\n      resolvedDefaultOpen,\n    ],\n  );\n\n  return (\n    <CopilotChatConfiguration.Provider value={configurationValue}>\n      {children}\n    </CopilotChatConfiguration.Provider>\n  );\n};\n\n// Hook to use the full configuration\nexport const useCopilotChatConfiguration =\n  (): CopilotChatConfigurationValue | null => {\n    const configuration = useContext(CopilotChatConfiguration);\n    return configuration;\n  };\n","import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80\",\n        ghost:\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 cursor-pointer\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n        assistantMessageToolbarButton: [\n          \"cursor-pointer\",\n          // Background and text\n          \"p-0 text-[rgb(93,93,93)] hover:bg-[#E8E8E8]\",\n          // Dark mode - lighter gray for better contrast\n          \"dark:text-[rgb(243,243,243)] dark:hover:bg-[#303030]\",\n          // Shape and sizing\n          \"h-8 w-8\",\n          // Interactions\n          \"transition-colors\",\n          // Hover states\n          \"hover:text-[rgb(93,93,93)]\",\n          \"dark:hover:text-[rgb(243,243,243)]\",\n        ],\n        chatInputToolbarPrimary: [\n          \"cursor-pointer\",\n          // Background and text\n          \"bg-black text-white\",\n          // Dark mode\n          \"dark:bg-white dark:text-black dark:focus-visible:outline-white\",\n          // Shape and sizing\n          \"rounded-full\",\n          // Interactions\n          \"transition-colors\",\n          // Focus states\n          \"focus:outline-none\",\n          // Hover states\n          \"hover:opacity-70 disabled:hover:opacity-100\",\n          // Disabled states\n          \"disabled:cursor-not-allowed disabled:bg-[#00000014] disabled:text-[rgb(13,13,13)]\",\n          \"dark:disabled:bg-[#454545] dark:disabled:text-white \",\n        ],\n        chatInputToolbarSecondary: [\n          \"cursor-pointer\",\n          // Background and text\n          \"bg-transparent text-[#444444]\",\n          // Dark mode\n          \"dark:text-white dark:border-[#404040]\",\n          // Shape and sizing\n          \"rounded-full\",\n          // Interactions\n          \"transition-colors\",\n          // Focus states\n          \"focus:outline-none\",\n          // Hover states\n          \"hover:bg-[#f8f8f8] hover:text-[#333333]\",\n          \"dark:hover:bg-[#404040] dark:hover:text-[#FFFFFF]\",\n          // Disabled states\n          \"disabled:cursor-not-allowed disabled:opacity-50\",\n          \"disabled:hover:bg-transparent disabled:hover:text-[#444444]\",\n          \"dark:disabled:hover:bg-transparent dark:disabled:hover:text-[#CCCCCC]\",\n        ],\n      },\n      size: {\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\n        icon: \"size-9\",\n        chatInputToolbarIcon: [\n          // Shape and sizing\n          \"h-9 w-9 rounded-full\",\n        ],\n        chatInputToolbarIconLabel: [\n          // Shape and sizing\n          \"h-9 px-3 rounded-full\",\n          // Layout\n          \"gap-2\",\n          // Typography\n          \"font-normal\",\n        ],\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n);\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean;\n  }) {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  );\n}\n\nexport { Button, buttonVariants };\n","import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n","import * as React from \"react\";\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\";\n\nimport { cn } from \"@/lib/utils\";\n\nfunction TooltipProvider({\n  delayDuration = 0,\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {\n  return (\n    <TooltipPrimitive.Provider\n      data-slot=\"tooltip-provider\"\n      delayDuration={delayDuration}\n      {...props}\n    />\n  );\n}\n\nfunction Tooltip({\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Root>) {\n  return (\n    <TooltipProvider>\n      <TooltipPrimitive.Root data-slot=\"tooltip\" {...props} />\n    </TooltipProvider>\n  );\n}\n\nfunction TooltipTrigger({\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {\n  return <TooltipPrimitive.Trigger data-slot=\"tooltip-trigger\" {...props} />;\n}\n\nfunction TooltipContent({\n  className,\n  sideOffset = 0,\n  children,\n  ...props\n}: React.ComponentProps<typeof TooltipPrimitive.Content>) {\n  return (\n    <TooltipPrimitive.Portal>\n      <TooltipPrimitive.Content\n        data-slot=\"tooltip-content\"\n        sideOffset={sideOffset}\n        className={cn(\n          \"bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n        <TooltipPrimitive.Arrow className=\"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]\" />\n      </TooltipPrimitive.Content>\n    </TooltipPrimitive.Portal>\n  );\n}\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };\n","\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { CheckIcon, ChevronRightIcon, CircleIcon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction DropdownMenu({\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {\n  return <DropdownMenuPrimitive.Root data-slot=\"dropdown-menu\" {...props} />\n}\n\nfunction DropdownMenuPortal({\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {\n  return (\n    <DropdownMenuPrimitive.Portal data-slot=\"dropdown-menu-portal\" {...props} />\n  )\n}\n\nfunction DropdownMenuTrigger({\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {\n  return (\n    <DropdownMenuPrimitive.Trigger\n      data-slot=\"dropdown-menu-trigger\"\n      {...props}\n    />\n  )\n}\n\nfunction DropdownMenuContent({\n  className,\n  sideOffset = 4,\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {\n  return (\n    <DropdownMenuPrimitive.Portal>\n      <DropdownMenuPrimitive.Content\n        data-slot=\"dropdown-menu-content\"\n        sideOffset={sideOffset}\n        className={cn(\n          \"bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md\",\n          className\n        )}\n        {...props}\n      />\n    </DropdownMenuPrimitive.Portal>\n  )\n}\n\nfunction DropdownMenuGroup({\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {\n  return (\n    <DropdownMenuPrimitive.Group data-slot=\"dropdown-menu-group\" {...props} />\n  )\n}\n\nfunction DropdownMenuItem({\n  className,\n  inset,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {\n  inset?: boolean\n  variant?: \"default\" | \"destructive\"\n}) {\n  return (\n    <DropdownMenuPrimitive.Item\n      data-slot=\"dropdown-menu-item\"\n      data-inset={inset}\n      data-variant={variant}\n      className={cn(\n        \"focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction DropdownMenuCheckboxItem({\n  className,\n  children,\n  checked,\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {\n  return (\n    <DropdownMenuPrimitive.CheckboxItem\n      data-slot=\"dropdown-menu-checkbox-item\"\n      className={cn(\n        \"focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\n        className\n      )}\n      checked={checked}\n      {...props}\n    >\n      <span className=\"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center\">\n        <DropdownMenuPrimitive.ItemIndicator>\n          <CheckIcon className=\"size-4\" />\n        </DropdownMenuPrimitive.ItemIndicator>\n      </span>\n      {children}\n    </DropdownMenuPrimitive.CheckboxItem>\n  )\n}\n\nfunction DropdownMenuRadioGroup({\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {\n  return (\n    <DropdownMenuPrimitive.RadioGroup\n      data-slot=\"dropdown-menu-radio-group\"\n      {...props}\n    />\n  )\n}\n\nfunction DropdownMenuRadioItem({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {\n  return (\n    <DropdownMenuPrimitive.RadioItem\n      data-slot=\"dropdown-menu-radio-item\"\n      className={cn(\n        \"focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\n        className\n      )}\n      {...props}\n    >\n      <span className=\"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center\">\n        <DropdownMenuPrimitive.ItemIndicator>\n          <CircleIcon className=\"size-2 fill-current\" />\n        </DropdownMenuPrimitive.ItemIndicator>\n      </span>\n      {children}\n    </DropdownMenuPrimitive.RadioItem>\n  )\n}\n\nfunction DropdownMenuLabel({\n  className,\n  inset,\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {\n  inset?: boolean\n}) {\n  return (\n    <DropdownMenuPrimitive.Label\n      data-slot=\"dropdown-menu-label\"\n      data-inset={inset}\n      className={cn(\n        \"px-2 py-1.5 text-sm font-medium data-[inset]:pl-8\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction DropdownMenuSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {\n  return (\n    <DropdownMenuPrimitive.Separator\n      data-slot=\"dropdown-menu-separator\"\n      className={cn(\"bg-border -mx-1 my-1 h-px\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction DropdownMenuShortcut({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      data-slot=\"dropdown-menu-shortcut\"\n      className={cn(\n        \"text-muted-foreground ml-auto text-xs tracking-widest\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction DropdownMenuSub({\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {\n  return <DropdownMenuPrimitive.Sub data-slot=\"dropdown-menu-sub\" {...props} />\n}\n\nfunction DropdownMenuSubTrigger({\n  className,\n  inset,\n  children,\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {\n  inset?: boolean\n}) {\n  return (\n    <DropdownMenuPrimitive.SubTrigger\n      data-slot=\"dropdown-menu-sub-trigger\"\n      data-inset={inset}\n      className={cn(\n        \"focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronRightIcon className=\"ml-auto size-4\" />\n    </DropdownMenuPrimitive.SubTrigger>\n  )\n}\n\nfunction DropdownMenuSubContent({\n  className,\n  ...props\n}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {\n  return (\n    <DropdownMenuPrimitive.SubContent\n      data-slot=\"dropdown-menu-sub-content\"\n      className={cn(\n        \"bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  DropdownMenu,\n  DropdownMenuPortal,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuLabel,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioGroup,\n  DropdownMenuRadioItem,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuSub,\n  DropdownMenuSubTrigger,\n  DropdownMenuSubContent,\n}\n","import { useRef, useEffect, useImperativeHandle, forwardRef, useCallback, useState } from \"react\";\nimport { twMerge } from \"tailwind-merge\";\n\n/** Finite-state machine for every recorder implementation */\nexport type AudioRecorderState = \"idle\" | \"recording\" | \"processing\";\n\n/** Error subclass so callers can `instanceof`-guard recorder failures */\nexport class AudioRecorderError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = \"AudioRecorderError\";\n  }\n}\n\nexport interface AudioRecorderRef {\n  state: AudioRecorderState;\n  start: () => Promise<void>;\n  stop: () => Promise<Blob>;\n  dispose: () => void;\n}\n\nexport const CopilotChatAudioRecorder = forwardRef<\n  AudioRecorderRef,\n  React.HTMLAttributes<HTMLDivElement>\n>((props, ref) => {\n  const { className, ...divProps } = props;\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  // Recording state\n  const [recorderState, setRecorderState] = useState<AudioRecorderState>(\"idle\");\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const streamRef = useRef<MediaStream | null>(null);\n  const analyserRef = useRef<AnalyserNode | null>(null);\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const animationIdRef = useRef<number | null>(null);\n\n  // Amplitude history buffer for scrolling waveform\n  const amplitudeHistoryRef = useRef<number[]>([]);\n  const frameCountRef = useRef<number>(0);\n  const scrollOffsetRef = useRef<number>(0);\n  const smoothedAmplitudeRef = useRef<number>(0);\n  const fadeOpacityRef = useRef<number>(0);\n\n  // Clean up all resources\n  const cleanup = useCallback(() => {\n    if (animationIdRef.current) {\n      cancelAnimationFrame(animationIdRef.current);\n      animationIdRef.current = null;\n    }\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\n      try {\n        mediaRecorderRef.current.stop();\n      } catch {\n        // Ignore errors during cleanup\n      }\n    }\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach((track) => track.stop());\n      streamRef.current = null;\n    }\n    if (audioContextRef.current && audioContextRef.current.state !== \"closed\") {\n      audioContextRef.current.close().catch(() => {\n        // Ignore close errors\n      });\n      audioContextRef.current = null;\n    }\n    mediaRecorderRef.current = null;\n    analyserRef.current = null;\n    audioChunksRef.current = [];\n    amplitudeHistoryRef.current = [];\n    frameCountRef.current = 0;\n    scrollOffsetRef.current = 0;\n    smoothedAmplitudeRef.current = 0;\n    fadeOpacityRef.current = 0;\n  }, []);\n\n  // Start recording\n  const start = useCallback(async () => {\n    if (recorderState !== \"idle\") {\n      throw new AudioRecorderError(\"Recorder is already active\");\n    }\n\n    try {\n      // Request microphone access\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      streamRef.current = stream;\n\n      // Set up audio context for visualization\n      const audioContext = new AudioContext();\n      audioContextRef.current = audioContext;\n      const source = audioContext.createMediaStreamSource(stream);\n      const analyser = audioContext.createAnalyser();\n      analyser.fftSize = 2048; // Higher resolution for time-domain waveform\n      source.connect(analyser);\n      analyserRef.current = analyser;\n\n      // Determine best MIME type for recording\n      const mimeType = MediaRecorder.isTypeSupported(\"audio/webm;codecs=opus\")\n        ? \"audio/webm;codecs=opus\"\n        : MediaRecorder.isTypeSupported(\"audio/webm\")\n          ? \"audio/webm\"\n          : MediaRecorder.isTypeSupported(\"audio/mp4\")\n            ? \"audio/mp4\"\n            : \"\";\n\n      const options: MediaRecorderOptions = mimeType ? { mimeType } : {};\n      const mediaRecorder = new MediaRecorder(stream, options);\n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n\n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n        }\n      };\n\n      // Start recording with timeslice to collect data periodically\n      mediaRecorder.start(100);\n      setRecorderState(\"recording\");\n    } catch (error) {\n      cleanup();\n      if (error instanceof Error && error.name === \"NotAllowedError\") {\n        throw new AudioRecorderError(\"Microphone permission denied\");\n      }\n      if (error instanceof Error && error.name === \"NotFoundError\") {\n        throw new AudioRecorderError(\"No microphone found\");\n      }\n      throw new AudioRecorderError(\n        error instanceof Error ? error.message : \"Failed to start recording\"\n      );\n    }\n  }, [recorderState, cleanup]);\n\n  // Stop recording and return audio blob\n  const stop = useCallback((): Promise<Blob> => {\n    return new Promise((resolve, reject) => {\n      const mediaRecorder = mediaRecorderRef.current;\n      if (!mediaRecorder || recorderState !== \"recording\") {\n        reject(new AudioRecorderError(\"No active recording\"));\n        return;\n      }\n\n      setRecorderState(\"processing\");\n\n      mediaRecorder.onstop = () => {\n        const mimeType = mediaRecorder.mimeType || \"audio/webm\";\n        const audioBlob = new Blob(audioChunksRef.current, { type: mimeType });\n\n        // Clean up but keep the blob\n        cleanup();\n        setRecorderState(\"idle\");\n        resolve(audioBlob);\n      };\n\n      mediaRecorder.onerror = () => {\n        cleanup();\n        setRecorderState(\"idle\");\n        reject(new AudioRecorderError(\"Recording failed\"));\n      };\n\n      mediaRecorder.stop();\n    });\n  }, [recorderState, cleanup]);\n\n  // Calculate RMS amplitude from time-domain data\n  const calculateAmplitude = (dataArray: Uint8Array): number => {\n    let sum = 0;\n    for (let i = 0; i < dataArray.length; i++) {\n      // Normalize to -1 to 1 range (128 is center/silence)\n      const sample = (dataArray[i] ?? 128) / 128 - 1;\n      sum += sample * sample;\n    }\n    return Math.sqrt(sum / dataArray.length);\n  };\n\n  // Canvas rendering with animation\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    // Configuration\n    const barWidth = 2;\n    const barGap = 1;\n    const barSpacing = barWidth + barGap;\n    const scrollSpeed = 1 / 3; // Pixels per frame\n\n    const draw = () => {\n      const rect = canvas.getBoundingClientRect();\n      const dpr = window.devicePixelRatio || 1;\n\n      // Update canvas dimensions if container resized\n      if (canvas.width !== rect.width * dpr || canvas.height !== rect.height * dpr) {\n        canvas.width = rect.width * dpr;\n        canvas.height = rect.height * dpr;\n        ctx.scale(dpr, dpr);\n      }\n\n      // Calculate how many bars fit in the canvas (plus extra for smooth scrolling)\n      const maxBars = Math.floor(rect.width / barSpacing) + 2;\n\n      // Get current amplitude if recording\n      if (analyserRef.current && recorderState === \"recording\") {\n        // Pre-fill history with zeros on first frame so line is visible immediately\n        if (amplitudeHistoryRef.current.length === 0) {\n          amplitudeHistoryRef.current = new Array(maxBars).fill(0);\n        }\n\n        // Fade in the waveform smoothly\n        if (fadeOpacityRef.current < 1) {\n          fadeOpacityRef.current = Math.min(1, fadeOpacityRef.current + 0.03);\n        }\n\n        // Smooth scrolling - increment offset every frame\n        scrollOffsetRef.current += scrollSpeed;\n\n        // Sample amplitude every frame for smoothing\n        const bufferLength = analyserRef.current.fftSize;\n        const dataArray = new Uint8Array(bufferLength);\n        analyserRef.current.getByteTimeDomainData(dataArray);\n        const rawAmplitude = calculateAmplitude(dataArray);\n\n        // Smoothing: gradual attack and decay\n        const attackSpeed = 0.12; // Smooth rise\n        const decaySpeed = 0.08; // Smooth fade out\n        const speed = rawAmplitude > smoothedAmplitudeRef.current ? attackSpeed : decaySpeed;\n        smoothedAmplitudeRef.current += (rawAmplitude - smoothedAmplitudeRef.current) * speed;\n\n        // When offset reaches a full bar width, add a new sample and reset offset\n        if (scrollOffsetRef.current >= barSpacing) {\n          scrollOffsetRef.current -= barSpacing;\n          amplitudeHistoryRef.current.push(smoothedAmplitudeRef.current);\n\n          // Trim history to fit canvas\n          if (amplitudeHistoryRef.current.length > maxBars) {\n            amplitudeHistoryRef.current = amplitudeHistoryRef.current.slice(-maxBars);\n          }\n        }\n      }\n\n      // Clear canvas\n      ctx.clearRect(0, 0, rect.width, rect.height);\n\n      // Get current foreground color\n      const computedStyle = getComputedStyle(canvas);\n      ctx.fillStyle = computedStyle.color;\n      ctx.globalAlpha = fadeOpacityRef.current;\n\n      const centerY = rect.height / 2;\n      const maxAmplitude = rect.height / 2 - 2; // Leave some padding\n\n      const history = amplitudeHistoryRef.current;\n\n      // Only draw when recording (history has data)\n      if (history.length > 0) {\n        const offset = scrollOffsetRef.current;\n        const edgeFadeWidth = 12; // Pixels to fade at each edge\n\n        for (let i = 0; i < history.length; i++) {\n          const amplitude = history[i] ?? 0;\n          // Scale amplitude (RMS is typically 0-0.5 for normal speech)\n          const scaledAmplitude = Math.min(amplitude * 4, 1);\n          const barHeight = Math.max(2, scaledAmplitude * maxAmplitude * 2);\n\n          // Position: right-aligned with smooth scroll offset\n          const x = rect.width - (history.length - i) * barSpacing - offset;\n          const y = centerY - barHeight / 2;\n\n          // Only draw if visible\n          if (x + barWidth > 0 && x < rect.width) {\n            // Calculate edge fade opacity\n            let edgeOpacity = 1;\n            if (x < edgeFadeWidth) {\n              // Fade out on left edge\n              edgeOpacity = Math.max(0, x / edgeFadeWidth);\n            } else if (x > rect.width - edgeFadeWidth) {\n              // Fade in on right edge\n              edgeOpacity = Math.max(0, (rect.width - x) / edgeFadeWidth);\n            }\n\n            ctx.globalAlpha = fadeOpacityRef.current * edgeOpacity;\n            ctx.fillRect(x, y, barWidth, barHeight);\n          }\n        }\n      }\n\n      animationIdRef.current = requestAnimationFrame(draw);\n    };\n\n    draw();\n\n    return () => {\n      if (animationIdRef.current) {\n        cancelAnimationFrame(animationIdRef.current);\n      }\n    };\n  }, [recorderState]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n\n  // Expose AudioRecorder API via ref\n  useImperativeHandle(\n    ref,\n    () => ({\n      get state() {\n        return recorderState;\n      },\n      start,\n      stop,\n      dispose: cleanup,\n    }),\n    [recorderState, start, stop, cleanup]\n  );\n\n  return (\n    <div className={twMerge(\"w-full py-3 px-5\", className)} {...divProps}>\n      <canvas ref={canvasRef} className=\"block w-full h-[26px]\" />\n    </div>\n  );\n});\n\nCopilotChatAudioRecorder.displayName = \"CopilotChatAudioRecorder\";\n","import React from \"react\";\n\n/** Existing union (unchanged) */\nexport type SlotValue<C extends React.ComponentType<any>> =\n  | C\n  | string\n  | Partial<React.ComponentProps<C>>;\n\n/**\n * Shallow equality comparison for objects.\n */\nexport function shallowEqual<T extends Record<string, unknown>>(obj1: T, obj2: T): boolean {\n  const keys1 = Object.keys(obj1);\n  const keys2 = Object.keys(obj2);\n\n  if (keys1.length !== keys2.length) return false;\n\n  for (const key of keys1) {\n    if (obj1[key] !== obj2[key]) return false;\n  }\n\n  return true;\n}\n\n/** Utility: concrete React elements for every slot */\ntype SlotElements<S> = { [K in keyof S]: React.ReactElement };\n\nexport type WithSlots<\n  S extends Record<string, React.ComponentType<any>>,\n  Rest = {},\n> = {\n  /** Perslot overrides */\n  [K in keyof S]?: SlotValue<S[K]>;\n} & {\n  children?: (props: SlotElements<S> & Rest) => React.ReactNode;\n} & Omit<Rest, \"children\">;\n\n/**\n * Internal function to render a slot value as a React element (non-memoized).\n */\nfunction renderSlotElement(\n  slot: SlotValue<React.ComponentType<any>> | undefined,\n  DefaultComponent: React.ComponentType<any>,\n  props: Record<string, unknown>\n): React.ReactElement {\n  if (typeof slot === \"string\") {\n    return React.createElement(DefaultComponent, {\n      ...props,\n      className: slot,\n    });\n  }\n  if (typeof slot === \"function\") {\n    return React.createElement(slot as React.ComponentType<any>, props);\n  }\n\n  if (slot && typeof slot === \"object\" && !React.isValidElement(slot)) {\n    return React.createElement(DefaultComponent, {\n      ...props,\n      ...slot,\n    });\n  }\n\n  return React.createElement(DefaultComponent, props);\n}\n\n/**\n * Internal memoized wrapper component for renderSlot.\n * Uses forwardRef to support ref forwarding.\n */\nconst MemoizedSlotWrapper = React.memo(\n  React.forwardRef<unknown, any>(function MemoizedSlotWrapper(props, ref) {\n    const { $slot, $component, ...rest } = props;\n    const propsWithRef: Record<string, unknown> = ref !== null ? { ...rest, ref } : rest;\n    return renderSlotElement($slot, $component, propsWithRef);\n  }),\n  (prev: any, next: any) => {\n    // Compare slot and component references\n    if (prev.$slot !== next.$slot) return false;\n    if (prev.$component !== next.$component) return false;\n\n    // Shallow compare remaining props (ref is handled separately by React)\n    const { $slot: _ps, $component: _pc, ...prevRest } = prev;\n    const { $slot: _ns, $component: _nc, ...nextRest } = next;\n    return shallowEqual(\n      prevRest as Record<string, unknown>,\n      nextRest as Record<string, unknown>\n    );\n  }\n);\n\n/**\n * Renders a slot value as a memoized React element.\n * Automatically prevents unnecessary re-renders using shallow prop comparison.\n * Supports ref forwarding.\n *\n * @example\n * renderSlot(customInput, CopilotChatInput, { onSubmit: handleSubmit })\n */\nexport function renderSlot<C extends React.ComponentType<any>, P = React.ComponentProps<C>>(\n  slot: SlotValue<C> | undefined,\n  DefaultComponent: C,\n  props: P\n): React.ReactElement {\n  return React.createElement(MemoizedSlotWrapper, {\n    ...props,\n    $slot: slot,\n    $component: DefaultComponent,\n  } as any);\n}\n","import { AssistantMessage, Message } from \"@ag-ui/core\";\nimport { useState } from \"react\";\nimport {\n  Copy,\n  Check,\n  ThumbsUp,\n  ThumbsDown,\n  Volume2,\n  RefreshCw,\n} from \"lucide-react\";\nimport {\n  useCopilotChatConfiguration,\n  CopilotChatDefaultLabels,\n} from \"@/providers/CopilotChatConfigurationProvider\";\nimport { twMerge } from \"tailwind-merge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport \"katex/dist/katex.min.css\";\nimport { WithSlots, renderSlot } from \"@/lib/slots\";\nimport { Streamdown } from \"streamdown\";\nimport CopilotChatToolCallsView from \"./CopilotChatToolCallsView\";\n\nexport type CopilotChatAssistantMessageProps = WithSlots<\n  {\n    markdownRenderer: typeof CopilotChatAssistantMessage.MarkdownRenderer;\n    toolbar: typeof CopilotChatAssistantMessage.Toolbar;\n    copyButton: typeof CopilotChatAssistantMessage.CopyButton;\n    thumbsUpButton: typeof CopilotChatAssistantMessage.ThumbsUpButton;\n    thumbsDownButton: typeof CopilotChatAssistantMessage.ThumbsDownButton;\n    readAloudButton: typeof CopilotChatAssistantMessage.ReadAloudButton;\n    regenerateButton: typeof CopilotChatAssistantMessage.RegenerateButton;\n    toolCallsView: typeof CopilotChatToolCallsView;\n  },\n  {\n    onThumbsUp?: (message: AssistantMessage) => void;\n    onThumbsDown?: (message: AssistantMessage) => void;\n    onReadAloud?: (message: AssistantMessage) => void;\n    onRegenerate?: (message: AssistantMessage) => void;\n    message: AssistantMessage;\n    messages?: Message[];\n    isRunning?: boolean;\n    additionalToolbarItems?: React.ReactNode;\n    toolbarVisible?: boolean;\n  } & React.HTMLAttributes<HTMLDivElement>\n>;\n\nexport function CopilotChatAssistantMessage({\n  message,\n  messages,\n  isRunning,\n  onThumbsUp,\n  onThumbsDown,\n  onReadAloud,\n  onRegenerate,\n  additionalToolbarItems,\n  toolbarVisible = true,\n  markdownRenderer,\n  toolbar,\n  copyButton,\n  thumbsUpButton,\n  thumbsDownButton,\n  readAloudButton,\n  regenerateButton,\n  toolCallsView,\n  children,\n  className,\n  ...props\n}: CopilotChatAssistantMessageProps) {\n  const boundMarkdownRenderer = renderSlot(\n    markdownRenderer,\n    CopilotChatAssistantMessage.MarkdownRenderer,\n    {\n      content: message.content || \"\",\n      \n    }\n  );\n\n  const boundCopyButton = renderSlot(\n    copyButton,\n    CopilotChatAssistantMessage.CopyButton,\n    {\n      onClick: async () => {\n        if (message.content) {\n          try {\n            await navigator.clipboard.writeText(message.content);\n          } catch (err) {\n            console.error(\"Failed to copy message:\", err);\n          }\n        }\n      },\n    }\n  );\n\n  const boundThumbsUpButton = renderSlot(\n    thumbsUpButton,\n    CopilotChatAssistantMessage.ThumbsUpButton,\n    {\n      onClick: onThumbsUp,\n    }\n  );\n\n  const boundThumbsDownButton = renderSlot(\n    thumbsDownButton,\n    CopilotChatAssistantMessage.ThumbsDownButton,\n    {\n      onClick: onThumbsDown,\n    }\n  );\n\n  const boundReadAloudButton = renderSlot(\n    readAloudButton,\n    CopilotChatAssistantMessage.ReadAloudButton,\n    {\n      onClick: onReadAloud,\n    }\n  );\n\n  const boundRegenerateButton = renderSlot(\n    regenerateButton,\n    CopilotChatAssistantMessage.RegenerateButton,\n    {\n      onClick: onRegenerate,\n    }\n  );\n\n  const boundToolbar = renderSlot(\n    toolbar,\n    CopilotChatAssistantMessage.Toolbar,\n    {\n      children: (\n        <div className=\"flex items-center gap-1\">\n          {boundCopyButton}\n          {(onThumbsUp || thumbsUpButton) && boundThumbsUpButton}\n          {(onThumbsDown || thumbsDownButton) && boundThumbsDownButton}\n          {(onReadAloud || readAloudButton) && boundReadAloudButton}\n          {(onRegenerate || regenerateButton) && boundRegenerateButton}\n          {additionalToolbarItems}\n        </div>\n      ),\n    }\n  );\n\n  const boundToolCallsView = renderSlot(\n    toolCallsView,\n    CopilotChatToolCallsView,\n    {\n      message,\n      messages,\n    }\n  );\n\n  // Don't show toolbar if message has no content (only tool calls)\n  const hasContent = !!(message.content && message.content.trim().length > 0);\n  const isLatestAssistantMessage =\n    message.role === \"assistant\" && messages?.[messages.length - 1]?.id === message.id;\n  const shouldShowToolbar = toolbarVisible && hasContent && !(isRunning && isLatestAssistantMessage);\n\n  if (children) {\n    return (\n      <>\n        {children({\n          markdownRenderer: boundMarkdownRenderer,\n          toolbar: boundToolbar,\n          toolCallsView: boundToolCallsView,\n          copyButton: boundCopyButton,\n          thumbsUpButton: boundThumbsUpButton,\n          thumbsDownButton: boundThumbsDownButton,\n          readAloudButton: boundReadAloudButton,\n          regenerateButton: boundRegenerateButton,\n          message,\n          messages,\n          isRunning,\n          onThumbsUp,\n          onThumbsDown,\n          onReadAloud,\n          onRegenerate,\n          additionalToolbarItems,\n          toolbarVisible: shouldShowToolbar,\n        })}\n      </>\n    );\n  }\n\n  return (\n    <div\n      className={twMerge(\n        \"prose max-w-full break-words dark:prose-invert\",\n        className\n      )}\n      {...props}\n      data-message-id={message.id}\n    >\n      {boundMarkdownRenderer}\n      {boundToolCallsView}\n      {shouldShowToolbar && boundToolbar}\n    </div>\n  );\n}\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace CopilotChatAssistantMessage {\n  export const MarkdownRenderer: React.FC<\n    Omit<React.ComponentProps<typeof Streamdown>, \"children\"> & {\n      content: string;\n    }\n  > = ({ content, className, ...props }) => (\n    <Streamdown className={className} {...props}>\n      {content ?? \"\"}\n    </Streamdown>\n  );\n\n  export const Toolbar: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({\n    className,\n    ...props\n  }) => (\n    <div\n      className={twMerge(\n        \"w-full bg-transparent flex items-center -ml-[5px] -mt-[0px]\",\n        className\n      )}\n      {...props}\n    />\n  );\n\n  export const ToolbarButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement> & {\n      title: string;\n      children: React.ReactNode;\n    }\n  > = ({ title, children, ...props }) => {\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            type=\"button\"\n            variant=\"assistantMessageToolbarButton\"\n            aria-label={title}\n            {...props}\n          >\n            {children}\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent side=\"bottom\">\n          <p>{title}</p>\n        </TooltipContent>\n      </Tooltip>\n    );\n  };\n\n  export const CopyButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement>\n  > = ({ className, title, onClick, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n    const [copied, setCopied] = useState(false);\n\n    const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n\n      if (onClick) {\n        onClick(event);\n      }\n    };\n\n    return (\n      <ToolbarButton\n        title={title || labels.assistantMessageToolbarCopyMessageLabel}\n        onClick={handleClick}\n        className={className}\n        {...props}\n      >\n        {copied ? (\n          <Check className=\"size-[18px]\" />\n        ) : (\n          <Copy className=\"size-[18px]\" />\n        )}\n      </ToolbarButton>\n    );\n  };\n\n  export const ThumbsUpButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement>\n  > = ({ title, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n    return (\n      <ToolbarButton\n        title={title || labels.assistantMessageToolbarThumbsUpLabel}\n        {...props}\n      >\n        <ThumbsUp className=\"size-[18px]\" />\n      </ToolbarButton>\n    );\n  };\n\n  export const ThumbsDownButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement>\n  > = ({ title, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n    return (\n      <ToolbarButton\n        title={title || labels.assistantMessageToolbarThumbsDownLabel}\n        {...props}\n      >\n        <ThumbsDown className=\"size-[18px]\" />\n      </ToolbarButton>\n    );\n  };\n\n  export const ReadAloudButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement>\n  > = ({ title, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n    return (\n      <ToolbarButton\n        title={title || labels.assistantMessageToolbarReadAloudLabel}\n        {...props}\n      >\n        <Volume2 className=\"size-[20px]\" />\n      </ToolbarButton>\n    );\n  };\n\n  export const RegenerateButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement>\n  > = ({ title, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n    return (\n      <ToolbarButton\n        title={title || labels.assistantMessageToolbarRegenerateLabel}\n        {...props}\n      >\n        <RefreshCw className=\"size-[18px]\" />\n      </ToolbarButton>\n    );\n  };\n}\n\nCopilotChatAssistantMessage.MarkdownRenderer.displayName =\n  \"CopilotChatAssistantMessage.MarkdownRenderer\";\nCopilotChatAssistantMessage.Toolbar.displayName =\n  \"CopilotChatAssistantMessage.Toolbar\";\nCopilotChatAssistantMessage.CopyButton.displayName =\n  \"CopilotChatAssistantMessage.CopyButton\";\nCopilotChatAssistantMessage.ThumbsUpButton.displayName =\n  \"CopilotChatAssistantMessage.ThumbsUpButton\";\nCopilotChatAssistantMessage.ThumbsDownButton.displayName =\n  \"CopilotChatAssistantMessage.ThumbsDownButton\";\nCopilotChatAssistantMessage.ReadAloudButton.displayName =\n  \"CopilotChatAssistantMessage.ReadAloudButton\";\nCopilotChatAssistantMessage.RegenerateButton.displayName =\n  \"CopilotChatAssistantMessage.RegenerateButton\";\n\nexport default CopilotChatAssistantMessage;\n","import React, { useCallback, useMemo, useSyncExternalStore } from \"react\";\nimport { ToolCall, ToolMessage } from \"@ag-ui/core\";\nimport { ToolCallStatus } from \"@copilotkitnext/core\";\nimport { useCopilotKit } from \"@/providers/CopilotKitProvider\";\nimport { useCopilotChatConfiguration } from \"@/providers/CopilotChatConfigurationProvider\";\nimport { DEFAULT_AGENT_ID } from \"@copilotkitnext/shared\";\nimport { partialJSONParse } from \"@copilotkitnext/shared\";\nimport { ReactToolCallRenderer } from \"@/types/react-tool-call-renderer\";\n\nexport interface UseRenderToolCallProps {\n  toolCall: ToolCall;\n  toolMessage?: ToolMessage;\n}\n\n/**\n * Props for the memoized ToolCallRenderer component\n */\ninterface ToolCallRendererProps {\n  toolCall: ToolCall;\n  toolMessage?: ToolMessage;\n  RenderComponent: ReactToolCallRenderer<unknown>[\"render\"];\n  isExecuting: boolean;\n}\n\n/**\n * Memoized component that renders a single tool call.\n * This prevents unnecessary re-renders when parent components update\n * but the tool call data hasn't changed.\n */\nconst ToolCallRenderer = React.memo(\n  function ToolCallRenderer({\n    toolCall,\n    toolMessage,\n    RenderComponent,\n    isExecuting,\n  }: ToolCallRendererProps) {\n    // Memoize args based on the arguments string to maintain stable reference\n    const args = useMemo(\n      () => partialJSONParse(toolCall.function.arguments),\n      [toolCall.function.arguments]\n    );\n\n    const toolName = toolCall.function.name;\n\n    // Render based on status to preserve discriminated union type inference\n    if (toolMessage) {\n      return (\n        <RenderComponent\n          name={toolName}\n          args={args}\n          status={ToolCallStatus.Complete}\n          result={toolMessage.content}\n        />\n      );\n    } else if (isExecuting) {\n      return (\n        <RenderComponent\n          name={toolName}\n          args={args}\n          status={ToolCallStatus.Executing}\n          result={undefined}\n        />\n      );\n    } else {\n      return (\n        <RenderComponent\n          name={toolName}\n          args={args}\n          status={ToolCallStatus.InProgress}\n          result={undefined}\n        />\n      );\n    }\n  },\n  // Custom comparison function to prevent re-renders when tool call data hasn't changed\n  (prevProps, nextProps) => {\n    // Compare tool call identity and content\n    if (prevProps.toolCall.id !== nextProps.toolCall.id) return false;\n    if (prevProps.toolCall.function.name !== nextProps.toolCall.function.name) return false;\n    if (prevProps.toolCall.function.arguments !== nextProps.toolCall.function.arguments) return false;\n\n    // Compare tool message (result)\n    const prevResult = prevProps.toolMessage?.content;\n    const nextResult = nextProps.toolMessage?.content;\n    if (prevResult !== nextResult) return false;\n\n    // Compare executing state\n    if (prevProps.isExecuting !== nextProps.isExecuting) return false;\n\n    // Compare render component reference\n    if (prevProps.RenderComponent !== nextProps.RenderComponent) return false;\n\n    return true;\n  }\n);\n\n/**\n * Hook that returns a function to render tool calls based on the render functions\n * defined in CopilotKitProvider.\n *\n * @returns A function that takes a tool call and optional tool message and returns the rendered component\n */\nexport function useRenderToolCall() {\n  const { copilotkit, executingToolCallIds } = useCopilotKit();\n  const config = useCopilotChatConfiguration();\n  const agentId = config?.agentId ?? DEFAULT_AGENT_ID;\n\n  // Subscribe to render tool calls changes using useSyncExternalStore\n  // This ensures we always have the latest value, even if subscriptions run in any order\n  const renderToolCalls = useSyncExternalStore(\n    (callback) => {\n      return copilotkit.subscribe({\n        onRenderToolCallsChanged: callback,\n      }).unsubscribe;\n    },\n    () => copilotkit.renderToolCalls,\n    () => copilotkit.renderToolCalls\n  );\n\n  // Note: executingToolCallIds is now provided by CopilotKitProvider context.\n  // This is critical for HITL reconnection: when connecting to a thread with\n  // pending tool calls, the onToolExecutionStart event fires before child components\n  // mount. By tracking at the provider level, the executing state is already\n  // available when this hook first runs.\n\n  const renderToolCall = useCallback(\n    ({\n      toolCall,\n      toolMessage,\n    }: UseRenderToolCallProps): React.ReactElement | null => {\n      // Find the render config for this tool call by name\n      // For rendering, we show all tool calls regardless of agentId\n      // The agentId scoping only affects handler execution (in core)\n      // Priority order:\n      // 1. Exact match by name (prefer agent-specific if multiple exist)\n      // 2. Wildcard (*) renderer\n      const exactMatches = renderToolCalls.filter(\n        (rc) => rc.name === toolCall.function.name\n      );\n\n      // If multiple renderers with same name exist, prefer the one matching our agentId\n      const renderConfig =\n        exactMatches.find((rc) => rc.agentId === agentId) ||\n        exactMatches.find((rc) => !rc.agentId) ||\n        exactMatches[0] ||\n        renderToolCalls.find((rc) => rc.name === \"*\");\n\n      if (!renderConfig) {\n        return null;\n      }\n\n      const RenderComponent = renderConfig.render;\n      const isExecuting = executingToolCallIds.has(toolCall.id);\n\n      // Use the memoized ToolCallRenderer component to prevent unnecessary re-renders\n      return (\n        <ToolCallRenderer\n          key={toolCall.id}\n          toolCall={toolCall}\n          toolMessage={toolMessage}\n          RenderComponent={RenderComponent}\n          isExecuting={isExecuting}\n        />\n      );\n    },\n    [renderToolCalls, executingToolCallIds, agentId]\n  );\n\n  return renderToolCall;\n}\n","\"use client\";\n\nimport React, { createContext, useContext, ReactNode, useMemo, useEffect, useReducer, useRef, useState } from \"react\";\nimport { ReactActivityMessageRenderer, ReactToolCallRenderer } from \"../types\";\nimport { ReactCustomMessageRenderer } from \"../types/react-custom-message-renderer\";\nimport { ReactFrontendTool } from \"../types/frontend-tool\";\nimport { ReactHumanInTheLoop } from \"../types/human-in-the-loop\";\nimport { z } from \"zod\";\nimport { FrontendTool } from \"@copilotkitnext/core\";\nimport { AbstractAgent } from \"@ag-ui/client\";\nimport { CopilotKitCoreReact } from \"../lib/react-core\";\nimport { CopilotKitInspector } from \"../components/CopilotKitInspector\";\nimport {\n  MCPAppsActivityRenderer,\n  MCPAppsActivityContentSchema,\n  MCPAppsActivityType,\n} from \"../components/MCPAppsActivityRenderer\";\n\nconst HEADER_NAME = \"X-CopilotCloud-Public-Api-Key\";\nconst COPILOT_CLOUD_CHAT_URL = \"https://api.cloud.copilotkit.ai/copilotkit/v1\";\n\n// Define the context value interface - idiomatic React naming\nexport interface CopilotKitContextValue {\n  copilotkit: CopilotKitCoreReact;\n  /**\n   * Set of tool call IDs currently being executed.\n   * This is tracked at the provider level to ensure tool execution events\n   * are captured even before child components mount.\n   */\n  executingToolCallIds: ReadonlySet<string>;\n}\n\n// Empty set for default context value\nconst EMPTY_SET: ReadonlySet<string> = new Set();\n\n// Create the CopilotKit context\nconst CopilotKitContext = createContext<CopilotKitContextValue>({\n  copilotkit: null!,\n  executingToolCallIds: EMPTY_SET,\n});\n\n// Provider props interface\nexport interface CopilotKitProviderProps {\n  children: ReactNode;\n  runtimeUrl?: string;\n  headers?: Record<string, string>;\n  /**\n   * Credentials mode for fetch requests (e.g., \"include\" for HTTP-only cookies in cross-origin requests).\n   */\n  credentials?: RequestCredentials;\n  /**\n   * The Copilot Cloud public API key.\n   */\n  publicApiKey?: string;\n  /**\n   * Alias for `publicApiKey`\n   **/\n  publicLicenseKey?: string;\n  properties?: Record<string, unknown>;\n  useSingleEndpoint?: boolean;\n  agents__unsafe_dev_only?: Record<string, AbstractAgent>;\n  renderToolCalls?: ReactToolCallRenderer<any>[];\n  renderActivityMessages?: ReactActivityMessageRenderer<any>[];\n  renderCustomMessages?: ReactCustomMessageRenderer[];\n  frontendTools?: ReactFrontendTool[];\n  humanInTheLoop?: ReactHumanInTheLoop[];\n  showDevConsole?: boolean | \"auto\";\n}\n\n// Small helper to normalize array props to a stable reference and warn\nfunction useStableArrayProp<T>(\n  prop: T[] | undefined,\n  warningMessage?: string,\n  isMeaningfulChange?: (initial: T[], next: T[]) => boolean,\n): T[] {\n  const empty = useMemo<T[]>(() => [], []);\n  const value = prop ?? empty;\n  const initial = useRef(value);\n\n  useEffect(() => {\n    if (\n      warningMessage &&\n      value !== initial.current &&\n      (isMeaningfulChange ? isMeaningfulChange(initial.current, value) : true)\n    ) {\n      console.error(warningMessage);\n    }\n  }, [value, warningMessage]);\n\n  return value;\n}\n\n// Provider component\nexport const CopilotKitProvider: React.FC<CopilotKitProviderProps> = ({\n  children,\n  runtimeUrl,\n  headers = {},\n  credentials,\n  publicApiKey,\n  publicLicenseKey,\n  properties = {},\n  agents__unsafe_dev_only: agents = {},\n  renderToolCalls,\n  renderActivityMessages,\n  renderCustomMessages,\n  frontendTools,\n  humanInTheLoop,\n  showDevConsole = false,\n  useSingleEndpoint = false,\n}) => {\n  const [shouldRenderInspector, setShouldRenderInspector] = useState(false);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    if (showDevConsole === true) {\n      // Explicitly show the inspector\n      setShouldRenderInspector(true);\n    } else if (showDevConsole === \"auto\") {\n      // Show on localhost or 127.0.0.1 only\n      const localhostHosts = new Set([\"localhost\", \"127.0.0.1\"]);\n      if (localhostHosts.has(window.location.hostname)) {\n        setShouldRenderInspector(true);\n      } else {\n        setShouldRenderInspector(false);\n      }\n    } else {\n      // showDevConsole is false or undefined (default false)\n      setShouldRenderInspector(false);\n    }\n  }, [showDevConsole]);\n\n  // Normalize array props to stable references with clear dev warnings\n  const renderToolCallsList = useStableArrayProp<ReactToolCallRenderer<any>>(\n    renderToolCalls,\n    \"renderToolCalls must be a stable array. If you want to dynamically add or remove tools, use `useFrontendTool` instead.\",\n    (initial, next) => {\n      // Only warn if the shape (names+agentId) changed. Allow identity changes\n      // to support updated closures from parents (e.g., Storybook state).\n      const key = (rc?: ReactToolCallRenderer<unknown>) => `${rc?.agentId ?? \"\"}:${rc?.name ?? \"\"}`;\n      const setFrom = (arr: ReactToolCallRenderer<unknown>[]) => new Set(arr.map(key));\n      const a = setFrom(initial);\n      const b = setFrom(next);\n      if (a.size !== b.size) return true;\n      for (const k of a) if (!b.has(k)) return true;\n      return false;\n    },\n  );\n\n  const renderCustomMessagesList = useStableArrayProp<ReactCustomMessageRenderer>(\n    renderCustomMessages,\n    \"renderCustomMessages must be a stable array.\",\n  );\n\n  const renderActivityMessagesList = useStableArrayProp<ReactActivityMessageRenderer<any>>(\n    renderActivityMessages,\n    \"renderActivityMessages must be a stable array.\",\n  );\n\n  // Built-in activity renderers that are always included\n  const builtInActivityRenderers = useMemo<ReactActivityMessageRenderer<any>[]>(() => [\n    {\n      activityType: MCPAppsActivityType,\n      content: MCPAppsActivityContentSchema,\n      render: MCPAppsActivityRenderer,\n    },\n  ], []);\n\n  // Combine user-provided activity renderers with built-in ones\n  // User-provided renderers take precedence (come first) so they can override built-ins\n  const allActivityRenderers = useMemo(() => {\n    return [...renderActivityMessagesList, ...builtInActivityRenderers];\n  }, [renderActivityMessagesList, builtInActivityRenderers]);\n\n  const resolvedPublicKey = publicApiKey ?? publicLicenseKey;\n  const hasLocalAgents = agents && Object.keys(agents).length > 0;\n\n  // Merge a provided publicApiKey into headers (without overwriting an explicit header).\n  const mergedHeaders = useMemo(() => {\n    if (!resolvedPublicKey) return headers;\n    if (headers[HEADER_NAME]) return headers;\n    return {\n      ...headers,\n      [HEADER_NAME]: resolvedPublicKey,\n    };\n  }, [headers, resolvedPublicKey]);\n\n  if (!runtimeUrl && !resolvedPublicKey && !hasLocalAgents) {\n    const message = \"Missing required prop: 'runtimeUrl' or 'publicApiKey' or 'publicLicenseKey'\";\n    if (process.env.NODE_ENV === \"production\") {\n      throw new Error(message);\n    } else {\n      // In dev/test we warn but allow to facilitate local agents and unit tests.\n      console.warn(message);\n    }\n  }\n\n  const chatApiEndpoint = runtimeUrl ?? (resolvedPublicKey ? COPILOT_CLOUD_CHAT_URL : undefined);\n\n  const frontendToolsList = useStableArrayProp<ReactFrontendTool>(\n    frontendTools,\n    \"frontendTools must be a stable array. If you want to dynamically add or remove tools, use `useFrontendTool` instead.\",\n  );\n  const humanInTheLoopList = useStableArrayProp<ReactHumanInTheLoop>(\n    humanInTheLoop,\n    \"humanInTheLoop must be a stable array. If you want to dynamically add or remove human-in-the-loop tools, use `useHumanInTheLoop` instead.\",\n  );\n\n  // Note: warnings for array identity changes are handled by useStableArrayProp\n\n  // Process humanInTheLoop tools to create handlers and add render components\n  const processedHumanInTheLoopTools = useMemo(() => {\n    const processedTools: FrontendTool[] = [];\n    const processedRenderToolCalls: ReactToolCallRenderer<unknown>[] = [];\n\n    humanInTheLoopList.forEach((tool) => {\n      // Create a promise-based handler for each human-in-the-loop tool\n      const frontendTool: FrontendTool = {\n        name: tool.name,\n        description: tool.description,\n        parameters: tool.parameters,\n        followUp: tool.followUp,\n        ...(tool.agentId && { agentId: tool.agentId }),\n        handler: async () => {\n          // This handler will be replaced by the hook when it runs\n          // For provider-level tools, we create a basic handler that waits for user interaction\n          return new Promise((resolve) => {\n            // The actual implementation will be handled by the render component\n            // This is a placeholder that the hook will override\n            console.warn(`Human-in-the-loop tool '${tool.name}' called but no interactive handler is set up.`);\n            resolve(undefined);\n          });\n        },\n      };\n      processedTools.push(frontendTool);\n\n      // Add the render component to renderToolCalls\n      if (tool.render) {\n        processedRenderToolCalls.push({\n          name: tool.name,\n          args: tool.parameters!,\n          render: tool.render,\n          ...(tool.agentId && { agentId: tool.agentId }),\n        } as ReactToolCallRenderer<unknown>);\n      }\n    });\n\n    return { tools: processedTools, renderToolCalls: processedRenderToolCalls };\n  }, [humanInTheLoopList]);\n\n  // Combine all tools for CopilotKitCore\n  const allTools = useMemo(() => {\n    const tools: FrontendTool[] = [];\n\n    // Add frontend tools\n    tools.push(...frontendToolsList);\n\n    // Add processed human-in-the-loop tools\n    tools.push(...processedHumanInTheLoopTools.tools);\n\n    return tools;\n  }, [frontendToolsList, processedHumanInTheLoopTools]);\n\n  // Combine all render tool calls\n  const allRenderToolCalls = useMemo(() => {\n    const combined: ReactToolCallRenderer<unknown>[] = [...renderToolCallsList];\n\n    // Add render components from frontend tools\n    frontendToolsList.forEach((tool) => {\n      if (tool.render) {\n        // For wildcard tools without parameters, default to z.any()\n        const args = tool.parameters || (tool.name === \"*\" ? z.any() : undefined);\n        if (args) {\n          combined.push({\n            name: tool.name,\n            args: args,\n            render: tool.render,\n          } as ReactToolCallRenderer<unknown>);\n        }\n      }\n    });\n\n    // Add render components from human-in-the-loop tools\n    combined.push(...processedHumanInTheLoopTools.renderToolCalls);\n\n    return combined;\n  }, [renderToolCallsList, frontendToolsList, processedHumanInTheLoopTools]);\n\n  const copilotkit = useMemo(() => {\n    const copilotkit = new CopilotKitCoreReact({\n      runtimeUrl: chatApiEndpoint,\n      runtimeTransport: useSingleEndpoint ? \"single\" : \"rest\",\n      headers: mergedHeaders,\n      credentials,\n      properties,\n      agents__unsafe_dev_only: agents,\n      tools: allTools,\n      renderToolCalls: allRenderToolCalls,\n      renderActivityMessages: allActivityRenderers,\n      renderCustomMessages: renderCustomMessagesList,\n    });\n\n    return copilotkit;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [allTools, allRenderToolCalls, allActivityRenderers, renderCustomMessagesList, useSingleEndpoint]);\n\n  // Subscribe to render tool calls changes to force re-renders\n  const [, forceUpdate] = useReducer((x) => x + 1, 0);\n\n  useEffect(() => {\n    const subscription = copilotkit.subscribe({\n      onRenderToolCallsChanged: () => {\n        forceUpdate();\n      },\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [copilotkit]);\n\n  // Track executing tool call IDs at the provider level.\n  // This is critical for HITL reconnection: when connecting to a thread with\n  // pending tool calls, the onToolExecutionStart event fires before child components\n  // (like CopilotChatToolCallsView) mount. By tracking at the provider level,\n  // we ensure the executing state is captured and available when children mount.\n  const [executingToolCallIds, setExecutingToolCallIds] = useState<ReadonlySet<string>>(() => new Set());\n\n  useEffect(() => {\n    const subscription = copilotkit.subscribe({\n      onToolExecutionStart: ({ toolCallId }) => {\n        setExecutingToolCallIds((prev) => {\n          if (prev.has(toolCallId)) return prev;\n          const next = new Set(prev);\n          next.add(toolCallId);\n          return next;\n        });\n      },\n      onToolExecutionEnd: ({ toolCallId }) => {\n        setExecutingToolCallIds((prev) => {\n          if (!prev.has(toolCallId)) return prev;\n          const next = new Set(prev);\n          next.delete(toolCallId);\n          return next;\n        });\n      },\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [copilotkit]);\n\n  useEffect(() => {\n    copilotkit.setRuntimeUrl(chatApiEndpoint);\n    copilotkit.setRuntimeTransport(useSingleEndpoint ? \"single\" : \"rest\");\n    copilotkit.setHeaders(mergedHeaders);\n    copilotkit.setCredentials(credentials);\n    copilotkit.setProperties(properties);\n    copilotkit.setAgents__unsafe_dev_only(agents);\n  }, [chatApiEndpoint, mergedHeaders, credentials, properties, agents, useSingleEndpoint]);\n\n  return (\n    <CopilotKitContext.Provider\n      value={{\n        copilotkit,\n        executingToolCallIds,\n      }}\n    >\n      {children}\n      {shouldRenderInspector ? <CopilotKitInspector core={copilotkit} /> : null}\n    </CopilotKitContext.Provider>\n  );\n};\n\n// Hook to use the CopilotKit instance - returns the full context value\nexport const useCopilotKit = (): CopilotKitContextValue => {\n  const context = useContext(CopilotKitContext);\n  const [, forceUpdate] = useReducer((x) => x + 1, 0);\n\n  if (!context) {\n    throw new Error(\"useCopilotKit must be used within CopilotKitProvider\");\n  }\n  useEffect(() => {\n    const subscription = context.copilotkit.subscribe({\n      onRuntimeConnectionStatusChanged: () => {\n        forceUpdate();\n      },\n    });\n    return () => {\n      subscription.unsubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return context;\n};\n","import { ReactActivityMessageRenderer, ReactToolCallRenderer } from \"@/types\";\nimport { ReactCustomMessageRenderer } from \"@/types/react-custom-message-renderer\";\nimport {\n  CopilotKitCore,\n  CopilotKitCoreConfig,\n  CopilotKitCoreSubscriber,\n  CopilotKitCoreSubscription,\n} from \"@copilotkitnext/core\";\n\nexport interface CopilotKitCoreReactConfig extends CopilotKitCoreConfig {\n  // Add any additional configuration properties specific to the React implementation\n  renderToolCalls?: ReactToolCallRenderer<any>[];\n  renderActivityMessages?: ReactActivityMessageRenderer<any>[];\n\n  // Add custom message renderers\n  renderCustomMessages?: ReactCustomMessageRenderer[];\n}\n\nexport interface CopilotKitCoreReactSubscriber extends CopilotKitCoreSubscriber {\n  onRenderToolCallsChanged?: (event: {\n    copilotkit: CopilotKitCore;\n    renderToolCalls: ReactToolCallRenderer<any>[];\n  }) => void | Promise<void>;\n}\n\nexport class CopilotKitCoreReact extends CopilotKitCore {\n  private _renderToolCalls: ReactToolCallRenderer<any>[] = [];\n  private _renderCustomMessages: ReactCustomMessageRenderer[] = [];\n  private _renderActivityMessages: ReactActivityMessageRenderer<any>[] = [];\n\n  constructor(config: CopilotKitCoreReactConfig) {\n    super(config);\n    this._renderToolCalls = config.renderToolCalls ?? [];\n    this._renderCustomMessages = config.renderCustomMessages ?? [];\n    this._renderActivityMessages = config.renderActivityMessages ?? [];\n  }\n\n  get renderCustomMessages(): Readonly<ReactCustomMessageRenderer[]> {\n    return this._renderCustomMessages;\n  }\n\n  get renderActivityMessages(): Readonly<ReactActivityMessageRenderer<any>>[] {\n    return this._renderActivityMessages;\n  }\n\n  get renderToolCalls(): Readonly<ReactToolCallRenderer<any>>[] {\n    return this._renderToolCalls;\n  }\n\n  setRenderToolCalls(renderToolCalls: ReactToolCallRenderer<any>[]): void {\n    this._renderToolCalls = renderToolCalls;\n\n    // Notify React-specific subscribers\n    void this.notifySubscribers(\n      (subscriber) => {\n        const reactSubscriber = subscriber as CopilotKitCoreReactSubscriber;\n        if (reactSubscriber.onRenderToolCallsChanged) {\n          reactSubscriber.onRenderToolCallsChanged({\n            copilotkit: this,\n            renderToolCalls: this.renderToolCalls,\n          });\n        }\n      },\n      \"Subscriber onRenderToolCallsChanged error:\"\n    );\n  }\n\n  // Override to accept React-specific subscriber type\n  subscribe(subscriber: CopilotKitCoreReactSubscriber): CopilotKitCoreSubscription {\n    return super.subscribe(subscriber);\n  }\n}\n","import * as React from \"react\";\nimport { createComponent } from \"@lit-labs/react\";\nimport type { CopilotKitCore } from \"@copilotkitnext/core\";\n\ntype CopilotKitInspectorBaseProps = {\n  core?: CopilotKitCore | null;\n  [key: string]: unknown;\n};\n\ntype InspectorComponent = React.ComponentType<CopilotKitInspectorBaseProps>;\n\nexport interface CopilotKitInspectorProps extends CopilotKitInspectorBaseProps {}\n\nexport const CopilotKitInspector: React.FC<CopilotKitInspectorProps> = ({ core, ...rest }) => {\n  const [InspectorComponent, setInspectorComponent] = React.useState<InspectorComponent | null>(null);\n\n  React.useEffect(() => {\n    let mounted = true;\n\n    // Load the web component only on the client to keep SSR output stable.\n    import(\"@copilotkitnext/web-inspector\").then((mod) => {\n      mod.defineWebInspector?.();\n\n      const Component = createComponent({\n        tagName: mod.WEB_INSPECTOR_TAG,\n        elementClass: mod.WebInspectorElement,\n        react: React,\n      }) as InspectorComponent;\n\n      if (mounted) {\n        setInspectorComponent(() => Component);\n      }\n    });\n\n    return () => {\n      mounted = false;\n    };\n  }, []);\n\n  // During SSR (and until the client finishes loading), render nothing to keep markup consistent.\n  if (!InspectorComponent) return null;\n\n  return <InspectorComponent {...rest} core={core ?? null} />;\n};\n\nCopilotKitInspector.displayName = \"CopilotKitInspector\";\n","\"use client\";\n\nimport React, { useEffect, useRef, useState, useCallback } from \"react\";\nimport { z } from \"zod\";\nimport type { AbstractAgent, RunAgentResult } from \"@ag-ui/client\";\n\n// Protocol version supported\nconst PROTOCOL_VERSION = \"2025-06-18\";\n\n// Sandbox proxy HTML - embedded to avoid requiring users to add a file to their public folder\nconst SANDBOX_HTML = `<!doctype html>\n<html>\n<head>\n<meta charset=\"utf-8\" />\n<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'self'; img-src * data: blob: 'unsafe-inline'; media-src * blob: data:; font-src * blob: data:; script-src 'self' 'wasm-unsafe-eval' 'unsafe-inline' 'unsafe-eval' blob: data: http://localhost:* https://localhost:*; style-src * blob: data: 'unsafe-inline'; connect-src *; frame-src * blob: data: http://localhost:* https://localhost:*; base-uri 'self';\" />\n<style>html,body{margin:0;padding:0;height:100%;width:100%;overflow:hidden}*{box-sizing:border-box}iframe{background-color:transparent;border:none;padding:0;overflow:hidden;width:100%;height:100%}</style>\n</head>\n<body>\n<script>\nif(window.self===window.top){throw new Error(\"This file must be used in an iframe.\")}\nconst inner=document.createElement(\"iframe\");\ninner.style=\"width:100%;height:100%;border:none;\";\ninner.setAttribute(\"sandbox\",\"allow-scripts allow-same-origin allow-forms\");\ndocument.body.appendChild(inner);\nwindow.addEventListener(\"message\",async(event)=>{\nif(event.source===window.parent){\nif(event.data&&event.data.method===\"ui/notifications/sandbox-resource-ready\"){\nconst{html,sandbox}=event.data.params;\nif(typeof sandbox===\"string\")inner.setAttribute(\"sandbox\",sandbox);\nif(typeof html===\"string\")inner.srcdoc=html;\n}else if(inner&&inner.contentWindow){\ninner.contentWindow.postMessage(event.data,\"*\");\n}\n}else if(event.source===inner.contentWindow){\nwindow.parent.postMessage(event.data,\"*\");\n}\n});\nwindow.parent.postMessage({jsonrpc:\"2.0\",method:\"ui/notifications/sandbox-proxy-ready\",params:{}},\"*\");\n</script>\n</body>\n</html>`;\n\n/**\n * Queue for serializing MCP app requests to an agent.\n * Ensures requests wait for the agent to stop running and are processed one at a time.\n */\nclass MCPAppsRequestQueue {\n  private queues = new Map<string, Array<{\n    execute: () => Promise<RunAgentResult>;\n    resolve: (result: RunAgentResult) => void;\n    reject: (error: Error) => void;\n  }>>();\n  private processing = new Map<string, boolean>();\n\n  /**\n   * Add a request to the queue for a specific agent thread.\n   * Returns a promise that resolves when the request completes.\n   */\n  async enqueue(\n    agent: AbstractAgent,\n    request: () => Promise<RunAgentResult>\n  ): Promise<RunAgentResult> {\n    const threadId = agent.threadId || \"default\";\n\n    return new Promise((resolve, reject) => {\n      // Get or create queue for this thread\n      let queue = this.queues.get(threadId);\n      if (!queue) {\n        queue = [];\n        this.queues.set(threadId, queue);\n      }\n\n      // Add request to queue\n      queue.push({ execute: request, resolve, reject });\n\n      // Start processing if not already running\n      this.processQueue(threadId, agent);\n    });\n  }\n\n  private async processQueue(threadId: string, agent: AbstractAgent): Promise<void> {\n    // If already processing this queue, return\n    if (this.processing.get(threadId)) {\n      return;\n    }\n\n    this.processing.set(threadId, true);\n\n    try {\n      const queue = this.queues.get(threadId);\n      if (!queue) return;\n\n      while (queue.length > 0) {\n        const item = queue[0]!;\n\n        try {\n          // Wait for any active run to complete before processing\n          await this.waitForAgentIdle(agent);\n\n          // Execute the request\n          const result = await item.execute();\n          item.resolve(result);\n        } catch (error) {\n          item.reject(error instanceof Error ? error : new Error(String(error)));\n        }\n\n        // Remove processed item\n        queue.shift();\n      }\n    } finally {\n      this.processing.set(threadId, false);\n    }\n  }\n\n  private waitForAgentIdle(agent: AbstractAgent): Promise<void> {\n    return new Promise((resolve) => {\n      if (!agent.isRunning) {\n        resolve();\n        return;\n      }\n\n      let done = false;\n      const finish = () => {\n        if (done) return;\n        done = true;\n        clearInterval(checkInterval);\n        sub.unsubscribe();\n        resolve();\n      };\n\n      const sub = agent.subscribe({\n        onRunFinalized: finish,\n        onRunFailed: finish,\n      });\n\n      // Fallback for reconnect scenarios where events don't fire\n      const checkInterval = setInterval(() => {\n        if (!agent.isRunning) finish();\n      }, 500);\n    });\n  }\n}\n\n// Global queue instance for all MCP app requests\nconst mcpAppsRequestQueue = new MCPAppsRequestQueue();\n\n/**\n * Activity type for MCP Apps events - must match the middleware's MCPAppsActivityType\n */\nexport const MCPAppsActivityType = \"mcp-apps\";\n\n// Zod schema for activity content validation (middleware 0.0.2 format)\nexport const MCPAppsActivityContentSchema = z.object({\n  result: z.object({\n    content: z.array(z.any()).optional(),\n    structuredContent: z.any().optional(),\n    isError: z.boolean().optional(),\n  }),\n  // Resource URI to fetch (e.g., \"ui://server/dashboard\")\n  resourceUri: z.string(),\n  // MD5 hash of server config (renamed from serverId in 0.0.1)\n  serverHash: z.string(),\n  // Optional stable server ID from config (takes precedence over serverHash)\n  serverId: z.string().optional(),\n  // Original tool input arguments\n  toolInput: z.record(z.unknown()).optional(),\n});\n\nexport type MCPAppsActivityContent = z.infer<typeof MCPAppsActivityContentSchema>;\n\n// Type for the resource fetched from the server\ninterface FetchedResource {\n  uri: string;\n  mimeType?: string;\n  text?: string;\n  blob?: string;\n  _meta?: {\n    ui?: {\n      prefersBorder?: boolean;\n      csp?: {\n        connectDomains?: string[];\n        resourceDomains?: string[];\n      };\n    };\n  };\n}\n\ninterface JSONRPCRequest {\n  jsonrpc: \"2.0\";\n  id: string | number;\n  method: string;\n  params?: Record<string, unknown>;\n}\n\ninterface JSONRPCResponse {\n  jsonrpc: \"2.0\";\n  id: string | number;\n  result?: unknown;\n  error?: { code: number; message: string };\n}\n\ninterface JSONRPCNotification {\n  jsonrpc: \"2.0\";\n  method: string;\n  params?: Record<string, unknown>;\n}\n\ntype JSONRPCMessage = JSONRPCRequest | JSONRPCResponse | JSONRPCNotification;\n\nfunction isRequest(msg: JSONRPCMessage): msg is JSONRPCRequest {\n  return \"id\" in msg && \"method\" in msg;\n}\n\nfunction isNotification(msg: JSONRPCMessage): msg is JSONRPCNotification {\n  return !(\"id\" in msg) && \"method\" in msg;\n}\n\n/**\n * Props for the activity renderer component\n */\ninterface MCPAppsActivityRendererProps {\n  activityType: string;\n  content: MCPAppsActivityContent;\n  message: unknown; // ActivityMessage from @ag-ui/core\n  agent: AbstractAgent | undefined;\n}\n\n/**\n * MCP Apps Extension Activity Renderer\n *\n * Renders MCP Apps UI in a sandboxed iframe with full protocol support.\n * Fetches resource content on-demand via proxied MCP requests.\n */\nexport const MCPAppsActivityRenderer: React.FC<MCPAppsActivityRendererProps> = function MCPAppsActivityRenderer({ content, agent }) {\n\n  const containerRef = useRef<HTMLDivElement>(null);\n  const iframeRef = useRef<HTMLIFrameElement | null>(null);\n  const [iframeReady, setIframeReady] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [iframeSize, setIframeSize] = useState<{ width?: number; height?: number }>({});\n  const [fetchedResource, setFetchedResource] = useState<FetchedResource | null>(null);\n\n  // Use refs for values that shouldn't trigger re-renders but need latest values\n  const contentRef = useRef(content);\n  contentRef.current = content;\n\n  // Store agent in a ref for use in async handlers\n  const agentRef = useRef(agent);\n  agentRef.current = agent;\n\n  // Ref to track fetch state - survives StrictMode remounts\n  const fetchStateRef = useRef<{\n    inProgress: boolean;\n    promise: Promise<FetchedResource | null> | null;\n    resourceUri: string | null;\n  }>({ inProgress: false, promise: null, resourceUri: null });\n\n  // Callback to send a message to the iframe\n  const sendToIframe = useCallback((msg: JSONRPCMessage) => {\n    if (iframeRef.current?.contentWindow) {\n      console.log(\"[MCPAppsRenderer] Sending to iframe:\", msg);\n      iframeRef.current.contentWindow.postMessage(msg, \"*\");\n    }\n  }, []);\n\n  // Callback to send a JSON-RPC response\n  const sendResponse = useCallback((id: string | number, result: unknown) => {\n    sendToIframe({\n      jsonrpc: \"2.0\",\n      id,\n      result,\n    });\n  }, [sendToIframe]);\n\n  // Callback to send a JSON-RPC error response\n  const sendErrorResponse = useCallback((id: string | number, code: number, message: string) => {\n    sendToIframe({\n      jsonrpc: \"2.0\",\n      id,\n      error: { code, message },\n    });\n  }, [sendToIframe]);\n\n  // Callback to send a notification\n  const sendNotification = useCallback((method: string, params?: Record<string, unknown>) => {\n    sendToIframe({\n      jsonrpc: \"2.0\",\n      method,\n      params: params || {},\n    });\n  }, [sendToIframe]);\n\n  // Effect 0: Fetch the resource content on mount\n  // Uses ref-based deduplication to handle React StrictMode double-mounting\n  useEffect(() => {\n    const { resourceUri, serverHash, serverId } = content;\n\n    // Check if we already have a fetch in progress for this resource\n    // This handles StrictMode double-mounting - second mount reuses first mount's promise\n    if (fetchStateRef.current.inProgress && fetchStateRef.current.resourceUri === resourceUri) {\n      // Reuse the existing promise\n      fetchStateRef.current.promise?.then((resource) => {\n        if (resource) {\n          setFetchedResource(resource);\n          setIsLoading(false);\n        }\n      }).catch((err) => {\n        setError(err instanceof Error ? err : new Error(String(err)));\n        setIsLoading(false);\n      });\n      return;\n    }\n\n    if (!agent) {\n      setError(new Error(\"No agent available to fetch resource\"));\n      setIsLoading(false);\n      return;\n    }\n\n    // Mark fetch as in progress\n    fetchStateRef.current.inProgress = true;\n    fetchStateRef.current.resourceUri = resourceUri;\n\n    // Create the fetch promise using the queue to serialize requests\n    const fetchPromise = (async (): Promise<FetchedResource | null> => {\n      try {\n        // Use queue to wait for agent to be idle and serialize requests\n        const runResult = await mcpAppsRequestQueue.enqueue(agent, () =>\n          agent.runAgent({\n            forwardedProps: {\n              __proxiedMCPRequest: {\n                serverHash,\n                serverId, // optional, takes precedence if provided\n                method: \"resources/read\",\n                params: { uri: resourceUri },\n              },\n            },\n          })\n        );\n\n        // Extract resource from result\n        // The response format is: { contents: [{ uri, mimeType, text?, blob?, _meta? }] }\n        const resultData = runResult.result as { contents?: FetchedResource[] } | undefined;\n        const resource = resultData?.contents?.[0];\n\n        if (!resource) {\n          throw new Error(\"No resource content in response\");\n        }\n\n        return resource;\n      } catch (err) {\n        console.error(\"[MCPAppsRenderer] Failed to fetch resource:\", err);\n        throw err;\n      } finally {\n        // Mark fetch as complete\n        fetchStateRef.current.inProgress = false;\n      }\n    })();\n\n    // Store the promise for potential reuse\n    fetchStateRef.current.promise = fetchPromise;\n\n    // Handle the result\n    fetchPromise.then((resource) => {\n      if (resource) {\n        setFetchedResource(resource);\n        setIsLoading(false);\n      }\n    }).catch((err) => {\n      setError(err instanceof Error ? err : new Error(String(err)));\n      setIsLoading(false);\n    });\n\n    // No cleanup needed - we want the fetch to complete even if StrictMode unmounts\n  }, [agent, content]);\n\n  // Effect 1: Setup sandbox proxy iframe and communication (after resource is fetched)\n  useEffect(() => {\n    // Wait for resource to be fetched\n    if (isLoading || !fetchedResource) {\n      return;\n    }\n\n    // Capture container reference at effect start (refs are cleared during unmount)\n    const container = containerRef.current;\n    if (!container) {\n      return;\n    }\n\n    let mounted = true;\n    let messageHandler: ((event: MessageEvent) => void) | null = null;\n    let initialListener: ((event: MessageEvent) => void) | null = null;\n    let createdIframe: HTMLIFrameElement | null = null;\n\n    const setup = async () => {\n      try {\n        // Create sandbox proxy iframe\n        const iframe = document.createElement(\"iframe\");\n        createdIframe = iframe; // Track for cleanup\n        iframe.style.width = \"100%\";\n        iframe.style.height = \"100px\"; // Start small, will be resized by size-changed notification\n        iframe.style.border = \"none\";\n        iframe.style.backgroundColor = \"transparent\";\n        iframe.style.display = \"block\";\n        iframe.setAttribute(\"sandbox\", \"allow-scripts allow-same-origin allow-forms\");\n\n        // Wait for sandbox proxy to be ready\n        const sandboxReady = new Promise<void>((resolve) => {\n          initialListener = (event: MessageEvent) => {\n            if (event.source === iframe.contentWindow) {\n              if (event.data?.method === \"ui/notifications/sandbox-proxy-ready\") {\n                if (initialListener) {\n                  window.removeEventListener(\"message\", initialListener);\n                  initialListener = null;\n                }\n                resolve();\n              }\n            }\n          };\n          window.addEventListener(\"message\", initialListener);\n        });\n\n        // Check mounted before adding to DOM (handles StrictMode double-mount)\n        if (!mounted) {\n          if (initialListener) {\n            window.removeEventListener(\"message\", initialListener);\n            initialListener = null;\n          }\n          return;\n        }\n\n        // Set iframe content and add to DOM\n        iframe.srcdoc = SANDBOX_HTML;\n        iframeRef.current = iframe;\n        container.appendChild(iframe);\n\n        // Wait for sandbox proxy to signal ready\n        await sandboxReady;\n        if (!mounted) return;\n\n        console.log(\"[MCPAppsRenderer] Sandbox proxy ready\");\n\n        // Setup message handler for JSON-RPC messages from the inner iframe\n        messageHandler = async (event: MessageEvent) => {\n          if (event.source !== iframe.contentWindow) return;\n\n          const msg = event.data as JSONRPCMessage;\n          if (!msg || typeof msg !== \"object\" || msg.jsonrpc !== \"2.0\") return;\n\n          console.log(\"[MCPAppsRenderer] Received from iframe:\", msg);\n\n          // Handle requests (need response)\n          if (isRequest(msg)) {\n            switch (msg.method) {\n              case \"ui/initialize\": {\n                // Respond with host capabilities\n                sendResponse(msg.id, {\n                  protocolVersion: PROTOCOL_VERSION,\n                  hostInfo: {\n                    name: \"CopilotKit MCP Apps Host\",\n                    version: \"1.0.0\",\n                  },\n                  hostCapabilities: {\n                    openLinks: {},\n                    logging: {},\n                  },\n                  hostContext: {\n                    theme: \"light\",\n                    platform: \"web\",\n                  },\n                });\n                break;\n              }\n\n              case \"ui/message\": {\n                // Add message to CopilotKit chat\n                const currentAgent = agentRef.current;\n\n                if (!currentAgent) {\n                  console.warn(\"[MCPAppsRenderer] ui/message: No agent available\");\n                  sendResponse(msg.id, { isError: false });\n                  break;\n                }\n\n                try {\n                  const params = msg.params as {\n                    role?: string;\n                    content?: Array<{ type: string; text?: string }>;\n                  };\n\n                  // Extract text content from the message\n                  const textContent = params.content\n                    ?.filter((c) => c.type === \"text\" && c.text)\n                    .map((c) => c.text)\n                    .join(\"\\n\") || \"\";\n\n                  if (textContent) {\n                    currentAgent.addMessage({\n                      id: crypto.randomUUID(),\n                      role: (params.role as \"user\" | \"assistant\") || \"user\",\n                      content: textContent,\n                    });\n                  }\n                  sendResponse(msg.id, { isError: false });\n                } catch (err) {\n                  console.error(\"[MCPAppsRenderer] ui/message error:\", err);\n                  sendResponse(msg.id, { isError: true });\n                }\n                break;\n              }\n\n              case \"ui/open-link\": {\n                // Open URL in new tab\n                const url = msg.params?.url as string | undefined;\n                if (url) {\n                  window.open(url, \"_blank\", \"noopener,noreferrer\");\n                  sendResponse(msg.id, { isError: false });\n                } else {\n                  sendErrorResponse(msg.id, -32602, \"Missing url parameter\");\n                }\n                break;\n              }\n\n              case \"tools/call\": {\n                // Proxy tool call to MCP server via agent.runAgent()\n                const { serverHash, serverId } = contentRef.current;\n                const currentAgent = agentRef.current;\n\n                if (!serverHash) {\n                  sendErrorResponse(msg.id, -32603, \"No server hash available for proxying\");\n                  break;\n                }\n\n                if (!currentAgent) {\n                  sendErrorResponse(msg.id, -32603, \"No agent available for proxying\");\n                  break;\n                }\n\n                try {\n                  // Use queue to wait for agent to be idle and serialize requests\n                  const runResult = await mcpAppsRequestQueue.enqueue(currentAgent, () =>\n                    currentAgent.runAgent({\n                      forwardedProps: {\n                        __proxiedMCPRequest: {\n                          serverHash,\n                          serverId, // optional, takes precedence if provided\n                          method: \"tools/call\",\n                          params: msg.params,\n                        },\n                      },\n                    })\n                  );\n\n                  // The result from runAgent contains the MCP response\n                  sendResponse(msg.id, runResult.result || {});\n                } catch (err) {\n                  console.error(\"[MCPAppsRenderer] tools/call error:\", err);\n                  sendErrorResponse(msg.id, -32603, String(err));\n                }\n                break;\n              }\n\n              default:\n                sendErrorResponse(msg.id, -32601, `Method not found: ${msg.method}`);\n            }\n          }\n\n          // Handle notifications (no response needed)\n          if (isNotification(msg)) {\n            switch (msg.method) {\n              case \"ui/notifications/initialized\": {\n                console.log(\"[MCPAppsRenderer] Inner iframe initialized\");\n                if (mounted) {\n                  setIframeReady(true);\n                }\n                break;\n              }\n\n              case \"ui/notifications/size-changed\": {\n                const { width, height } = msg.params || {};\n                console.log(\"[MCPAppsRenderer] Size change:\", { width, height });\n                if (mounted) {\n                  setIframeSize({\n                    width: typeof width === \"number\" ? width : undefined,\n                    height: typeof height === \"number\" ? height : undefined,\n                  });\n                }\n                break;\n              }\n\n              case \"notifications/message\": {\n                // Logging notification from the app\n                console.log(\"[MCPAppsRenderer] App log:\", msg.params);\n                break;\n              }\n            }\n          }\n        };\n\n        window.addEventListener(\"message\", messageHandler);\n\n        // Extract HTML content from fetched resource\n        let html: string;\n        if (fetchedResource.text) {\n          html = fetchedResource.text;\n        } else if (fetchedResource.blob) {\n          html = atob(fetchedResource.blob);\n        } else {\n          throw new Error(\"Resource has no text or blob content\");\n        }\n\n        // Send the resource content to the sandbox proxy\n        sendNotification(\"ui/notifications/sandbox-resource-ready\", { html });\n\n      } catch (err) {\n        console.error(\"[MCPAppsRenderer] Setup error:\", err);\n        if (mounted) {\n          setError(err instanceof Error ? err : new Error(String(err)));\n        }\n      }\n    };\n\n    setup();\n\n    return () => {\n      mounted = false;\n      // Clean up initial listener if still active\n      if (initialListener) {\n        window.removeEventListener(\"message\", initialListener);\n        initialListener = null;\n      }\n      if (messageHandler) {\n        window.removeEventListener(\"message\", messageHandler);\n      }\n      // Remove the iframe we created (using tracked reference, not DOM query)\n      // This works even if containerRef.current is null during unmount\n      if (createdIframe) {\n        createdIframe.remove();\n        createdIframe = null;\n      }\n      iframeRef.current = null;\n    };\n  }, [isLoading, fetchedResource, sendNotification, sendResponse, sendErrorResponse]);\n\n  // Effect 2: Update iframe size when it changes\n  useEffect(() => {\n    if (iframeRef.current) {\n      if (iframeSize.width !== undefined) {\n        // Use minWidth with min() to allow expansion but cap at 100%\n        iframeRef.current.style.minWidth = `min(${iframeSize.width}px, 100%)`;\n        iframeRef.current.style.width = \"100%\";\n      }\n      if (iframeSize.height !== undefined) {\n        iframeRef.current.style.height = `${iframeSize.height}px`;\n      }\n    }\n  }, [iframeSize]);\n\n  // Effect 3: Send tool input when iframe ready\n  useEffect(() => {\n    if (iframeReady && content.toolInput) {\n      console.log(\"[MCPAppsRenderer] Sending tool input:\", content.toolInput);\n      sendNotification(\"ui/notifications/tool-input\", {\n        arguments: content.toolInput,\n      });\n    }\n  }, [iframeReady, content.toolInput, sendNotification]);\n\n  // Effect 4: Send tool result when iframe ready\n  useEffect(() => {\n    if (iframeReady && content.result) {\n      console.log(\"[MCPAppsRenderer] Sending tool result:\", content.result);\n      sendNotification(\"ui/notifications/tool-result\", content.result);\n    }\n  }, [iframeReady, content.result, sendNotification]);\n\n  // Determine border styling based on prefersBorder metadata from fetched resource\n  // true = show border/background, false = none, undefined = host decides (we default to none)\n  const prefersBorder = fetchedResource?._meta?.ui?.prefersBorder;\n  const borderStyle = prefersBorder === true\n    ? {\n        borderRadius: \"8px\",\n        backgroundColor: \"#f9f9f9\",\n        border: \"1px solid #e0e0e0\",\n      }\n    : {};\n\n  return (\n    <div\n      ref={containerRef}\n      style={{\n        width: \"100%\",\n        height: iframeSize.height ? `${iframeSize.height}px` : \"auto\",\n        minHeight: \"100px\",\n        overflow: \"hidden\",\n        position: \"relative\",\n        ...borderStyle,\n      }}\n    >\n      {isLoading && (\n        <div style={{ padding: \"1rem\", color: \"#666\" }}>\n          Loading...\n        </div>\n      )}\n      {error && (\n        <div style={{ color: \"red\", padding: \"1rem\" }}>\n          Error: {error.message}\n        </div>\n      )}\n    </div>\n  );\n};\n","import { useCopilotChatConfiguration, useCopilotKit } from \"@/providers\";\nimport { ReactCustomMessageRendererPosition } from \"@/types/react-custom-message-renderer\";\nimport { Message } from \"@ag-ui/core\";\n\ninterface UseRenderCustomMessagesParams {\n  message: Message;\n  position: ReactCustomMessageRendererPosition;\n}\n\nexport function useRenderCustomMessages() {\n  const { copilotkit } = useCopilotKit();\n  const config = useCopilotChatConfiguration();\n\n  if (!config) {\n    return null;\n  }\n\n  const { agentId, threadId } = config;\n\n  const customMessageRenderers = copilotkit.renderCustomMessages\n    .filter((renderer) => renderer.agentId === undefined || renderer.agentId === agentId)\n    .sort((a, b) => {\n      const aHasAgent = a.agentId !== undefined;\n      const bHasAgent = b.agentId !== undefined;\n      if (aHasAgent === bHasAgent) return 0;\n      return aHasAgent ? -1 : 1;\n    });\n\n  return function (params: UseRenderCustomMessagesParams) {\n    if (!customMessageRenderers.length) {\n      return null;\n    }\n    const { message, position } = params;\n    const resolvedRunId =\n      copilotkit.getRunIdForMessage(agentId, threadId, message.id) ??\n      copilotkit.getRunIdsForThread(agentId, threadId).slice(-1)[0];\n    const runId = resolvedRunId ?? `missing-run-id:${message.id}`;\n    const agent = copilotkit.getAgent(agentId);\n    if (!agent) {\n      throw new Error(\"Agent not found\");\n    }\n\n    const messagesIdsInRun = resolvedRunId\n      ? agent.messages\n          .filter((msg) => copilotkit.getRunIdForMessage(agentId, threadId, msg.id) === resolvedRunId)\n          .map((msg) => msg.id)\n      : [message.id];\n\n    const rawMessageIndex = agent.messages.findIndex((msg) => msg.id === message.id);\n    const messageIndex = rawMessageIndex >= 0 ? rawMessageIndex : 0;\n    const messageIndexInRun = resolvedRunId ? Math.max(messagesIdsInRun.indexOf(message.id), 0) : 0;\n    const numberOfMessagesInRun = resolvedRunId ? messagesIdsInRun.length : 1;\n    const stateSnapshot = resolvedRunId\n      ? copilotkit.getStateByRun(agentId, threadId, resolvedRunId)\n      : undefined;\n\n    let result = null;\n    for (const renderer of customMessageRenderers) {\n      if (!renderer.render) {\n        continue;\n      }\n      const Component = renderer.render;\n      result = (\n        <Component\n          key={`${runId}-${message.id}-${position}`}\n          message={message}\n          position={position}\n          runId={runId}\n          messageIndex={messageIndex}\n          messageIndexInRun={messageIndexInRun}\n          numberOfMessagesInRun={numberOfMessagesInRun}\n          agentId={agentId}\n          stateSnapshot={stateSnapshot}\n        />\n      );\n      if (result) {\n        break;\n      }\n    }\n    return result;\n  };\n}\n","import { ActivityMessage } from \"@ag-ui/core\";\nimport { DEFAULT_AGENT_ID } from \"@copilotkitnext/shared\";\nimport { useCopilotKit, useCopilotChatConfiguration } from \"@/providers\";\nimport { useCallback, useMemo } from \"react\";\nimport { ReactActivityMessageRenderer } from \"@/types\";\n\nexport function useRenderActivityMessage() {\n  const { copilotkit } = useCopilotKit();\n  const config = useCopilotChatConfiguration();\n  const agentId = config?.agentId ?? DEFAULT_AGENT_ID;\n\n  const renderers = copilotkit.renderActivityMessages;\n\n  // Find the renderer for a given activity type\n  const findRenderer = useCallback(\n    (activityType: string): ReactActivityMessageRenderer<unknown> | null => {\n      if (!renderers.length) {\n        return null;\n      }\n\n      const matches = renderers.filter(\n        (renderer) => renderer.activityType === activityType\n      );\n\n      return (\n        matches.find((candidate) => candidate.agentId === agentId) ??\n        matches.find((candidate) => candidate.agentId === undefined) ??\n        renderers.find((candidate) => candidate.activityType === \"*\") ??\n        null\n      );\n    },\n    [agentId, renderers]\n  );\n\n  const renderActivityMessage = useCallback(\n    (message: ActivityMessage): React.ReactElement | null => {\n      const renderer = findRenderer(message.activityType);\n\n      if (!renderer) {\n        return null;\n      }\n\n      const parseResult = renderer.content.safeParse(message.content);\n\n      if (!parseResult.success) {\n        console.warn(\n          `Failed to parse content for activity message '${message.activityType}':`,\n          parseResult.error\n        );\n        return null;\n      }\n\n      const Component = renderer.render;\n      const agent = copilotkit.getAgent(agentId);\n\n      return (\n        <Component\n          key={message.id}\n          activityType={message.activityType}\n          content={parseResult.data}\n          message={message}\n          agent={agent}\n        />\n      );\n    },\n    [agentId, copilotkit, findRenderer]\n  );\n\n  return useMemo(\n    () => ({ renderActivityMessage, findRenderer }),\n    [renderActivityMessage, findRenderer]\n  );\n}\n","import { useEffect } from \"react\";\nimport { useCopilotKit } from \"../providers/CopilotKitProvider\";\nimport { ReactFrontendTool } from \"../types/frontend-tool\";\nimport { ReactToolCallRenderer } from \"../types/react-tool-call-renderer\";\n\nconst EMPTY_DEPS: ReadonlyArray<unknown> = [];\n\nexport function useFrontendTool<\n  T extends Record<string, unknown> = Record<string, unknown>,\n>(tool: ReactFrontendTool<T>, deps?: ReadonlyArray<unknown>) {\n  const { copilotkit } = useCopilotKit();\n  const extraDeps = deps ?? EMPTY_DEPS;\n\n  useEffect(() => {\n    const name = tool.name;\n\n    // Always register/override the tool for this name on mount\n    if (copilotkit.getTool({ toolName: name, agentId: tool.agentId })) {\n      console.warn(\n        `Tool '${name}' already exists for agent '${tool.agentId || 'global'}'. Overriding with latest registration.`\n      );\n      copilotkit.removeTool(name, tool.agentId);\n    }\n    copilotkit.addTool(tool);\n\n    // Register/override renderer by name and agentId through core\n    if (tool.render) {\n      // Get current render tool calls and merge with new entry\n      const keyOf = (rc: ReactToolCallRenderer<any>) => `${rc.agentId ?? \"\"}:${rc.name}`;\n      const currentRenderToolCalls = copilotkit.renderToolCalls as ReactToolCallRenderer<any>[];\n\n      // Build map from existing entries\n      const mergedMap = new Map<string, ReactToolCallRenderer<any>>();\n      for (const rc of currentRenderToolCalls) {\n        mergedMap.set(keyOf(rc), rc);\n      }\n\n      // Add/overwrite with new entry\n      const newEntry = {\n        name,\n        args: tool.parameters,\n        agentId: tool.agentId,\n        render: tool.render,\n      } as ReactToolCallRenderer<any>;\n      mergedMap.set(keyOf(newEntry), newEntry);\n\n      // Set the merged list back\n      copilotkit.setRenderToolCalls(Array.from(mergedMap.values()));\n    }\n\n    return () => {\n      copilotkit.removeTool(name, tool.agentId);\n      // we are intentionally not removing the render here so that the tools can still render in the chat history\n    };\n    // Depend on stable keys by default and allow callers to opt into\n    // additional dependencies for dynamic tool configuration.\n  }, [tool.name, copilotkit, extraDeps.length, ...extraDeps]);\n}\n","import { ReactToolCallRenderer } from \"@/types/react-tool-call-renderer\";\nimport { useFrontendTool } from \"./use-frontend-tool\";\nimport { ReactFrontendTool } from \"@/types/frontend-tool\";\nimport { ReactHumanInTheLoop } from \"@/types/human-in-the-loop\";\nimport { useCallback, useRef, useEffect } from \"react\";\nimport React from \"react\";\nimport { useCopilotKit } from \"@/providers/CopilotKitProvider\";\n\nexport function useHumanInTheLoop<T extends Record<string, unknown> = Record<string, unknown>>(\n  tool: ReactHumanInTheLoop<T>,\n  deps?: ReadonlyArray<unknown>,\n) {\n  const { copilotkit } = useCopilotKit();\n  const resolvePromiseRef = useRef<((result: unknown) => void) | null>(null);\n\n  const respond = useCallback(async (result: unknown) => {\n    if (resolvePromiseRef.current) {\n      resolvePromiseRef.current(result);\n      resolvePromiseRef.current = null;\n    }\n  }, []);\n\n  const handler = useCallback(async () => {\n    return new Promise((resolve) => {\n      resolvePromiseRef.current = resolve;\n    });\n  }, []);\n\n  const RenderComponent: ReactToolCallRenderer<T>[\"render\"] = useCallback(\n    (props) => {\n      const ToolComponent = tool.render;\n\n      // Enhance props based on current status\n      if (props.status === \"inProgress\") {\n        const enhancedProps = {\n          ...props,\n          name: tool.name,\n          description: tool.description || \"\",\n          respond: undefined,\n        };\n        return React.createElement(ToolComponent, enhancedProps);\n      } else if (props.status === \"executing\") {\n        const enhancedProps = {\n          ...props,\n          name: tool.name,\n          description: tool.description || \"\",\n          respond,\n        };\n        return React.createElement(ToolComponent, enhancedProps);\n      } else if (props.status === \"complete\") {\n        const enhancedProps = {\n          ...props,\n          name: tool.name,\n          description: tool.description || \"\",\n          respond: undefined,\n        };\n        return React.createElement(ToolComponent, enhancedProps);\n      }\n\n      // Fallback - just render with original props\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return React.createElement(ToolComponent, props as any);\n    },\n    [tool.render, tool.name, tool.description, respond],\n  );\n\n  const frontendTool: ReactFrontendTool<T> = {\n    ...tool,\n    handler,\n    render: RenderComponent,\n  };\n\n  useFrontendTool(frontendTool, deps);\n\n  // Human-in-the-loop tools should remove their renderer on unmount\n  // since they can't respond to user interactions anymore\n  useEffect(() => {\n    return () => {\n      const keyOf = (rc: ReactToolCallRenderer<any>) => `${rc.agentId ?? \"\"}:${rc.name}`;\n      const currentRenderToolCalls = copilotkit.renderToolCalls as ReactToolCallRenderer<any>[];\n      const filtered = currentRenderToolCalls.filter(\n        (rc) => keyOf(rc) !== keyOf({ name: tool.name, agentId: tool.agentId } as any),\n      );\n      copilotkit.setRenderToolCalls(filtered);\n    };\n  }, [copilotkit, tool.name, tool.agentId]);\n}\n","import { useCopilotKit } from \"@/providers/CopilotKitProvider\";\nimport { useMemo, useEffect, useReducer } from \"react\";\nimport { DEFAULT_AGENT_ID } from \"@copilotkitnext/shared\";\nimport { AbstractAgent } from \"@ag-ui/client\";\nimport { ProxiedCopilotRuntimeAgent, CopilotKitCoreRuntimeConnectionStatus } from \"@copilotkitnext/core\";\n\nexport enum UseAgentUpdate {\n  OnMessagesChanged = \"OnMessagesChanged\",\n  OnStateChanged = \"OnStateChanged\",\n  OnRunStatusChanged = \"OnRunStatusChanged\",\n}\n\nconst ALL_UPDATES: UseAgentUpdate[] = [\n  UseAgentUpdate.OnMessagesChanged,\n  UseAgentUpdate.OnStateChanged,\n  UseAgentUpdate.OnRunStatusChanged,\n];\n\nexport interface UseAgentProps {\n  agentId?: string;\n  updates?: UseAgentUpdate[];\n}\n\nexport function useAgent({ agentId, updates }: UseAgentProps = {}) {\n  agentId ??= DEFAULT_AGENT_ID;\n\n  const { copilotkit } = useCopilotKit();\n  const [, forceUpdate] = useReducer((x) => x + 1, 0);\n\n  const updateFlags = useMemo(\n    () => updates ?? ALL_UPDATES,\n    [JSON.stringify(updates)]\n  );\n\n  const agent: AbstractAgent = useMemo(() => {\n    const existing = copilotkit.getAgent(agentId);\n    if (existing) {\n      return existing;\n    }\n\n    const isRuntimeConfigured = copilotkit.runtimeUrl !== undefined;\n    const status = copilotkit.runtimeConnectionStatus;\n\n    // While runtime is not yet synced, return a provisional runtime agent\n    if (\n      isRuntimeConfigured &&\n      (status === CopilotKitCoreRuntimeConnectionStatus.Disconnected ||\n        status === CopilotKitCoreRuntimeConnectionStatus.Connecting)\n    ) {\n      const provisional = new ProxiedCopilotRuntimeAgent({\n        runtimeUrl: copilotkit.runtimeUrl,\n        agentId,\n        transport: copilotkit.runtimeTransport,\n      });\n      // Apply current headers so runs/connects inherit them\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (provisional as any).headers = { ...copilotkit.headers };\n      return provisional;\n    }\n\n    // If no runtime is configured (dev/local), return a no-op agent to satisfy the\n    // non-undefined contract without forcing network behavior.\n    // After runtime has synced (Connected or Error) or no runtime configured and the agent doesn't exist, throw a descriptive error\n    const knownAgents = Object.keys(copilotkit.agents ?? {});\n    const runtimePart = isRuntimeConfigured ? `runtimeUrl=${copilotkit.runtimeUrl}` : \"no runtimeUrl\";\n    throw new Error(\n      `useAgent: Agent '${agentId}' not found after runtime sync (${runtimePart}). ` +\n        (knownAgents.length ? `Known agents: [${knownAgents.join(\", \")}]` : \"No agents registered.\") +\n        \" Verify your runtime /info and/or agents__unsafe_dev_only.\",\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    agentId,\n    copilotkit.agents,\n    copilotkit.runtimeConnectionStatus,\n    copilotkit.runtimeUrl,\n    copilotkit.runtimeTransport,\n    JSON.stringify(copilotkit.headers),\n    copilotkit,\n  ]);\n\n  useEffect(() => {\n    if (updateFlags.length === 0) {\n      return;\n    }\n\n    const handlers: Parameters<AbstractAgent[\"subscribe\"]>[0] = {};\n\n    if (updateFlags.includes(UseAgentUpdate.OnMessagesChanged)) {\n      // Content stripping for immutableContent renderers is handled by CopilotKitCoreReact\n      handlers.onMessagesChanged = () => {\n        forceUpdate();\n      };\n    }\n\n    if (updateFlags.includes(UseAgentUpdate.OnStateChanged)) {\n      handlers.onStateChanged = forceUpdate;\n    }\n\n    if (updateFlags.includes(UseAgentUpdate.OnRunStatusChanged)) {\n      handlers.onRunInitialized = forceUpdate;\n      handlers.onRunFinalized = forceUpdate;\n      handlers.onRunFailed = forceUpdate;\n    }\n\n    const subscription = agent.subscribe(handlers);\n    return () => subscription.unsubscribe();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [agent, forceUpdate, JSON.stringify(updateFlags)]);\n\n  return {\n    agent,\n  };\n}\n","import { useCopilotKit } from \"../providers/CopilotKitProvider\";\nimport { useEffect, useMemo } from \"react\";\n\n/**\n * Represents any value that can be serialized to JSON.\n */\nexport type JsonSerializable =\n  | string\n  | number\n  | boolean\n  | null\n  | JsonSerializable[]\n  | { [key: string]: JsonSerializable };\n\n/**\n * Context configuration for useAgentContext.\n * Accepts any JSON-serializable value which will be converted to a string.\n */\nexport interface AgentContextInput {\n  /** A human-readable description of what this context represents */\n  description: string;\n  /** The context value - will be converted to a JSON string if not already a string */\n  value: JsonSerializable;\n}\n\nexport function useAgentContext(context: AgentContextInput) {\n  const { description, value } = context;\n  const { copilotkit } = useCopilotKit();\n\n  const stringValue = useMemo(() => {\n    if (typeof value === \"string\") {\n      return value;\n    }\n    return JSON.stringify(value);\n  }, [value]);\n\n  useEffect(() => {\n    if (!copilotkit) return;\n\n    const id = copilotkit.addContext({ description, value: stringValue });\n    return () => {\n      copilotkit.removeContext(id);\n    };\n  }, [description, stringValue, copilotkit]);\n}\n","import { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { Suggestion } from \"@copilotkitnext/core\";\nimport { useCopilotKit } from \"@/providers/CopilotKitProvider\";\nimport { useCopilotChatConfiguration } from \"@/providers/CopilotChatConfigurationProvider\";\nimport { DEFAULT_AGENT_ID } from \"@copilotkitnext/shared\";\n\nexport interface UseSuggestionsOptions {\n  agentId?: string;\n}\n\nexport interface UseSuggestionsResult {\n  suggestions: Suggestion[];\n  reloadSuggestions: () => void;\n  clearSuggestions: () => void;\n  isLoading: boolean;\n}\n\nexport function useSuggestions({ agentId }: UseSuggestionsOptions = {}): UseSuggestionsResult {\n  const { copilotkit } = useCopilotKit();\n  const config = useCopilotChatConfiguration();\n  const resolvedAgentId = useMemo(() => agentId ?? config?.agentId ?? DEFAULT_AGENT_ID, [agentId, config?.agentId]);\n\n  const [suggestions, setSuggestions] = useState<Suggestion[]>(() => {\n    const result = copilotkit.getSuggestions(resolvedAgentId);\n    return result.suggestions;\n  });\n  const [isLoading, setIsLoading] = useState(() => {\n    const result = copilotkit.getSuggestions(resolvedAgentId);\n    return result.isLoading;\n  });\n\n  useEffect(() => {\n    const result = copilotkit.getSuggestions(resolvedAgentId);\n    setSuggestions(result.suggestions);\n    setIsLoading(result.isLoading);\n  }, [copilotkit, resolvedAgentId]);\n\n  useEffect(() => {\n    const subscription = copilotkit.subscribe({\n      onSuggestionsChanged: ({ agentId: changedAgentId, suggestions }) => {\n        if (changedAgentId !== resolvedAgentId) {\n          return;\n        }\n        setSuggestions(suggestions);\n      },\n      onSuggestionsStartedLoading: ({ agentId: changedAgentId }) => {\n        if (changedAgentId !== resolvedAgentId) {\n          return;\n        }\n        setIsLoading(true);\n      },\n      onSuggestionsFinishedLoading: ({ agentId: changedAgentId }) => {\n        if (changedAgentId !== resolvedAgentId) {\n          return;\n        }\n        setIsLoading(false);\n      },\n      onSuggestionsConfigChanged: () => {\n        const result = copilotkit.getSuggestions(resolvedAgentId);\n        setSuggestions(result.suggestions);\n        setIsLoading(result.isLoading);\n      },\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [copilotkit, resolvedAgentId]);\n\n  const reloadSuggestions = useCallback(() => {\n    copilotkit.reloadSuggestions(resolvedAgentId);\n    // Loading state is handled by onSuggestionsStartedLoading event\n  }, [copilotkit, resolvedAgentId]);\n\n  const clearSuggestions = useCallback(() => {\n    copilotkit.clearSuggestions(resolvedAgentId);\n    // State updates are handled by onSuggestionsChanged event\n  }, [copilotkit, resolvedAgentId]);\n\n  return {\n    suggestions,\n    reloadSuggestions,\n    clearSuggestions,\n    isLoading,\n  };\n}\n","import { useCallback, useEffect, useMemo, useRef } from \"react\";\nimport { useCopilotKit } from \"@/providers/CopilotKitProvider\";\nimport { useCopilotChatConfiguration } from \"@/providers/CopilotChatConfigurationProvider\";\nimport { DEFAULT_AGENT_ID } from \"@copilotkitnext/shared\";\nimport {\n  DynamicSuggestionsConfig,\n  StaticSuggestionsConfig,\n  SuggestionsConfig,\n  Suggestion,\n} from \"@copilotkitnext/core\";\n\ntype StaticSuggestionInput = Omit<Suggestion, \"isLoading\"> & Partial<Pick<Suggestion, \"isLoading\">>;\n\ntype StaticSuggestionsConfigInput = Omit<StaticSuggestionsConfig, \"suggestions\"> & {\n  suggestions: StaticSuggestionInput[];\n};\n\ntype SuggestionsConfigInput = DynamicSuggestionsConfig | StaticSuggestionsConfigInput;\n\nexport function useConfigureSuggestions(\n  config: SuggestionsConfigInput | null | undefined,\n  deps?: ReadonlyArray<unknown>,\n): void {\n  const { copilotkit } = useCopilotKit();\n  const chatConfig = useCopilotChatConfiguration();\n  const extraDeps = deps ?? [];\n\n  const resolvedConsumerAgentId = useMemo(() => chatConfig?.agentId ?? DEFAULT_AGENT_ID, [chatConfig?.agentId]);\n\n  const rawConsumerAgentId = useMemo(() => (config ? (config as SuggestionsConfigInput).consumerAgentId : undefined), [config]);\n\n  const normalizationCacheRef = useRef<{ serialized: string | null; config: SuggestionsConfig | null }>({\n    serialized: null,\n    config: null,\n  });\n\n  const { normalizedConfig, serializedConfig } = useMemo(() => {\n    if (!config) {\n      normalizationCacheRef.current = { serialized: null, config: null };\n      return { normalizedConfig: null, serializedConfig: null };\n    }\n\n    if (config.available === \"disabled\") {\n      normalizationCacheRef.current = { serialized: null, config: null };\n      return { normalizedConfig: null, serializedConfig: null };\n    }\n\n    let built: SuggestionsConfig;\n    if (isDynamicConfig(config)) {\n      built = {\n        ...config,\n      } satisfies DynamicSuggestionsConfig;\n    } else {\n      const normalizedSuggestions = normalizeStaticSuggestions(config.suggestions);\n      const baseConfig: StaticSuggestionsConfig = {\n        ...config,\n        suggestions: normalizedSuggestions,\n      };\n      built = baseConfig;\n    }\n\n    const serialized = JSON.stringify(built);\n    const cache = normalizationCacheRef.current;\n    if (cache.serialized === serialized && cache.config) {\n      return { normalizedConfig: cache.config, serializedConfig: serialized };\n    }\n\n    normalizationCacheRef.current = { serialized, config: built };\n    return { normalizedConfig: built, serializedConfig: serialized };\n  }, [config, resolvedConsumerAgentId, ...extraDeps]);\n  const latestConfigRef = useRef<SuggestionsConfig | null>(null);\n  latestConfigRef.current = normalizedConfig;\n  const previousSerializedConfigRef = useRef<string | null>(null);\n\n  const targetAgentId = useMemo(() => {\n    if (!normalizedConfig) {\n      return resolvedConsumerAgentId;\n    }\n    const consumer = (normalizedConfig as StaticSuggestionsConfig | DynamicSuggestionsConfig).consumerAgentId;\n    if (!consumer || consumer === \"*\") {\n      return resolvedConsumerAgentId;\n    }\n    return consumer;\n  }, [normalizedConfig, resolvedConsumerAgentId]);\n\n  const isGlobalConfig = rawConsumerAgentId === undefined || rawConsumerAgentId === \"*\";\n\n  const requestReload = useCallback(() => {\n    if (!normalizedConfig) {\n      return;\n    }\n\n    if (isGlobalConfig) {\n      const agents = Object.values(copilotkit.agents ?? {});\n      for (const entry of agents) {\n        const agentId = entry.agentId;\n        if (!agentId) {\n          continue;\n        }\n        if (!entry.isRunning) {\n          copilotkit.reloadSuggestions(agentId);\n        }\n      }\n      return;\n    }\n\n    if (!targetAgentId) {\n      return;\n    }\n\n    copilotkit.reloadSuggestions(targetAgentId);\n  }, [copilotkit, isGlobalConfig, normalizedConfig, targetAgentId]);\n\n  useEffect(() => {\n    if (!serializedConfig || !latestConfigRef.current) {\n      return;\n    }\n\n    const id = copilotkit.addSuggestionsConfig(latestConfigRef.current);\n\n    requestReload();\n\n    return () => {\n      copilotkit.removeSuggestionsConfig(id);\n    };\n  }, [copilotkit, serializedConfig, requestReload]);\n\n  useEffect(() => {\n    if (!normalizedConfig) {\n      previousSerializedConfigRef.current = null;\n      return;\n    }\n    if (serializedConfig && previousSerializedConfigRef.current === serializedConfig) {\n      return;\n    }\n    if (serializedConfig) {\n      previousSerializedConfigRef.current = serializedConfig;\n    }\n    requestReload();\n  }, [normalizedConfig, requestReload, serializedConfig]);\n\n  useEffect(() => {\n    if (!normalizedConfig || extraDeps.length === 0) {\n      return;\n    }\n    requestReload();\n  }, [extraDeps.length, normalizedConfig, requestReload, ...extraDeps]);\n\n}\n\nfunction isDynamicConfig(config: SuggestionsConfigInput): config is DynamicSuggestionsConfig {\n  return \"instructions\" in config;\n}\n\nfunction normalizeStaticSuggestions(suggestions: StaticSuggestionInput[]): Suggestion[] {\n  return suggestions.map((suggestion) => ({\n    ...suggestion,\n    isLoading: suggestion.isLoading ?? false,\n  }));\n}\n","import { useRenderToolCall } from \"@/hooks\";\nimport { AssistantMessage, Message, ToolMessage } from \"@ag-ui/core\";\nimport React from \"react\";\n\nexport type CopilotChatToolCallsViewProps = {\n  message: AssistantMessage;\n  messages?: Message[];\n};\n\nexport function CopilotChatToolCallsView({\n  message,\n  messages = [],\n}: CopilotChatToolCallsViewProps) {\n  const renderToolCall = useRenderToolCall();\n\n  if (!message.toolCalls || message.toolCalls.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      {message.toolCalls.map((toolCall) => {\n        const toolMessage = messages.find(\n          (m) => m.role === \"tool\" && m.toolCallId === toolCall.id\n        ) as ToolMessage | undefined;\n\n        return (\n          <React.Fragment key={toolCall.id}>\n            {renderToolCall({\n              toolCall,\n              toolMessage,\n            })}\n          </React.Fragment>\n        );\n      })}\n    </>\n  );\n}\n\nexport default CopilotChatToolCallsView;\n","import { useMemo, useState } from \"react\";\nimport { Copy, Check, Edit, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport {\n  useCopilotChatConfiguration,\n  CopilotChatDefaultLabels,\n} from \"@/providers/CopilotChatConfigurationProvider\";\nimport { twMerge } from \"tailwind-merge\";\nimport { Button } from \"@/components/ui/button\";\nimport { UserMessage } from \"@ag-ui/core\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { renderSlot, WithSlots } from \"@/lib/slots\";\n\nfunction flattenUserMessageContent(content?: UserMessage[\"content\"]): string {\n  if (!content) {\n    return \"\";\n  }\n\n  if (typeof content === \"string\") {\n    return content;\n  }\n\n  return content\n    .map((part) => {\n      if (\n        part &&\n        typeof part === \"object\" &&\n        \"type\" in part &&\n        (part as { type?: unknown }).type === \"text\" &&\n        typeof (part as { text?: unknown }).text === \"string\"\n      ) {\n        return (part as { text: string }).text;\n      }\n      return \"\";\n    })\n    .filter((text) => text.length > 0)\n    .join(\"\\n\");\n}\n\nexport interface CopilotChatUserMessageOnEditMessageProps {\n  message: UserMessage;\n}\n\nexport interface CopilotChatUserMessageOnSwitchToBranchProps {\n  message: UserMessage;\n  branchIndex: number;\n  numberOfBranches: number;\n}\n\nexport type CopilotChatUserMessageProps = WithSlots<\n  {\n    messageRenderer: typeof CopilotChatUserMessage.MessageRenderer;\n    toolbar: typeof CopilotChatUserMessage.Toolbar;\n    copyButton: typeof CopilotChatUserMessage.CopyButton;\n    editButton: typeof CopilotChatUserMessage.EditButton;\n    branchNavigation: typeof CopilotChatUserMessage.BranchNavigation;\n  },\n  {\n    onEditMessage?: (props: CopilotChatUserMessageOnEditMessageProps) => void;\n    onSwitchToBranch?: (\n      props: CopilotChatUserMessageOnSwitchToBranchProps\n    ) => void;\n    message: UserMessage;\n    branchIndex?: number;\n    numberOfBranches?: number;\n    additionalToolbarItems?: React.ReactNode;\n  } & React.HTMLAttributes<HTMLDivElement>\n>;\n\nexport function CopilotChatUserMessage({\n  message,\n  onEditMessage,\n  branchIndex,\n  numberOfBranches,\n  onSwitchToBranch,\n  additionalToolbarItems,\n  messageRenderer,\n  toolbar,\n  copyButton,\n  editButton,\n  branchNavigation,\n  children,\n  className,\n  ...props\n}: CopilotChatUserMessageProps) {\n  const flattenedContent = useMemo(\n    () => flattenUserMessageContent(message.content),\n    [message.content]\n  );\n\n  const BoundMessageRenderer = renderSlot(\n    messageRenderer,\n    CopilotChatUserMessage.MessageRenderer,\n    {\n      content: flattenedContent,\n    }\n  );\n\n  const BoundCopyButton = renderSlot(\n    copyButton,\n    CopilotChatUserMessage.CopyButton,\n    {\n      onClick: async () => {\n        if (flattenedContent) {\n          try {\n            await navigator.clipboard.writeText(flattenedContent);\n          } catch (err) {\n            console.error(\"Failed to copy message:\", err);\n          }\n        }\n      },\n    }\n  );\n\n  const BoundEditButton = renderSlot(\n    editButton,\n    CopilotChatUserMessage.EditButton,\n    {\n      onClick: () => onEditMessage?.({ message }),\n    }\n  );\n\n  const BoundBranchNavigation = renderSlot(\n    branchNavigation,\n    CopilotChatUserMessage.BranchNavigation,\n    {\n      currentBranch: branchIndex,\n      numberOfBranches,\n      onSwitchToBranch,\n      message,\n    }\n  );\n\n  const showBranchNavigation =\n    numberOfBranches && numberOfBranches > 1 && onSwitchToBranch;\n\n  const BoundToolbar = renderSlot(toolbar, CopilotChatUserMessage.Toolbar, {\n    children: (\n      <div className=\"flex items-center gap-1 justify-end\">\n        {additionalToolbarItems}\n        {BoundCopyButton}\n        {onEditMessage && BoundEditButton}\n        {showBranchNavigation && BoundBranchNavigation}\n      </div>\n    ),\n  });\n\n  if (children) {\n    return (\n      <>\n        {children({\n          messageRenderer: BoundMessageRenderer,\n          toolbar: BoundToolbar,\n          copyButton: BoundCopyButton,\n          editButton: BoundEditButton,\n          branchNavigation: BoundBranchNavigation,\n          message,\n          branchIndex,\n          numberOfBranches,\n          additionalToolbarItems,\n        })}\n      </>\n    );\n  }\n\n  return (\n    <div\n      className={twMerge(\"flex flex-col items-end group pt-10\", className)}\n      data-message-id={message.id}\n      {...props}\n    >\n      {BoundMessageRenderer}\n      {BoundToolbar}\n    </div>\n  );\n}\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace CopilotChatUserMessage {\n  export const Container: React.FC<\n    React.PropsWithChildren<React.HTMLAttributes<HTMLDivElement>>\n  > = ({ children, className, ...props }) => (\n    <div\n      className={twMerge(\"flex flex-col items-end group\", className)}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n\n  export const MessageRenderer: React.FC<{\n    content: string;\n    className?: string;\n  }> = ({ content, className }) => (\n    <div\n      className={twMerge(\n        \"prose dark:prose-invert bg-muted relative max-w-[80%] rounded-[18px] px-4 py-1.5 data-[multiline]:py-3 inline-block whitespace-pre-wrap\",\n        className\n      )}\n    >\n      {content}\n    </div>\n  );\n\n  export const Toolbar: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({\n    className,\n    ...props\n  }) => (\n    <div\n      className={twMerge(\n        \"w-full bg-transparent flex items-center justify-end -mr-[5px] mt-[4px] invisible group-hover:visible\",\n        className\n      )}\n      {...props}\n    />\n  );\n\n  export const ToolbarButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement> & {\n      title: string;\n      children: React.ReactNode;\n    }\n  > = ({ title, children, className, ...props }) => {\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            type=\"button\"\n            variant=\"assistantMessageToolbarButton\"\n            aria-label={title}\n            className={twMerge(className)}\n            {...props}\n          >\n            {children}\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent side=\"bottom\">\n          <p>{title}</p>\n        </TooltipContent>\n      </Tooltip>\n    );\n  };\n\n  export const CopyButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement> & { copied?: boolean }\n  > = ({ className, title, onClick, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n    const [copied, setCopied] = useState(false);\n\n    const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n\n      if (onClick) {\n        onClick(event);\n      }\n    };\n\n    return (\n      <ToolbarButton\n        title={title || labels.userMessageToolbarCopyMessageLabel}\n        onClick={handleClick}\n        className={className}\n        {...props}\n      >\n        {copied ? (\n          <Check className=\"size-[18px]\" />\n        ) : (\n          <Copy className=\"size-[18px]\" />\n        )}\n      </ToolbarButton>\n    );\n  };\n\n  export const EditButton: React.FC<\n    React.ButtonHTMLAttributes<HTMLButtonElement>\n  > = ({ className, title, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n    return (\n      <ToolbarButton\n        title={title || labels.userMessageToolbarEditMessageLabel}\n        className={className}\n        {...props}\n      >\n        <Edit className=\"size-[18px]\" />\n      </ToolbarButton>\n    );\n  };\n\n  export const BranchNavigation: React.FC<\n    React.HTMLAttributes<HTMLDivElement> & {\n      currentBranch?: number;\n      numberOfBranches?: number;\n      onSwitchToBranch?: (\n        props: CopilotChatUserMessageOnSwitchToBranchProps\n      ) => void;\n      message: UserMessage;\n    }\n  > = ({\n    className,\n    currentBranch = 0,\n    numberOfBranches = 1,\n    onSwitchToBranch,\n    message,\n    ...props\n  }) => {\n    if (!numberOfBranches || numberOfBranches <= 1 || !onSwitchToBranch) {\n      return null;\n    }\n\n    const canGoPrev = currentBranch > 0;\n    const canGoNext = currentBranch < numberOfBranches - 1;\n\n    return (\n      <div className={twMerge(\"flex items-center gap-1\", className)} {...props}>\n        <Button\n          type=\"button\"\n          variant=\"assistantMessageToolbarButton\"\n          onClick={() =>\n            onSwitchToBranch?.({\n              branchIndex: currentBranch - 1,\n              numberOfBranches,\n              message,\n            })\n          }\n          disabled={!canGoPrev}\n          className=\"h-6 w-6 p-0\"\n        >\n          <ChevronLeft className=\"size-[20px]\" />\n        </Button>\n        <span className=\"text-sm text-muted-foreground px-0 font-medium\">\n          {currentBranch + 1}/{numberOfBranches}\n        </span>\n        <Button\n          type=\"button\"\n          variant=\"assistantMessageToolbarButton\"\n          onClick={() =>\n            onSwitchToBranch?.({\n              branchIndex: currentBranch + 1,\n              numberOfBranches,\n              message,\n            })\n          }\n          disabled={!canGoNext}\n          className=\"h-6 w-6 p-0\"\n        >\n          <ChevronRight className=\"size-[20px]\" />\n        </Button>\n      </div>\n    );\n  };\n}\n\nCopilotChatUserMessage.Container.displayName =\n  \"CopilotChatUserMessage.Container\";\nCopilotChatUserMessage.MessageRenderer.displayName =\n  \"CopilotChatUserMessage.MessageRenderer\";\nCopilotChatUserMessage.Toolbar.displayName = \"CopilotChatUserMessage.Toolbar\";\nCopilotChatUserMessage.ToolbarButton.displayName =\n  \"CopilotChatUserMessage.ToolbarButton\";\nCopilotChatUserMessage.CopyButton.displayName =\n  \"CopilotChatUserMessage.CopyButton\";\nCopilotChatUserMessage.EditButton.displayName =\n  \"CopilotChatUserMessage.EditButton\";\nCopilotChatUserMessage.BranchNavigation.displayName =\n  \"CopilotChatUserMessage.BranchNavigation\";\n\nexport default CopilotChatUserMessage;\n","import React from \"react\";\nimport { Loader2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface CopilotChatSuggestionPillProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  /** Optional icon to render on the left side when not loading. */\n  icon?: React.ReactNode;\n  /** Whether the pill should display a loading spinner. */\n  isLoading?: boolean;\n}\n\nconst baseClasses =\n  \"group inline-flex h-7 sm:h-8 items-center gap-1 sm:gap-1.5 rounded-full border border-border/60 bg-background px-2.5 sm:px-3 text-[11px] sm:text-xs leading-none text-foreground transition-colors cursor-pointer hover:bg-accent/60 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:text-muted-foreground disabled:hover:bg-background disabled:hover:text-muted-foreground pointer-events-auto\";\n\nconst labelClasses = \"whitespace-nowrap font-medium leading-none\";\n\nexport const CopilotChatSuggestionPill = React.forwardRef<\n  HTMLButtonElement,\n  CopilotChatSuggestionPillProps\n>(function CopilotChatSuggestionPill(\n  { className, children, icon, isLoading, type, ...props },\n  ref\n) {\n  const showIcon = !isLoading && icon;\n\n  return (\n    <button\n      ref={ref}\n      data-slot=\"suggestion-pill\"\n      className={cn(baseClasses, className)}\n      type={type ?? \"button\"}\n      aria-busy={isLoading || undefined}\n      disabled={isLoading || props.disabled}\n      {...props}\n    >\n      {isLoading ? (\n        <span className=\"flex h-3.5 sm:h-4 w-3.5 sm:w-4 items-center justify-center text-muted-foreground\">\n          <Loader2 className=\"h-3.5 sm:h-4 w-3.5 sm:w-4 animate-spin\" aria-hidden=\"true\" />\n        </span>\n      ) : (\n        showIcon && (\n          <span className=\"flex h-3.5 sm:h-4 w-3.5 sm:w-4 items-center justify-center text-muted-foreground\">{icon}</span>\n        )\n      )}\n      <span className={labelClasses}>{children}</span>\n    </button>\n  );\n});\n\nCopilotChatSuggestionPill.displayName = \"CopilotChatSuggestionPill\";\n\nexport default CopilotChatSuggestionPill;\n","import React from \"react\";\nimport { Suggestion } from \"@copilotkitnext/core\";\nimport { renderSlot, WithSlots } from \"@/lib/slots\";\nimport { cn } from \"@/lib/utils\";\nimport CopilotChatSuggestionPill, {\n  CopilotChatSuggestionPillProps,\n} from \"./CopilotChatSuggestionPill\";\n\nconst DefaultContainer = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(function DefaultContainer({ className, ...props }, ref) {\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"flex flex-wrap items-center gap-1.5 sm:gap-2 pl-0 pr-4 sm:px-0 pointer-events-none\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\n\nexport type CopilotChatSuggestionViewProps = WithSlots<\n  {\n    container: typeof DefaultContainer;\n    suggestion: typeof CopilotChatSuggestionPill;\n  },\n  {\n    suggestions: Suggestion[];\n    onSelectSuggestion?: (suggestion: Suggestion, index: number) => void;\n    loadingIndexes?: ReadonlyArray<number>;\n  } & React.HTMLAttributes<HTMLDivElement>\n>;\n\nexport const CopilotChatSuggestionView = React.forwardRef<\n  HTMLDivElement,\n  CopilotChatSuggestionViewProps\n>(function CopilotChatSuggestionView(\n  {\n    suggestions,\n    onSelectSuggestion,\n    loadingIndexes,\n    container,\n    suggestion: suggestionSlot,\n    className,\n    children,\n    ...restProps\n  },\n  ref,\n) {\n  const loadingSet = React.useMemo(() => {\n    if (!loadingIndexes || loadingIndexes.length === 0) {\n      return new Set<number>();\n    }\n    return new Set(loadingIndexes);\n  }, [loadingIndexes]);\n\n  const ContainerElement = renderSlot(container, DefaultContainer, {\n    ref,\n    className,\n    ...restProps,\n  });\n\n  const suggestionElements = suggestions.map((suggestion, index) => {\n    const isLoading = loadingSet.has(index) || suggestion.isLoading === true;\n    const pill = renderSlot<\n      typeof CopilotChatSuggestionPill,\n      CopilotChatSuggestionPillProps\n    >(suggestionSlot, CopilotChatSuggestionPill, {\n      children: suggestion.title,\n      isLoading,\n      type: \"button\",\n      onClick: () => onSelectSuggestion?.(suggestion, index),\n    });\n\n    return React.cloneElement(pill, {\n      key: `${suggestion.title}-${index}`,\n    });\n  });\n\n  const boundContainer = React.cloneElement(\n    ContainerElement,\n    undefined,\n    suggestionElements,\n  );\n\n  if (typeof children === \"function\") {\n    const sampleSuggestion = renderSlot<\n      typeof CopilotChatSuggestionPill,\n      CopilotChatSuggestionPillProps\n    >(suggestionSlot, CopilotChatSuggestionPill, {\n      children: suggestions[0]?.title ?? \"\",\n      isLoading:\n        suggestions.length > 0 ? loadingSet.has(0) || suggestions[0]?.isLoading === true : false,\n      type: \"button\",\n    });\n\n    return (\n      <>\n        {children({\n          container: boundContainer,\n          suggestion: sampleSuggestion,\n          suggestions,\n          onSelectSuggestion,\n          loadingIndexes,\n          className,\n          ...restProps,\n        })}\n      </>\n    );\n  }\n\n  if (children) {\n    return (\n      <>\n        {boundContainer}\n        {children}\n      </>\n    );\n  }\n\n  return boundContainer;\n});\n\nCopilotChatSuggestionView.displayName = \"CopilotChatSuggestionView\";\n\nexport default CopilotChatSuggestionView;\n","import React, { useEffect, useReducer } from \"react\";\nimport { WithSlots, renderSlot } from \"@/lib/slots\";\nimport CopilotChatAssistantMessage from \"./CopilotChatAssistantMessage\";\nimport CopilotChatUserMessage from \"./CopilotChatUserMessage\";\nimport { ActivityMessage, AssistantMessage, Message, UserMessage } from \"@ag-ui/core\";\nimport { twMerge } from \"tailwind-merge\";\nimport { useRenderActivityMessage, useRenderCustomMessages } from \"@/hooks\";\nimport { useCopilotKit } from \"@/providers/CopilotKitProvider\";\nimport { useCopilotChatConfiguration } from \"@/providers/CopilotChatConfigurationProvider\";\n\n\n/**\n * Memoized wrapper for assistant messages to prevent re-renders when other messages change.\n */\nconst MemoizedAssistantMessage = React.memo(\n  function MemoizedAssistantMessage({\n    message,\n    messages,\n    isRunning,\n    AssistantMessageComponent,\n  }: {\n    message: AssistantMessage;\n    messages: Message[];\n    isRunning: boolean;\n    AssistantMessageComponent: typeof CopilotChatAssistantMessage;\n  }) {\n    return (\n      <AssistantMessageComponent\n        message={message}\n        messages={messages}\n        isRunning={isRunning}\n      />\n    );\n  },\n  (prevProps, nextProps) => {\n    // Only re-render if this specific message changed\n    if (prevProps.message.id !== nextProps.message.id) return false;\n    if (prevProps.message.content !== nextProps.message.content) return false;\n\n    // Compare tool calls if present\n    const prevToolCalls = prevProps.message.toolCalls;\n    const nextToolCalls = nextProps.message.toolCalls;\n    if (prevToolCalls?.length !== nextToolCalls?.length) return false;\n    if (prevToolCalls && nextToolCalls) {\n      for (let i = 0; i < prevToolCalls.length; i++) {\n        const prevTc = prevToolCalls[i];\n        const nextTc = nextToolCalls[i];\n        if (!prevTc || !nextTc) return false;\n        if (prevTc.id !== nextTc.id) return false;\n        if (prevTc.function.arguments !== nextTc.function.arguments) return false;\n      }\n    }\n\n    // Check if tool results changed for this message's tool calls\n    // Tool results are separate messages with role=\"tool\" that reference tool call IDs\n    if (prevToolCalls && prevToolCalls.length > 0) {\n      const toolCallIds = new Set(prevToolCalls.map(tc => tc.id));\n\n      const prevToolResults = prevProps.messages.filter(\n        m => m.role === \"tool\" && toolCallIds.has((m as any).toolCallId)\n      );\n      const nextToolResults = nextProps.messages.filter(\n        m => m.role === \"tool\" && toolCallIds.has((m as any).toolCallId)\n      );\n\n      // If number of tool results changed, re-render\n      if (prevToolResults.length !== nextToolResults.length) return false;\n\n      // If any tool result content changed, re-render\n      for (let i = 0; i < prevToolResults.length; i++) {\n        if ((prevToolResults[i] as any).content !== (nextToolResults[i] as any).content) return false;\n      }\n    }\n\n    // Only care about isRunning if this message is CURRENTLY the latest\n    // (we don't need to re-render just because a message stopped being the latest)\n    const nextIsLatest = nextProps.messages[nextProps.messages.length - 1]?.id === nextProps.message.id;\n    if (nextIsLatest && prevProps.isRunning !== nextProps.isRunning) return false;\n\n    // Check if component reference changed\n    if (prevProps.AssistantMessageComponent !== nextProps.AssistantMessageComponent) return false;\n\n    return true;\n  }\n);\n\n/**\n * Memoized wrapper for user messages to prevent re-renders when other messages change.\n */\nconst MemoizedUserMessage = React.memo(\n  function MemoizedUserMessage({\n    message,\n    UserMessageComponent,\n  }: {\n    message: UserMessage;\n    UserMessageComponent: typeof CopilotChatUserMessage;\n  }) {\n    return <UserMessageComponent message={message} />;\n  },\n  (prevProps, nextProps) => {\n    // Only re-render if this specific message changed\n    if (prevProps.message.id !== nextProps.message.id) return false;\n    if (prevProps.message.content !== nextProps.message.content) return false;\n    if (prevProps.UserMessageComponent !== nextProps.UserMessageComponent) return false;\n    return true;\n  }\n);\n\n/**\n * Memoized wrapper for activity messages to prevent re-renders when other messages change.\n */\nconst MemoizedActivityMessage = React.memo(\n  function MemoizedActivityMessage({\n    message,\n    renderActivityMessage,\n  }: {\n    message: ActivityMessage;\n    renderActivityMessage: (message: ActivityMessage) => React.ReactElement | null;\n  }) {\n    return renderActivityMessage(message);\n  },\n  (prevProps, nextProps) => {\n    // Message ID changed = different message, must re-render\n    if (prevProps.message.id !== nextProps.message.id) return false;\n\n    // Activity type changed = must re-render\n    if (prevProps.message.activityType !== nextProps.message.activityType) return false;\n\n    // Compare content using JSON.stringify (native code, handles deep comparison)\n    if (JSON.stringify(prevProps.message.content) !== JSON.stringify(nextProps.message.content)) return false;\n\n    return true;\n  }\n);\n\n/**\n * Memoized wrapper for custom messages to prevent re-renders when other messages change.\n */\nconst MemoizedCustomMessage = React.memo(\n  function MemoizedCustomMessage({\n    message,\n    position,\n    renderCustomMessage,\n  }: {\n    message: Message;\n    position: \"before\" | \"after\";\n    renderCustomMessage: (params: { message: Message; position: \"before\" | \"after\" }) => React.ReactElement | null;\n    stateSnapshot?: unknown;\n  }) {\n    return renderCustomMessage({ message, position });\n  },\n  (prevProps, nextProps) => {\n    // Only re-render if the message or position changed\n    if (prevProps.message.id !== nextProps.message.id) return false;\n    if (prevProps.position !== nextProps.position) return false;\n    // Compare message content - for assistant messages this is a string, for others may differ\n    if (prevProps.message.content !== nextProps.message.content) return false;\n    if (prevProps.message.role !== nextProps.message.role) return false;\n    // Compare state snapshot - custom renderers may depend on state\n    if (JSON.stringify(prevProps.stateSnapshot) !== JSON.stringify(nextProps.stateSnapshot)) return false;\n    // Note: We don't compare renderCustomMessage function reference because it changes\n    // frequently. The message and state comparison is sufficient to determine if a re-render is needed.\n    return true;\n  }\n);\n\nexport type CopilotChatMessageViewProps = Omit<\n  WithSlots<\n    {\n      assistantMessage: typeof CopilotChatAssistantMessage;\n      userMessage: typeof CopilotChatUserMessage;\n      cursor: typeof CopilotChatMessageView.Cursor;\n    },\n    {\n      isRunning?: boolean;\n      messages?: Message[];\n    } & React.HTMLAttributes<HTMLDivElement>\n  >,\n  \"children\"\n> & {\n  children?: (props: {\n    isRunning: boolean;\n    messages: Message[];\n    messageElements: React.ReactElement[];\n  }) => React.ReactElement;\n};\n\nexport function CopilotChatMessageView({\n  messages = [],\n  assistantMessage,\n  userMessage,\n  cursor,\n  isRunning = false,\n  children,\n  className,\n  ...props\n}: CopilotChatMessageViewProps) {\n  const renderCustomMessage = useRenderCustomMessages();\n  const { renderActivityMessage } = useRenderActivityMessage();\n  const { copilotkit } = useCopilotKit();\n  const config = useCopilotChatConfiguration();\n  const [, forceUpdate] = useReducer((x) => x + 1, 0);\n\n  // Subscribe to state changes so custom message renderers re-render when state updates.\n  useEffect(() => {\n    if (!config?.agentId) return;\n    const agent = copilotkit.getAgent(config.agentId);\n    if (!agent) return;\n\n    const subscription = agent.subscribe({\n      onStateChanged: forceUpdate,\n    });\n    return () => subscription.unsubscribe();\n  }, [config?.agentId, copilotkit, forceUpdate]);\n\n  // Helper to get state snapshot for a message (used for memoization)\n  const getStateSnapshotForMessage = (messageId: string): unknown => {\n    if (!config) return undefined;\n    const resolvedRunId =\n      copilotkit.getRunIdForMessage(config.agentId, config.threadId, messageId) ??\n      copilotkit.getRunIdsForThread(config.agentId, config.threadId).slice(-1)[0];\n    if (!resolvedRunId) return undefined;\n    return copilotkit.getStateByRun(config.agentId, config.threadId, resolvedRunId);\n  };\n\n  const messageElements: React.ReactElement[] = messages\n    .flatMap((message) => {\n      const elements: (React.ReactElement | null | undefined)[] = [];\n      const stateSnapshot = getStateSnapshotForMessage(message.id);\n\n      // Render custom message before (using memoized wrapper)\n      if (renderCustomMessage) {\n        elements.push(\n          <MemoizedCustomMessage\n            key={`${message.id}-custom-before`}\n            message={message}\n            position=\"before\"\n            renderCustomMessage={renderCustomMessage}\n            stateSnapshot={stateSnapshot}\n          />\n        );\n      }\n\n      // Render the main message using memoized wrappers to prevent unnecessary re-renders\n      if (message.role === \"assistant\") {\n        // Determine the component to use (custom slot or default)\n        const AssistantComponent = (\n          typeof assistantMessage === \"function\"\n            ? assistantMessage\n            : CopilotChatAssistantMessage\n        ) as typeof CopilotChatAssistantMessage;\n\n        elements.push(\n          <MemoizedAssistantMessage\n            key={message.id}\n            message={message as AssistantMessage}\n            messages={messages}\n            isRunning={isRunning}\n            AssistantMessageComponent={AssistantComponent}\n          />\n        );\n      } else if (message.role === \"user\") {\n        // Determine the component to use (custom slot or default)\n        const UserComponent = (\n          typeof userMessage === \"function\"\n            ? userMessage\n            : CopilotChatUserMessage\n        ) as typeof CopilotChatUserMessage;\n\n        elements.push(\n          <MemoizedUserMessage\n            key={message.id}\n            message={message as UserMessage}\n            UserMessageComponent={UserComponent}\n          />\n        );\n      } else if (message.role === \"activity\") {\n        // Use memoized wrapper to prevent re-renders when other messages change\n        const activityMsg = message as ActivityMessage;\n        elements.push(\n          <MemoizedActivityMessage\n            key={message.id}\n            message={activityMsg}\n            renderActivityMessage={renderActivityMessage}\n          />\n        );\n      }\n\n      // Render custom message after (using memoized wrapper)\n      if (renderCustomMessage) {\n        elements.push(\n          <MemoizedCustomMessage\n            key={`${message.id}-custom-after`}\n            message={message}\n            position=\"after\"\n            renderCustomMessage={renderCustomMessage}\n            stateSnapshot={stateSnapshot}\n          />\n        );\n      }\n\n      return elements;\n    })\n    .filter(Boolean) as React.ReactElement[];\n\n  if (children) {\n    return children({ messageElements, messages, isRunning });\n  }\n\n  return (\n    <div className={twMerge(\"flex flex-col\", className)} {...props}>\n      {messageElements}\n      {isRunning && renderSlot(cursor, CopilotChatMessageView.Cursor, {})}\n    </div>\n  );\n}\n\nCopilotChatMessageView.Cursor = function Cursor({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={twMerge(\"w-[11px] h-[11px] rounded-full bg-foreground animate-pulse-cursor ml-1\", className)}\n      {...props}\n    />\n  );\n};\n\nexport default CopilotChatMessageView;\n","import React, { useRef, useState, useEffect } from \"react\";\nimport { WithSlots, SlotValue, renderSlot } from \"@/lib/slots\";\nimport CopilotChatMessageView from \"./CopilotChatMessageView\";\nimport CopilotChatInput, { CopilotChatInputProps } from \"./CopilotChatInput\";\nimport CopilotChatSuggestionView, { CopilotChatSuggestionViewProps } from \"./CopilotChatSuggestionView\";\nimport { Suggestion } from \"@copilotkitnext/core\";\nimport { Message } from \"@ag-ui/core\";\nimport { twMerge } from \"tailwind-merge\";\nimport { StickToBottom, useStickToBottom, useStickToBottomContext } from \"use-stick-to-bottom\";\nimport { ChevronDown } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\nimport { useCopilotChatConfiguration, CopilotChatDefaultLabels } from \"@/providers/CopilotChatConfigurationProvider\";\nimport { useKeyboardHeight } from \"@/hooks/use-keyboard-height\";\n\n// Forward declaration for WelcomeScreen component type\nexport type WelcomeScreenProps = WithSlots<\n  {\n    welcomeMessage: React.FC<React.HTMLAttributes<HTMLDivElement>>;\n  },\n  {\n    input: React.ReactElement;\n    suggestionView: React.ReactElement;\n  } & React.HTMLAttributes<HTMLDivElement>\n>;\n\nexport type CopilotChatViewProps = WithSlots<\n  {\n    messageView: typeof CopilotChatMessageView;\n    scrollView: React.FC<React.HTMLAttributes<HTMLDivElement>>;\n    scrollToBottomButton: React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>>;\n    input: typeof CopilotChatInput;\n    inputContainer: React.FC<React.HTMLAttributes<HTMLDivElement> & { children: React.ReactNode }>;\n    feather: React.FC<React.HTMLAttributes<HTMLDivElement>>;\n    disclaimer: React.FC<React.HTMLAttributes<HTMLDivElement>>;\n    suggestionView: typeof CopilotChatSuggestionView;\n  },\n  {\n    messages?: Message[];\n    autoScroll?: boolean;\n    inputProps?: Partial<Omit<CopilotChatInputProps, \"children\">>;\n    isRunning?: boolean;\n    suggestions?: Suggestion[];\n    suggestionLoadingIndexes?: ReadonlyArray<number>;\n    onSelectSuggestion?: (suggestion: Suggestion, index: number) => void;\n    welcomeScreen?: SlotValue<React.FC<WelcomeScreenProps>> | boolean;\n  } & React.HTMLAttributes<HTMLDivElement>\n>;\n\nexport function CopilotChatView({\n  messageView,\n  input,\n  scrollView,\n  scrollToBottomButton,\n  feather,\n  inputContainer,\n  disclaimer,\n  suggestionView,\n  welcomeScreen,\n  messages = [],\n  autoScroll = true,\n  inputProps,\n  isRunning = false,\n  suggestions,\n  suggestionLoadingIndexes,\n  onSelectSuggestion,\n  children,\n  className,\n  ...props\n}: CopilotChatViewProps) {\n  const inputContainerRef = useRef<HTMLDivElement>(null);\n  const [inputContainerHeight, setInputContainerHeight] = useState(0);\n  const [isResizing, setIsResizing] = useState(false);\n  const resizeTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Track keyboard state for mobile\n  const { isKeyboardOpen, keyboardHeight, availableHeight } = useKeyboardHeight();\n\n  // Track input container height changes\n  useEffect(() => {\n    const element = inputContainerRef.current;\n    if (!element) return;\n\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const newHeight = entry.contentRect.height;\n\n        // Update height and set resizing state\n        setInputContainerHeight((prevHeight) => {\n          if (newHeight !== prevHeight) {\n            setIsResizing(true);\n\n            // Clear existing timeout\n            if (resizeTimeoutRef.current) {\n              clearTimeout(resizeTimeoutRef.current);\n            }\n\n            // Set isResizing to false after a short delay\n            resizeTimeoutRef.current = setTimeout(() => {\n              setIsResizing(false);\n            }, 250);\n\n            return newHeight;\n          }\n          return prevHeight;\n        });\n      }\n    });\n\n    resizeObserver.observe(element);\n\n    // Set initial height\n    setInputContainerHeight(element.offsetHeight);\n\n    return () => {\n      resizeObserver.disconnect();\n      if (resizeTimeoutRef.current) {\n        clearTimeout(resizeTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  const BoundMessageView = renderSlot(messageView, CopilotChatMessageView, {\n    messages,\n    isRunning,\n  });\n\n  const BoundInput = renderSlot(input, CopilotChatInput, (inputProps ?? {}) as CopilotChatInputProps);\n\n  const hasSuggestions = Array.isArray(suggestions) && suggestions.length > 0;\n  const BoundSuggestionView = hasSuggestions\n    ? renderSlot(suggestionView, CopilotChatSuggestionView, {\n        suggestions,\n        loadingIndexes: suggestionLoadingIndexes,\n        onSelectSuggestion,\n        className: \"mb-3 lg:ml-4 lg:mr-4 ml-0 mr-0\",\n      })\n    : null;\n\n  const BoundFeather = renderSlot(feather, CopilotChatView.Feather, {});\n\n  const BoundScrollView = renderSlot(scrollView, CopilotChatView.ScrollView, {\n    autoScroll,\n    scrollToBottomButton,\n    inputContainerHeight,\n    isResizing,\n    children: (\n      <div style={{ paddingBottom: `${inputContainerHeight + (hasSuggestions ? 4 : 32)}px` }}>\n        <div className=\"max-w-3xl mx-auto\">\n          {BoundMessageView}\n          {hasSuggestions ? <div className=\"pl-0 pr-4 sm:px-0 mt-4\">{BoundSuggestionView}</div> : null}\n        </div>\n      </div>\n    ),\n  });\n\n  const BoundScrollToBottomButton = renderSlot(scrollToBottomButton, CopilotChatView.ScrollToBottomButton, {});\n\n  const BoundDisclaimer = renderSlot(disclaimer, CopilotChatView.Disclaimer, {});\n\n  const BoundInputContainer = renderSlot(inputContainer, CopilotChatView.InputContainer, {\n    ref: inputContainerRef,\n    keyboardHeight: isKeyboardOpen ? keyboardHeight : 0,\n    children: (\n      <>\n        <div className=\"max-w-3xl mx-auto py-0 px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6 pointer-events-auto\">\n          {BoundInput}\n        </div>\n        {BoundDisclaimer}\n      </>\n    ),\n  });\n\n  // Welcome screen logic\n  const isEmpty = messages.length === 0;\n  // Type assertion needed because TypeScript doesn't fully propagate `| boolean` through WithSlots\n  const welcomeScreenDisabled = (welcomeScreen as unknown) === false;\n  const shouldShowWelcomeScreen = isEmpty && !welcomeScreenDisabled;\n\n  if (shouldShowWelcomeScreen) {\n    // Convert boolean `true` to undefined (use default), and exclude `false` since we've checked for it\n    const welcomeScreenSlot = (welcomeScreen === true ? undefined : welcomeScreen) as SlotValue<React.FC<WelcomeScreenProps>> | undefined;\n    const BoundWelcomeScreen = renderSlot(\n      welcomeScreenSlot,\n      CopilotChatView.WelcomeScreen,\n      {\n        input: BoundInput,\n        suggestionView: BoundSuggestionView ?? <></>,\n      }\n    );\n\n    return (\n      <div className={twMerge(\"relative h-full flex flex-col\", className)} {...props}>\n        {BoundWelcomeScreen}\n      </div>\n    );\n  }\n\n  if (children) {\n    return children({\n      messageView: BoundMessageView,\n      input: BoundInput,\n      scrollView: BoundScrollView,\n      scrollToBottomButton: BoundScrollToBottomButton,\n      feather: BoundFeather,\n      inputContainer: BoundInputContainer,\n      disclaimer: BoundDisclaimer,\n      suggestionView: BoundSuggestionView ?? <></>,\n    });\n  }\n\n  return (\n    <div className={twMerge(\"relative h-full\", className)} {...props}>\n      {BoundScrollView}\n\n      {BoundFeather}\n\n      {BoundInputContainer}\n    </div>\n  );\n}\n\nexport namespace CopilotChatView {\n  // Inner component that has access to StickToBottom context\n  const ScrollContent: React.FC<{\n    children: React.ReactNode;\n    scrollToBottomButton?: SlotValue<React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>>>;\n    inputContainerHeight: number;\n    isResizing: boolean;\n  }> = ({ children, scrollToBottomButton, inputContainerHeight, isResizing }) => {\n    const { isAtBottom, scrollToBottom } = useStickToBottomContext();\n\n    return (\n      <>\n        <StickToBottom.Content className=\"overflow-y-scroll overflow-x-hidden\">\n        <div className=\"px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6\">{children}</div>\n        </StickToBottom.Content>\n\n        {/* Scroll to bottom button - hidden during resize */}\n        {!isAtBottom && !isResizing && (\n          <div\n            className=\"absolute inset-x-0 flex justify-center z-10 pointer-events-none\"\n            style={{\n              bottom: `${inputContainerHeight + 16}px`,\n            }}\n          >\n            {renderSlot(scrollToBottomButton, CopilotChatView.ScrollToBottomButton, {\n              onClick: () => scrollToBottom(),\n            })}\n          </div>\n        )}\n      </>\n    );\n  };\n\n  export const ScrollView: React.FC<\n    React.HTMLAttributes<HTMLDivElement> & {\n      autoScroll?: boolean;\n      scrollToBottomButton?: SlotValue<React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>>>;\n      inputContainerHeight?: number;\n      isResizing?: boolean;\n    }\n  > = ({\n    children,\n    autoScroll = true,\n    scrollToBottomButton,\n    inputContainerHeight = 0,\n    isResizing = false,\n    className,\n    ...props\n  }) => {\n    const [hasMounted, setHasMounted] = useState(false);\n    const { scrollRef, contentRef, scrollToBottom } = useStickToBottom();\n    const [showScrollButton, setShowScrollButton] = useState(false);\n\n    useEffect(() => {\n      setHasMounted(true);\n    }, []);\n\n    // Monitor scroll position for non-autoscroll mode\n    useEffect(() => {\n      if (autoScroll) return; // Skip for autoscroll mode\n\n      const scrollElement = scrollRef.current;\n      if (!scrollElement) return;\n\n      const checkScroll = () => {\n        const atBottom = scrollElement.scrollHeight - scrollElement.scrollTop - scrollElement.clientHeight < 10;\n        setShowScrollButton(!atBottom);\n      };\n\n      checkScroll();\n      scrollElement.addEventListener(\"scroll\", checkScroll);\n\n      // Also check on resize\n      const resizeObserver = new ResizeObserver(checkScroll);\n      resizeObserver.observe(scrollElement);\n\n      return () => {\n        scrollElement.removeEventListener(\"scroll\", checkScroll);\n        resizeObserver.disconnect();\n      };\n    }, [scrollRef, autoScroll]);\n\n    if (!hasMounted) {\n      return (\n        <div className=\"h-full max-h-full flex flex-col min-h-0 overflow-y-scroll overflow-x-hidden\">\n          <div className=\"px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6\">{children}</div>\n        </div>\n      );\n    }\n\n    // When autoScroll is false, we don't use StickToBottom\n    if (!autoScroll) {\n      return (\n        <div\n          ref={scrollRef}\n          className={cn(\n            \"h-full max-h-full flex flex-col min-h-0 overflow-y-scroll overflow-x-hidden relative\",\n            className,\n          )}\n          {...props}\n        >\n          <div ref={contentRef} className=\"px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6\">\n            {children}\n          </div>\n\n          {/* Scroll to bottom button for manual mode */}\n          {showScrollButton && !isResizing && (\n            <div\n              className=\"absolute inset-x-0 flex justify-center z-10 pointer-events-none\"\n              style={{\n                bottom: `${inputContainerHeight + 16}px`,\n              }}\n            >\n              {renderSlot(scrollToBottomButton, CopilotChatView.ScrollToBottomButton, {\n                onClick: () => scrollToBottom(),\n              })}\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    return (\n      <StickToBottom\n        className={cn(\"h-full max-h-full flex flex-col min-h-0 relative\", className)}\n        resize=\"smooth\"\n        initial=\"smooth\"\n        {...props}\n      >\n        <ScrollContent\n          scrollToBottomButton={scrollToBottomButton}\n          inputContainerHeight={inputContainerHeight}\n          isResizing={isResizing}\n        >\n          {children}\n        </ScrollContent>\n      </StickToBottom>\n    );\n  };\n\n  export const ScrollToBottomButton: React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>> = ({\n    className,\n    ...props\n  }) => (\n    <Button\n      variant=\"outline\"\n      size=\"sm\"\n      className={twMerge(\n        \"rounded-full w-10 h-10 p-0 pointer-events-auto\",\n        \"bg-white dark:bg-gray-900\",\n        \"shadow-lg border border-gray-200 dark:border-gray-700\",\n        \"hover:bg-gray-50 dark:hover:bg-gray-800\",\n        \"flex items-center justify-center cursor-pointer\",\n        className,\n      )}\n      {...props}\n    >\n      <ChevronDown className=\"w-4 h-4 text-gray-600 dark:text-white\" />\n    </Button>\n  );\n\n  export const Feather: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({ className, style, ...props }) => (\n    <div\n      className={cn(\n        \"absolute bottom-0 left-0 right-4 h-24 pointer-events-none z-10 bg-gradient-to-t\",\n        \"from-white via-white to-transparent\",\n        \"dark:from-[rgb(33,33,33)] dark:via-[rgb(33,33,33)]\",\n        className,\n      )}\n      style={style}\n      {...props}\n    />\n  );\n\n  export const InputContainer = React.forwardRef<\n    HTMLDivElement,\n    React.HTMLAttributes<HTMLDivElement> & { children: React.ReactNode; keyboardHeight?: number }\n  >(({ children, className, keyboardHeight = 0, ...props }, ref) => (\n    <div\n      ref={ref}\n      className={cn(\"absolute bottom-0 left-0 right-0 z-20 pointer-events-none\", className)}\n      style={{\n        // Adjust position when keyboard is open to keep input visible\n        transform: keyboardHeight > 0 ? `translateY(-${keyboardHeight}px)` : undefined,\n        transition: \"transform 0.2s ease-out\",\n      }}\n      {...props}\n    >\n      {children}\n    </div>\n  ));\n\n  InputContainer.displayName = \"CopilotChatView.InputContainer\";\n\n  export const Disclaimer: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({ className, ...props }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n\n    return (\n      <div\n        className={cn(\"text-center text-xs text-muted-foreground py-3 px-4 max-w-3xl mx-auto\", className)}\n        {...props}\n      >\n        {labels.chatDisclaimerText}\n      </div>\n    );\n  };\n\n  export const WelcomeMessage: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({\n    className,\n    ...props\n  }) => {\n    const config = useCopilotChatConfiguration();\n    const labels = config?.labels ?? CopilotChatDefaultLabels;\n\n    return (\n      <h1\n        className={cn(\n          \"text-xl sm:text-2xl font-medium text-foreground text-center\",\n          className\n        )}\n        {...props}\n      >\n        {labels.welcomeMessageText}\n      </h1>\n    );\n  };\n\n  export const WelcomeScreen: React.FC<WelcomeScreenProps> = ({\n    welcomeMessage,\n    input,\n    suggestionView,\n    className,\n    children,\n    ...props\n  }) => {\n    // Render the welcomeMessage slot internally\n    const BoundWelcomeMessage = renderSlot(\n      welcomeMessage,\n      CopilotChatView.WelcomeMessage,\n      {}\n    );\n\n    if (children) {\n      return (\n        <>\n          {children({\n            welcomeMessage: BoundWelcomeMessage,\n            input,\n            suggestionView,\n            className,\n            ...props,\n          })}\n        </>\n      );\n    }\n\n    return (\n      <div\n        className={cn(\n          \"flex-1 flex flex-col items-center justify-center px-4\",\n          className\n        )}\n        {...props}\n      >\n        <div className=\"w-full max-w-3xl flex flex-col items-center\">\n          {/* Welcome message */}\n          <div className=\"mb-6\">\n            {BoundWelcomeMessage}\n          </div>\n\n          {/* Input */}\n          <div className=\"w-full\">\n            {input}\n          </div>\n\n          {/* Suggestions */}\n          <div className=\"mt-4 flex justify-center\">\n            {suggestionView}\n          </div>\n        </div>\n      </div>\n    );\n  };\n}\n\nexport default CopilotChatView;\n","import { useState, useEffect } from \"react\";\n\nexport interface KeyboardState {\n  isKeyboardOpen: boolean;\n  keyboardHeight: number;\n  availableHeight: number;\n  viewportHeight: number;\n}\n\n/**\n * Hook to detect mobile keyboard appearance and calculate available viewport height.\n * Uses the Visual Viewport API to track keyboard state on mobile devices.\n *\n * @returns KeyboardState object with keyboard information\n */\nexport function useKeyboardHeight(): KeyboardState {\n  const [keyboardState, setKeyboardState] = useState<KeyboardState>({\n    isKeyboardOpen: false,\n    keyboardHeight: 0,\n    availableHeight: typeof window !== \"undefined\" ? window.innerHeight : 0,\n    viewportHeight: typeof window !== \"undefined\" ? window.innerHeight : 0,\n  });\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    // Check if Visual Viewport API is available\n    const visualViewport = window.visualViewport;\n    if (!visualViewport) {\n      return;\n    }\n\n    const updateKeyboardState = () => {\n      const layoutHeight = window.innerHeight;\n      const visualHeight = visualViewport.height;\n\n      // Calculate keyboard height (difference between layout and visual viewport)\n      const keyboardHeight = Math.max(0, layoutHeight - visualHeight);\n\n      // Keyboard is considered open if the height difference is significant (> 150px)\n      const isKeyboardOpen = keyboardHeight > 150;\n\n      setKeyboardState({\n        isKeyboardOpen,\n        keyboardHeight,\n        availableHeight: visualHeight,\n        viewportHeight: layoutHeight,\n      });\n    };\n\n    // Initial state\n    updateKeyboardState();\n\n    // Listen for viewport changes\n    visualViewport.addEventListener(\"resize\", updateKeyboardState);\n    visualViewport.addEventListener(\"scroll\", updateKeyboardState);\n\n    return () => {\n      visualViewport.removeEventListener(\"resize\", updateKeyboardState);\n      visualViewport.removeEventListener(\"scroll\", updateKeyboardState);\n    };\n  }, []);\n\n  return keyboardState;\n}\n","import { useAgent } from \"@/hooks/use-agent\";\nimport { useSuggestions } from \"@/hooks/use-suggestions\";\nimport { CopilotChatView, CopilotChatViewProps } from \"./CopilotChatView\";\nimport CopilotChatInput, { CopilotChatInputProps, CopilotChatInputMode } from \"./CopilotChatInput\";\nimport {\n  CopilotChatConfigurationProvider,\n  CopilotChatLabels,\n  useCopilotChatConfiguration,\n} from \"@/providers/CopilotChatConfigurationProvider\";\nimport { DEFAULT_AGENT_ID, randomUUID, TranscriptionErrorCode } from \"@copilotkitnext/shared\";\nimport { Suggestion, CopilotKitCoreErrorCode } from \"@copilotkitnext/core\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { merge } from \"ts-deepmerge\";\nimport { useCopilotKit } from \"@/providers/CopilotKitProvider\";\nimport { AbstractAgent, AGUIConnectNotImplementedError } from \"@ag-ui/client\";\nimport { renderSlot, SlotValue } from \"@/lib/slots\";\nimport { transcribeAudio, TranscriptionError } from \"@/lib/transcription-client\";\n\nexport type CopilotChatProps = Omit<\n  CopilotChatViewProps,\n  \"messages\" | \"isRunning\" | \"suggestions\" | \"suggestionLoadingIndexes\" | \"onSelectSuggestion\"\n> & {\n  agentId?: string;\n  threadId?: string;\n  labels?: Partial<CopilotChatLabels>;\n  chatView?: SlotValue<typeof CopilotChatView>;\n  isModalDefaultOpen?: boolean;\n};\nexport function CopilotChat({ agentId, threadId, labels, chatView, isModalDefaultOpen, ...props }: CopilotChatProps) {\n  // Check for existing configuration provider\n  const existingConfig = useCopilotChatConfiguration();\n\n  // Apply priority: props > existing config > defaults\n  const resolvedAgentId = agentId ?? existingConfig?.agentId ?? DEFAULT_AGENT_ID;\n  const resolvedThreadId = useMemo(\n    () => threadId ?? existingConfig?.threadId ?? randomUUID(),\n    [threadId, existingConfig?.threadId],\n  );\n\n  const { agent } = useAgent({ agentId: resolvedAgentId });\n  const { copilotkit } = useCopilotKit();\n  const { suggestions: autoSuggestions } = useSuggestions({ agentId: resolvedAgentId });\n\n  // Transcription state\n  const [transcribeMode, setTranscribeMode] = useState<CopilotChatInputMode>(\"input\");\n  const [inputValue, setInputValue] = useState(\"\");\n  const [transcriptionError, setTranscriptionError] = useState<string | null>(null);\n  const [isTranscribing, setIsTranscribing] = useState(false);\n\n  // Check if transcription is enabled\n  const isTranscriptionEnabled = copilotkit.audioFileTranscriptionEnabled;\n\n  // Check if browser supports MediaRecorder\n  const isMediaRecorderSupported = typeof window !== \"undefined\" && typeof MediaRecorder !== \"undefined\";\n\n  const {\n    inputProps: providedInputProps,\n    messageView: providedMessageView,\n    suggestionView: providedSuggestionView,\n    ...restProps\n  } = props;\n\n  useEffect(() => {\n    const connect = async (agent: AbstractAgent) => {\n      try {\n        await copilotkit.connectAgent({ agent });\n      } catch (error) {\n        if (error instanceof AGUIConnectNotImplementedError) {\n          // connect not implemented, ignore\n        } else {\n          throw error;\n        }\n      }\n    };\n    agent.threadId = resolvedThreadId;\n    connect(agent);\n    return () => {};\n  }, [resolvedThreadId, agent, copilotkit, resolvedAgentId]);\n\n  const onSubmitInput = useCallback(\n    async (value: string) => {\n      agent.addMessage({\n        id: randomUUID(),\n        role: \"user\",\n        content: value,\n      });\n      // Clear input after submitting\n      setInputValue(\"\");\n      try {\n        await copilotkit.runAgent({ agent });\n      } catch (error) {\n        console.error(\"CopilotChat: runAgent failed\", error);\n      }\n    },\n    [agent, copilotkit],\n  );\n\n  const handleSelectSuggestion = useCallback(\n    async (suggestion: Suggestion) => {\n      agent.addMessage({\n        id: randomUUID(),\n        role: \"user\",\n        content: suggestion.message,\n      });\n\n      try {\n        await copilotkit.runAgent({ agent });\n      } catch (error) {\n        console.error(\"CopilotChat: runAgent failed after selecting suggestion\", error);\n      }\n    },\n    [agent, copilotkit],\n  );\n\n  const stopCurrentRun = useCallback(() => {\n    try {\n      copilotkit.stopAgent({ agent });\n    } catch (error) {\n      console.error(\"CopilotChat: stopAgent failed\", error);\n      try {\n        agent.abortRun();\n      } catch (abortError) {\n        console.error(\"CopilotChat: abortRun fallback failed\", abortError);\n      }\n    }\n  }, [agent, copilotkit]);\n\n  // Transcription handlers\n  const handleStartTranscribe = useCallback(() => {\n    setTranscriptionError(null);\n    setTranscribeMode(\"transcribe\");\n  }, []);\n\n  const handleCancelTranscribe = useCallback(() => {\n    setTranscriptionError(null);\n    setTranscribeMode(\"input\");\n  }, []);\n\n  const handleFinishTranscribe = useCallback(() => {\n    setTranscribeMode(\"input\");\n  }, []);\n\n  // Handle audio blob from CopilotChatInput and transcribe it\n  const handleFinishTranscribeWithAudio = useCallback(async (audioBlob: Blob) => {\n    setIsTranscribing(true);\n    try {\n      setTranscriptionError(null);\n\n      // Send to transcription endpoint\n      const result = await transcribeAudio(copilotkit, audioBlob);\n\n      // Insert transcribed text into input\n      setInputValue((prev) => {\n        const trimmedPrev = prev.trim();\n        if (trimmedPrev) {\n          return `${trimmedPrev} ${result.text}`;\n        }\n        return result.text;\n      });\n    } catch (error) {\n      console.error(\"CopilotChat: Transcription failed\", error);\n\n      // Show contextual error message based on error type\n      if (error instanceof TranscriptionError) {\n        const { code, retryable, message } = error.info;\n        switch (code) {\n          case TranscriptionErrorCode.RATE_LIMITED:\n            setTranscriptionError(\"Too many requests. Please wait a moment.\");\n            break;\n          case TranscriptionErrorCode.AUTH_FAILED:\n            setTranscriptionError(\"Authentication error. Please check your configuration.\");\n            break;\n          case TranscriptionErrorCode.AUDIO_TOO_LONG:\n            setTranscriptionError(\"Recording is too long. Please try a shorter recording.\");\n            break;\n          case TranscriptionErrorCode.AUDIO_TOO_SHORT:\n            setTranscriptionError(\"Recording is too short. Please try again.\");\n            break;\n          case TranscriptionErrorCode.INVALID_AUDIO_FORMAT:\n            setTranscriptionError(\"Audio format not supported.\");\n            break;\n          case TranscriptionErrorCode.SERVICE_NOT_CONFIGURED:\n            setTranscriptionError(\"Transcription service is not available.\");\n            break;\n          case TranscriptionErrorCode.NETWORK_ERROR:\n            setTranscriptionError(\"Network error. Please check your connection.\");\n            break;\n          default:\n            // For retryable errors, show more helpful message\n            setTranscriptionError(\n              retryable\n                ? \"Transcription failed. Please try again.\"\n                : message\n            );\n        }\n      } else {\n        // Fallback for unexpected errors\n        setTranscriptionError(\"Transcription failed. Please try again.\");\n      }\n    } finally {\n      setIsTranscribing(false);\n    }\n  }, [copilotkit]);\n\n  // Clear transcription error after a delay\n  useEffect(() => {\n    if (transcriptionError) {\n      const timer = setTimeout(() => {\n        setTranscriptionError(null);\n      }, 5000);\n      return () => clearTimeout(timer);\n    }\n  }, [transcriptionError]);\n\n  const mergedProps = merge(\n    {\n      isRunning: agent.isRunning,\n      suggestions: autoSuggestions,\n      onSelectSuggestion: handleSelectSuggestion,\n      suggestionView: providedSuggestionView,\n    },\n    {\n      ...restProps,\n      ...(typeof providedMessageView === \"string\"\n        ? { messageView: { className: providedMessageView } }\n        : providedMessageView !== undefined\n          ? { messageView: providedMessageView }\n          : {}),\n    },\n  );\n\n  const providedStopHandler = providedInputProps?.onStop;\n  const hasMessages = agent.messages.length > 0;\n  const shouldAllowStop = agent.isRunning && hasMessages;\n  const effectiveStopHandler = shouldAllowStop ? (providedStopHandler ?? stopCurrentRun) : providedStopHandler;\n\n  // Determine if transcription feature should be available\n  const showTranscription = isTranscriptionEnabled && isMediaRecorderSupported;\n\n  // Determine mode: transcribing takes priority, then transcribe mode, then default to input\n  const effectiveMode: CopilotChatInputMode = isTranscribing\n    ? \"processing\"\n    : transcribeMode;\n\n  const finalInputProps = {\n    ...providedInputProps,\n    onSubmitMessage: onSubmitInput,\n    onStop: effectiveStopHandler,\n    isRunning: agent.isRunning,\n    mode: effectiveMode,\n    value: inputValue,\n    onChange: setInputValue,\n    // Only provide transcription handlers if feature is available\n    onStartTranscribe: showTranscription ? handleStartTranscribe : undefined,\n    onCancelTranscribe: showTranscription ? handleCancelTranscribe : undefined,\n    onFinishTranscribe: showTranscription ? handleFinishTranscribe : undefined,\n    onFinishTranscribeWithAudio: showTranscription ? handleFinishTranscribeWithAudio : undefined,\n  } as Partial<CopilotChatInputProps> & { onSubmitMessage: (value: string) => void };\n\n  // Memoize messages array - only create new reference when content actually changes\n  // (agent.messages is mutated in place, so we need a new reference for React to detect changes)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const messages = useMemo(() => [...agent.messages], [JSON.stringify(agent.messages)]);\n\n  const finalProps = merge(mergedProps, {\n    messages,\n    inputProps: finalInputProps,\n  }) as CopilotChatViewProps;\n\n  // Always create a provider with merged values\n  // This ensures priority: props > existing config > defaults\n  const RenderedChatView = renderSlot(chatView, CopilotChatView, finalProps);\n\n  return (\n    <CopilotChatConfigurationProvider\n      agentId={resolvedAgentId}\n      threadId={resolvedThreadId}\n      labels={labels}\n      isModalDefaultOpen={isModalDefaultOpen}\n    >\n      {transcriptionError && (\n        <div\n          style={{\n            position: \"absolute\",\n            bottom: \"100px\",\n            left: \"50%\",\n            transform: \"translateX(-50%)\",\n            backgroundColor: \"#ef4444\",\n            color: \"white\",\n            padding: \"8px 16px\",\n            borderRadius: \"8px\",\n            fontSize: \"14px\",\n            zIndex: 50,\n          }}\n        >\n          {transcriptionError}\n        </div>\n      )}\n      {RenderedChatView}\n    </CopilotChatConfigurationProvider>\n  );\n}\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace CopilotChat {\n  export const View = CopilotChatView;\n}\n","import type { CopilotKitCoreReact } from \"./react-core\";\nimport {\n  TranscriptionErrorCode,\n  type TranscriptionErrorResponse,\n} from \"@copilotkitnext/shared\";\n\nexport interface TranscriptionResult {\n  text: string;\n  size: number;\n  type: string;\n}\n\n/**\n * Error info parsed from transcription endpoint error responses.\n */\nexport interface TranscriptionErrorInfo {\n  code: TranscriptionErrorCode;\n  message: string;\n  retryable: boolean;\n}\n\n// Re-export error code enum for convenience\nexport { TranscriptionErrorCode };\n\n/**\n * Convert a Blob to a base64 string\n */\nasync function blobToBase64(blob: Blob): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      const result = reader.result as string;\n      // Remove the data URL prefix to get pure base64\n      const base64 = result.split(\",\")[1];\n      resolve(base64 ?? \"\");\n    };\n    reader.onerror = () => reject(new Error(\"Failed to read audio data\"));\n    reader.readAsDataURL(blob);\n  });\n}\n\n/**\n * Check if an error response matches our expected format\n */\nfunction isTranscriptionErrorResponse(data: unknown): data is TranscriptionErrorResponse {\n  return (\n    typeof data === \"object\" &&\n    data !== null &&\n    \"error\" in data &&\n    \"message\" in data &&\n    typeof (data as TranscriptionErrorResponse).error === \"string\" &&\n    typeof (data as TranscriptionErrorResponse).message === \"string\"\n  );\n}\n\n/**\n * Parse error info from a transcription error response\n */\nfunction parseTranscriptionError(response: TranscriptionErrorResponse): TranscriptionErrorInfo {\n  return {\n    code: response.error,\n    message: response.message,\n    retryable: response.retryable ?? false,\n  };\n}\n\n/**\n * Custom error type for transcription failures.\n * Extends Error with transcription-specific info for contextual error handling.\n */\nexport class TranscriptionError extends Error {\n  public readonly info: TranscriptionErrorInfo;\n\n  constructor(info: TranscriptionErrorInfo) {\n    super(info.message);\n    this.name = \"TranscriptionError\";\n    this.info = info;\n  }\n}\n\n/**\n * Transcribe an audio blob using the CopilotKit runtime\n *\n * Supports both REST mode (multipart/form-data) and single-endpoint mode (base64 JSON)\n *\n * @throws {TranscriptionError} When transcription fails with typed error information\n */\nexport async function transcribeAudio(\n  core: CopilotKitCoreReact,\n  audioBlob: Blob,\n  filename: string = \"recording.webm\"\n): Promise<TranscriptionResult> {\n  const runtimeUrl = core.runtimeUrl;\n  if (!runtimeUrl) {\n    throw new TranscriptionError({\n      code: TranscriptionErrorCode.INVALID_REQUEST,\n      message: \"Runtime URL is not configured\",\n      retryable: false,\n    });\n  }\n\n  const headers: Record<string, string> = { ...core.headers };\n  let response: Response;\n\n  try {\n    if (core.runtimeTransport === \"single\") {\n      // Single-endpoint mode: POST JSON with base64 audio\n      const base64Audio = await blobToBase64(audioBlob);\n\n      headers[\"Content-Type\"] = \"application/json\";\n\n      response = await fetch(runtimeUrl, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify({\n          method: \"transcribe\",\n          body: {\n            audio: base64Audio,\n            mimeType: audioBlob.type || \"audio/webm\",\n            filename,\n          },\n        }),\n      });\n    } else {\n      // REST mode: POST multipart/form-data to /transcribe\n      // Don't set Content-Type - browser will set it with boundary for FormData\n      delete headers[\"Content-Type\"];\n\n      const formData = new FormData();\n      formData.append(\"audio\", audioBlob, filename);\n\n      response = await fetch(`${runtimeUrl}/transcribe`, {\n        method: \"POST\",\n        headers,\n        body: formData,\n      });\n    }\n  } catch (error) {\n    // Network error - fetch failed\n    throw new TranscriptionError({\n      code: TranscriptionErrorCode.NETWORK_ERROR,\n      message: error instanceof Error ? error.message : \"Network request failed\",\n      retryable: true,\n    });\n  }\n\n  if (!response.ok) {\n    let errorData: unknown;\n    try {\n      errorData = await response.json();\n    } catch {\n      // Could not parse error response\n      throw new TranscriptionError({\n        code: TranscriptionErrorCode.PROVIDER_ERROR,\n        message: `HTTP ${response.status}: ${response.statusText}`,\n        retryable: response.status >= 500,\n      });\n    }\n\n    // If we got a typed error response, use it\n    if (isTranscriptionErrorResponse(errorData)) {\n      throw new TranscriptionError(parseTranscriptionError(errorData));\n    }\n\n    // Unknown error format\n    throw new TranscriptionError({\n      code: TranscriptionErrorCode.PROVIDER_ERROR,\n      message: typeof errorData === \"object\" && errorData !== null && \"message\" in errorData\n        ? String((errorData as { message: unknown }).message)\n        : \"Transcription failed\",\n      retryable: response.status >= 500,\n    });\n  }\n\n  return (await response.json()) as TranscriptionResult;\n}\n","import React, { useState, MouseEvent } from \"react\";\nimport { MessageCircle, X } from \"lucide-react\";\n\nimport { renderSlot, SlotValue } from \"@/lib/slots\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  CopilotChatDefaultLabels,\n  useCopilotChatConfiguration,\n} from \"@/providers/CopilotChatConfigurationProvider\";\n\nconst DefaultOpenIcon: React.FC<React.SVGProps<SVGSVGElement>> = ({\n  className,\n  ...props\n}) => (\n  <MessageCircle className={cn(\"h-6 w-6\", className)} strokeWidth={1.75} fill=\"currentColor\" {...props} />\n);\n\nconst DefaultCloseIcon: React.FC<React.SVGProps<SVGSVGElement>> = ({\n  className,\n  ...props\n}) => <X className={cn(\"h-6 w-6\", className)} strokeWidth={1.75} {...props} />;\n\nDefaultOpenIcon.displayName = \"CopilotChatToggleButton.OpenIcon\";\nDefaultCloseIcon.displayName = \"CopilotChatToggleButton.CloseIcon\";\n\nexport interface CopilotChatToggleButtonProps\n  extends Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, \"children\"> {\n  /** Optional slot override for the chat (closed) icon. */\n  openIcon?: SlotValue<typeof DefaultOpenIcon>;\n  /** Optional slot override for the close icon. */\n  closeIcon?: SlotValue<typeof DefaultCloseIcon>;\n}\n\nconst ICON_TRANSITION_STYLE: React.CSSProperties = Object.freeze({\n  transition: \"opacity 120ms ease-out, transform 260ms cubic-bezier(0.22, 1, 0.36, 1)\",\n});\n\nconst ICON_WRAPPER_BASE =\n  \"pointer-events-none absolute inset-0 flex items-center justify-center will-change-transform\";\n\nconst BUTTON_BASE_CLASSES = cn(\n  \"fixed bottom-6 right-6 z-[1100] flex h-14 w-14 items-center justify-center\",\n  \"rounded-full border border-primary bg-primary text-primary-foreground\",\n  \"shadow-sm transition-all duration-200 ease-out\",\n  \"hover:scale-[1.04] hover:shadow-md\",\n  \"cursor-pointer\",\n  \"active:scale-[0.96]\",\n  \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 focus-visible:ring-offset-2 focus-visible:ring-offset-background\",\n  \"disabled:pointer-events-none disabled:opacity-60\"\n);\n\nexport const CopilotChatToggleButton = React.forwardRef<\n  HTMLButtonElement,\n  CopilotChatToggleButtonProps\n>(function CopilotChatToggleButton({ openIcon, closeIcon, className, ...buttonProps }, ref) {\n  const { onClick, type, disabled, ...restProps } = buttonProps;\n\n  const configuration = useCopilotChatConfiguration();\n  const labels = configuration?.labels ?? CopilotChatDefaultLabels;\n\n  const [fallbackOpen, setFallbackOpen] = useState(false);\n\n  const isOpen = configuration?.isModalOpen ?? fallbackOpen;\n  const setModalOpen = configuration?.setModalOpen ?? setFallbackOpen;\n\n  const handleClick = (event: MouseEvent<HTMLButtonElement>) => {\n    if (disabled) {\n      return;\n    }\n\n    if (onClick) {\n      onClick(event);\n    }\n\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    const nextOpen = !isOpen;\n    setModalOpen(nextOpen);\n  };\n\n  const renderedOpenIcon = renderSlot(\n    openIcon,\n    DefaultOpenIcon,\n    {\n      className: \"h-6 w-6\",\n      \"aria-hidden\": true,\n      focusable: false,\n    }\n  );\n\n  const renderedCloseIcon = renderSlot(\n    closeIcon,\n    DefaultCloseIcon,\n    {\n      className: \"h-6 w-6\",\n      \"aria-hidden\": true,\n      focusable: false,\n    }\n  );\n\n  const openIconElement = (\n    <span\n      aria-hidden=\"true\"\n      data-slot=\"chat-toggle-button-open-icon\"\n      className={ICON_WRAPPER_BASE}\n      style={{\n        ...ICON_TRANSITION_STYLE,\n        opacity: isOpen ? 0 : 1,\n        transform: `scale(${isOpen ? 0.75 : 1}) rotate(${isOpen ? 90 : 0}deg)`,\n      }}\n    >\n      {renderedOpenIcon}\n    </span>\n  );\n\n  const closeIconElement = (\n    <span\n      aria-hidden=\"true\"\n      data-slot=\"chat-toggle-button-close-icon\"\n      className={ICON_WRAPPER_BASE}\n      style={{\n        ...ICON_TRANSITION_STYLE,\n        opacity: isOpen ? 1 : 0,\n        transform: `scale(${isOpen ? 1 : 0.75}) rotate(${isOpen ? 0 : -90}deg)`,\n      }}\n    >\n      {renderedCloseIcon}\n    </span>\n  );\n\n  return (\n    <button\n      ref={ref}\n      type={type ?? \"button\"}\n      data-slot=\"chat-toggle-button\"\n      data-state={isOpen ? \"open\" : \"closed\"}\n      className={cn(BUTTON_BASE_CLASSES, className)}\n      aria-label={isOpen ? labels.chatToggleCloseLabel : labels.chatToggleOpenLabel}\n      aria-pressed={isOpen}\n      disabled={disabled}\n      onClick={handleClick}\n      {...restProps}\n    >\n      {openIconElement}\n      {closeIconElement}\n    </button>\n  );\n});\nCopilotChatToggleButton.displayName = \"CopilotChatToggleButton\";\nexport default CopilotChatToggleButton;\n\nexport {\n  DefaultOpenIcon as CopilotChatToggleButtonOpenIcon,\n  DefaultCloseIcon as CopilotChatToggleButtonCloseIcon,\n};\n","import React, { useEffect, useRef, useState } from \"react\";\n\nimport CopilotChatView, { CopilotChatViewProps, WelcomeScreenProps } from \"./CopilotChatView\";\nimport { useCopilotChatConfiguration } from \"@/providers/CopilotChatConfigurationProvider\";\nimport CopilotChatToggleButton from \"./CopilotChatToggleButton\";\nimport { cn } from \"@/lib/utils\";\nimport { CopilotModalHeader } from \"./CopilotModalHeader\";\nimport { renderSlot, SlotValue } from \"@/lib/slots\";\n\nconst DEFAULT_SIDEBAR_WIDTH = 480;\nconst SIDEBAR_TRANSITION_MS = 260;\n\nexport type CopilotSidebarViewProps = CopilotChatViewProps & {\n  header?: SlotValue<typeof CopilotModalHeader>;\n  width?: number | string;\n};\n\nexport function CopilotSidebarView({ header, width, ...props }: CopilotSidebarViewProps) {\n  const configuration = useCopilotChatConfiguration();\n\n  const isSidebarOpen = configuration?.isModalOpen ?? false;\n\n  const sidebarRef = useRef<HTMLDivElement | null>(null);\n  const [sidebarWidth, setSidebarWidth] = useState<number | string>(width ?? DEFAULT_SIDEBAR_WIDTH);\n\n  // Helper to convert width to CSS value\n  const widthToCss = (w: number | string): string => {\n    return typeof w === \"number\" ? `${w}px` : w;\n  };\n\n  // Helper to extract numeric value for body margin (only works with px values)\n  const widthToMargin = (w: number | string): string => {\n    if (typeof w === \"number\") {\n      return `${w}px`;\n    }\n    // For string values, use as-is (assumes valid CSS unit)\n    return w;\n  };\n\n  useEffect(() => {\n    // If width is explicitly provided, don't measure\n    if (width !== undefined) {\n      return;\n    }\n\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    const element = sidebarRef.current;\n    if (!element) {\n      return;\n    }\n\n    const updateWidth = () => {\n      const rect = element.getBoundingClientRect();\n      if (rect.width > 0) {\n        setSidebarWidth(rect.width);\n      }\n    };\n\n    updateWidth();\n\n    if (typeof ResizeObserver !== \"undefined\") {\n      const observer = new ResizeObserver(() => updateWidth());\n      observer.observe(element);\n      return () => observer.disconnect();\n    }\n\n    window.addEventListener(\"resize\", updateWidth);\n    return () => window.removeEventListener(\"resize\", updateWidth);\n  }, [width]);\n\n  const headerElement = renderSlot(header, CopilotModalHeader, {});\n\n  return (\n    <>\n      {isSidebarOpen && (\n        <style\n          dangerouslySetInnerHTML={{\n            __html: `\n            @media (min-width: 768px) {\n              body {\n                margin-inline-end: ${widthToMargin(sidebarWidth)};\n                transition: margin-inline-end ${SIDEBAR_TRANSITION_MS}ms ease;\n              }\n            }`,\n          }}\n        />\n      )}\n      <CopilotChatToggleButton />\n      <aside\n        ref={sidebarRef}\n        data-copilot-sidebar\n        className={cn(\n          \"fixed right-0 top-0 z-[1200] flex\",\n          // Height with dvh fallback and safe area support\n          \"h-[100vh] h-[100dvh] max-h-screen\",\n          // Responsive width: full on mobile, custom on desktop\n          \"w-full\",\n          \"border-l border-border bg-background text-foreground shadow-xl\",\n          \"transition-transform duration-300 ease-out\",\n          isSidebarOpen ? \"translate-x-0\" : \"translate-x-full pointer-events-none\",\n        )}\n        style={{\n          // Use CSS custom property for responsive width\n          [\"--sidebar-width\" as string]: widthToCss(sidebarWidth),\n          // Safe area insets for iOS\n          paddingTop: \"env(safe-area-inset-top)\",\n          paddingBottom: \"env(safe-area-inset-bottom)\",\n        } as React.CSSProperties}\n        aria-hidden={!isSidebarOpen}\n        aria-label=\"Copilot chat sidebar\"\n        role=\"complementary\"\n      >\n        <div className=\"flex h-full w-full flex-col overflow-hidden\">\n          {headerElement}\n          <div className=\"flex-1 overflow-hidden\" data-sidebar-chat>\n            <CopilotChatView {...props} />\n          </div>\n        </div>\n      </aside>\n    </>\n  );\n}\n\nCopilotSidebarView.displayName = \"CopilotSidebarView\";\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace CopilotSidebarView {\n  /**\n   * Sidebar-specific welcome screen layout:\n   * - Suggestions at the top\n   * - Welcome message in the middle\n   * - Input fixed at the bottom (like normal chat)\n   */\n  export const WelcomeScreen: React.FC<WelcomeScreenProps> = ({\n    welcomeMessage,\n    input,\n    suggestionView,\n    className,\n    children,\n    ...props\n  }) => {\n    // Render the welcomeMessage slot internally\n    const BoundWelcomeMessage = renderSlot(\n      welcomeMessage,\n      CopilotChatView.WelcomeMessage,\n      {}\n    );\n\n    if (children) {\n      return (\n        <>\n          {children({\n            welcomeMessage: BoundWelcomeMessage,\n            input,\n            suggestionView,\n            className,\n            ...props,\n          })}\n        </>\n      );\n    }\n\n    return (\n      <div\n        className={cn(\"h-full flex flex-col\", className)}\n        {...props}\n      >\n        {/* Welcome message - centered vertically */}\n        <div className=\"flex-1 flex flex-col items-center justify-center px-4\">\n          {BoundWelcomeMessage}\n        </div>\n\n        {/* Suggestions and input at bottom */}\n        <div className=\"px-8 pb-4\">\n          <div className=\"max-w-3xl mx-auto\">\n            {/* Suggestions above input */}\n            <div className=\"mb-4 flex justify-center\">\n              {suggestionView}\n            </div>\n            {input}\n          </div>\n        </div>\n      </div>\n    );\n  };\n}\n\nexport default CopilotSidebarView;\n","import React, { useCallback } from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { useCopilotChatConfiguration, CopilotChatDefaultLabels } from \"@/providers/CopilotChatConfigurationProvider\";\nimport { renderSlot, WithSlots } from \"@/lib/slots\";\nimport { X } from \"lucide-react\";\n\ntype HeaderSlots = {\n  titleContent: typeof CopilotModalHeader.Title;\n  closeButton: typeof CopilotModalHeader.CloseButton;\n};\n\ntype HeaderRestProps = {\n  title?: string;\n} & Omit<React.HTMLAttributes<HTMLDivElement>, \"children\">;\n\nexport type CopilotModalHeaderProps = WithSlots<HeaderSlots, HeaderRestProps>;\n\nexport function CopilotModalHeader({\n  title,\n  titleContent,\n  closeButton,\n  children,\n  className,\n  ...rest\n}: CopilotModalHeaderProps) {\n  const configuration = useCopilotChatConfiguration();\n\n  const fallbackTitle = configuration?.labels.modalHeaderTitle ?? CopilotChatDefaultLabels.modalHeaderTitle;\n  const resolvedTitle = title ?? fallbackTitle;\n\n  const handleClose = useCallback(() => {\n    configuration?.setModalOpen(false);\n  }, [configuration]);\n\n  const BoundTitle = renderSlot(titleContent, CopilotModalHeader.Title, {\n    children: resolvedTitle,\n  });\n\n  const BoundCloseButton = renderSlot(closeButton, CopilotModalHeader.CloseButton, {\n    onClick: handleClose,\n  });\n\n  if (children) {\n    return children({\n      titleContent: BoundTitle,\n      closeButton: BoundCloseButton,\n      title: resolvedTitle,\n      ...rest,\n    });\n  }\n\n  return (\n    <header\n      data-slot=\"copilot-modal-header\"\n      className={cn(\n        \"flex items-center justify-between border-b border-border px-4 py-4\",\n        \"bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/80\",\n        className,\n      )}\n      {...rest}\n    >\n      <div className=\"flex w-full items-center gap-2\">\n        <div className=\"flex-1\" aria-hidden=\"true\" />\n        <div className=\"flex flex-1 justify-center text-center\">{BoundTitle}</div>\n        <div className=\"flex flex-1 justify-end\">{BoundCloseButton}</div>\n      </div>\n    </header>\n  );\n}\n\nCopilotModalHeader.displayName = \"CopilotModalHeader\";\n\nexport namespace CopilotModalHeader {\n  export const Title: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({ children, className, ...props }) => (\n    <div\n      className={cn(\n        \"w-full text-base font-medium leading-none tracking-tight text-foreground\",\n        className,\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n\n  export const CloseButton: React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>> = ({\n    className,\n    ...props\n  }) => (\n    <button\n      type=\"button\"\n      className={cn(\n        \"inline-flex size-8 items-center justify-center rounded-full text-muted-foreground transition cursor-pointer\",\n        \"hover:bg-muted hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\",\n        className,\n      )}\n      aria-label=\"Close\"\n      {...props}\n    >\n      <X className=\"h-4 w-4\" aria-hidden=\"true\" />\n    </button>\n  );\n}\n\nCopilotModalHeader.Title.displayName = \"CopilotModalHeader.Title\";\nCopilotModalHeader.CloseButton.displayName = \"CopilotModalHeader.CloseButton\";\n\nexport default CopilotModalHeader;\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport CopilotChatView, { CopilotChatViewProps, WelcomeScreenProps } from \"./CopilotChatView\";\nimport CopilotChatToggleButton from \"./CopilotChatToggleButton\";\nimport { CopilotModalHeader } from \"./CopilotModalHeader\";\nimport { cn } from \"@/lib/utils\";\nimport { renderSlot, SlotValue } from \"@/lib/slots\";\nimport {\n  CopilotChatDefaultLabels,\n  useCopilotChatConfiguration,\n} from \"@/providers/CopilotChatConfigurationProvider\";\n\nconst DEFAULT_POPUP_WIDTH = 420;\nconst DEFAULT_POPUP_HEIGHT = 560;\n\nexport type CopilotPopupViewProps = CopilotChatViewProps & {\n  header?: SlotValue<typeof CopilotModalHeader>;\n  width?: number | string;\n  height?: number | string;\n  clickOutsideToClose?: boolean;\n};\n\nconst dimensionToCss = (value: number | string | undefined, fallback: number): string => {\n  if (typeof value === \"number\" && Number.isFinite(value)) {\n    return `${value}px`;\n  }\n\n  if (typeof value === \"string\" && value.trim().length > 0) {\n    return value;\n  }\n\n  return `${fallback}px`;\n};\n\nexport function CopilotPopupView({\n  header,\n  width,\n  height,\n  clickOutsideToClose,\n  className,\n  ...restProps\n}: CopilotPopupViewProps) {\n  const configuration = useCopilotChatConfiguration();\n  const isPopupOpen = configuration?.isModalOpen ?? false;\n  const setModalOpen = configuration?.setModalOpen;\n  const labels = configuration?.labels ?? CopilotChatDefaultLabels;\n\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [isRendered, setIsRendered] = useState(isPopupOpen);\n  const [isAnimatingOut, setIsAnimatingOut] = useState(false);\n\n  useEffect(() => {\n    if (isPopupOpen) {\n      setIsRendered(true);\n      setIsAnimatingOut(false);\n      return;\n    }\n\n    if (!isRendered) {\n      return;\n    }\n\n    setIsAnimatingOut(true);\n    const timeout = setTimeout(() => {\n      setIsRendered(false);\n      setIsAnimatingOut(false);\n    }, 200);\n\n    return () => clearTimeout(timeout);\n  }, [isPopupOpen, isRendered]);\n\n  useEffect(() => {\n    if (!isPopupOpen) {\n      return;\n    }\n\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        event.preventDefault();\n        setModalOpen?.(false);\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [isPopupOpen, setModalOpen]);\n\n  useEffect(() => {\n    if (!isPopupOpen) {\n      return;\n    }\n\n    const focusTimer = setTimeout(() => {\n      containerRef.current?.focus({ preventScroll: true });\n    }, 200);\n\n    return () => clearTimeout(focusTimer);\n  }, [isPopupOpen]);\n\n  useEffect(() => {\n    if (!isPopupOpen || !clickOutsideToClose) {\n      return;\n    }\n\n    if (typeof document === \"undefined\") {\n      return;\n    }\n\n    const handlePointerDown = (event: PointerEvent) => {\n      const target = event.target as Node | null;\n      if (!target) {\n        return;\n      }\n\n      const container = containerRef.current;\n      if (container?.contains(target)) {\n        return;\n      }\n\n      const toggleButton = document.querySelector(\"[data-slot='chat-toggle-button']\");\n      if (toggleButton && toggleButton.contains(target)) {\n        return;\n      }\n\n      setModalOpen?.(false);\n    };\n\n    document.addEventListener(\"pointerdown\", handlePointerDown);\n    return () => document.removeEventListener(\"pointerdown\", handlePointerDown);\n  }, [isPopupOpen, clickOutsideToClose, setModalOpen]);\n\n  const headerElement = useMemo(() => renderSlot(header, CopilotModalHeader, {}), [header]);\n\n  const resolvedWidth = dimensionToCss(width, DEFAULT_POPUP_WIDTH);\n  const resolvedHeight = dimensionToCss(height, DEFAULT_POPUP_HEIGHT);\n\n  const popupStyle = useMemo(\n    () =>\n      ({\n        \"--copilot-popup-width\": resolvedWidth,\n        \"--copilot-popup-height\": resolvedHeight,\n        \"--copilot-popup-max-width\": \"calc(100vw - 3rem)\",\n        \"--copilot-popup-max-height\": \"calc(100dvh - 7.5rem)\",\n        paddingTop: \"env(safe-area-inset-top)\",\n        paddingBottom: \"env(safe-area-inset-bottom)\",\n        paddingLeft: \"env(safe-area-inset-left)\",\n        paddingRight: \"env(safe-area-inset-right)\",\n      }) as React.CSSProperties,\n    [resolvedHeight, resolvedWidth],\n  );\n\n  const popupAnimationClass =\n    isPopupOpen && !isAnimatingOut\n      ? \"pointer-events-auto translate-y-0 opacity-100 md:scale-100\"\n      : \"pointer-events-none translate-y-4 opacity-0 md:translate-y-5 md:scale-[0.95]\";\n\n  const popupContent = isRendered ? (\n    <div\n      className={cn(\n        \"fixed inset-0 z-[1200] flex max-w-full flex-col items-stretch\",\n        \"md:inset-auto md:bottom-24 md:right-6 md:items-end md:gap-4\",\n      )}\n    >\n      <div\n        ref={containerRef}\n        tabIndex={-1}\n        role=\"dialog\"\n        aria-label={labels.modalHeaderTitle}\n        data-copilot-popup\n        className={cn(\n          \"relative flex h-full w-full flex-col overflow-hidden bg-background text-foreground\",\n          \"origin-bottom focus:outline-none transform-gpu transition-transform transition-opacity duration-200 ease-out\",\n          \"md:transition-transform md:transition-opacity\",\n          \"rounded-none border border-border/0 shadow-none ring-0\",\n          \"md:h-[var(--copilot-popup-height)] md:w-[var(--copilot-popup-width)]\",\n          \"md:max-h-[var(--copilot-popup-max-height)] md:max-w-[var(--copilot-popup-max-width)]\",\n          \"md:origin-bottom-right md:rounded-2xl md:border-border md:shadow-xl md:ring-1 md:ring-border/40\",\n          popupAnimationClass,\n        )}\n        style={popupStyle}\n      >\n        {headerElement}\n        <div className=\"flex-1 overflow-hidden\" data-popup-chat>\n          <CopilotChatView\n            {...restProps}\n            className={cn(\"h-full min-h-0\", className)}\n          />\n        </div>\n      </div>\n    </div>\n  ) : null;\n\n  return (\n    <>\n      <CopilotChatToggleButton />\n      {popupContent}\n    </>\n  );\n}\n\nCopilotPopupView.displayName = \"CopilotPopupView\";\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace CopilotPopupView {\n  /**\n   * Popup-specific welcome screen layout:\n   * - Welcome message centered vertically\n   * - Suggestions just above input\n   * - Input fixed at the bottom\n   */\n  export const WelcomeScreen: React.FC<WelcomeScreenProps> = ({\n    welcomeMessage,\n    input,\n    suggestionView,\n    className,\n    children,\n    ...props\n  }) => {\n    // Render the welcomeMessage slot internally\n    const BoundWelcomeMessage = renderSlot(\n      welcomeMessage,\n      CopilotChatView.WelcomeMessage,\n      {}\n    );\n\n    if (children) {\n      return (\n        <>\n          {children({\n            welcomeMessage: BoundWelcomeMessage,\n            input,\n            suggestionView,\n            className,\n            ...props,\n          })}\n        </>\n      );\n    }\n\n    return (\n      <div\n        className={cn(\"h-full flex flex-col\", className)}\n        {...props}\n      >\n        {/* Welcome message - centered vertically */}\n        <div className=\"flex-1 flex flex-col items-center justify-center px-4\">\n          {BoundWelcomeMessage}\n        </div>\n\n        {/* Suggestions and input at bottom */}\n        <div className=\"px-6 pb-4\">\n          <div className=\"max-w-3xl mx-auto\">\n            {/* Suggestions above input */}\n            <div className=\"mb-4 flex justify-center\">\n              {suggestionView}\n            </div>\n            {input}\n          </div>\n        </div>\n      </div>\n    );\n  };\n}\n\nexport default CopilotPopupView;\n","import React, { useMemo } from \"react\";\n\nimport { CopilotChat, CopilotChatProps } from \"./CopilotChat\";\nimport CopilotChatView, { CopilotChatViewProps } from \"./CopilotChatView\";\nimport { CopilotSidebarView, CopilotSidebarViewProps } from \"./CopilotSidebarView\";\n\nexport type CopilotSidebarProps = Omit<CopilotChatProps, \"chatView\"> & {\n  header?: CopilotSidebarViewProps[\"header\"];\n  defaultOpen?: boolean;\n  width?: number | string;\n};\n\nexport function CopilotSidebar({ header, defaultOpen, width, ...chatProps }: CopilotSidebarProps) {\n  const SidebarViewOverride = useMemo(() => {\n    const Component: React.FC<CopilotChatViewProps> = (viewProps) => {\n      const { header: viewHeader, width: viewWidth, ...restProps } = viewProps as CopilotSidebarViewProps;\n\n      return (\n        <CopilotSidebarView\n          {...(restProps as CopilotSidebarViewProps)}\n          header={header ?? viewHeader}\n          width={width ?? viewWidth}\n        />\n      );\n    };\n\n    return Object.assign(Component, CopilotChatView);\n  }, [header, width]);\n\n  return (\n    <CopilotChat\n      welcomeScreen={CopilotSidebarView.WelcomeScreen}\n      {...chatProps}\n      chatView={SidebarViewOverride}\n      isModalDefaultOpen={defaultOpen}\n    />\n  );\n}\n\nCopilotSidebar.displayName = \"CopilotSidebar\";\n\nexport default CopilotSidebar;\n","import React, { useMemo } from \"react\";\n\nimport { CopilotChat, CopilotChatProps } from \"./CopilotChat\";\nimport CopilotChatView, { CopilotChatViewProps } from \"./CopilotChatView\";\nimport CopilotPopupView, { CopilotPopupViewProps } from \"./CopilotPopupView\";\n\nexport type CopilotPopupProps = Omit<CopilotChatProps, \"chatView\"> & {\n  header?: CopilotPopupViewProps[\"header\"];\n  defaultOpen?: boolean;\n  width?: CopilotPopupViewProps[\"width\"];\n  height?: CopilotPopupViewProps[\"height\"];\n  clickOutsideToClose?: CopilotPopupViewProps[\"clickOutsideToClose\"];\n};\n\nexport function CopilotPopup({\n  header,\n  defaultOpen,\n  width,\n  height,\n  clickOutsideToClose,\n  ...chatProps\n}: CopilotPopupProps) {\n  const PopupViewOverride = useMemo(() => {\n    const Component: React.FC<CopilotChatViewProps> = (viewProps) => {\n      const {\n        header: viewHeader,\n        width: viewWidth,\n        height: viewHeight,\n        clickOutsideToClose: viewClickOutsideToClose,\n        ...restProps\n      } = viewProps as CopilotPopupViewProps;\n\n      return (\n        <CopilotPopupView\n          {...(restProps as CopilotPopupViewProps)}\n          header={header ?? viewHeader}\n          width={width ?? viewWidth}\n          height={height ?? viewHeight}\n          clickOutsideToClose={clickOutsideToClose ?? viewClickOutsideToClose}\n        />\n      );\n    };\n\n    return Object.assign(Component, CopilotChatView);\n  }, [clickOutsideToClose, header, height, width]);\n\n  return (\n    <CopilotChat\n      welcomeScreen={CopilotPopupView.WelcomeScreen}\n      {...chatProps}\n      chatView={PopupViewOverride}\n      isModalDefaultOpen={defaultOpen}\n    />\n  );\n}\n\nCopilotPopup.displayName = \"CopilotPopup\";\n\nexport default CopilotPopup;\n","import React from \"react\";\nimport { z } from \"zod\";\nimport { ReactToolCallRenderer } from \"./react-tool-call-renderer\";\nimport { ToolCallStatus } from \"@copilotkitnext/core\";\n\n/**\n * Helper to define a type-safe tool call renderer entry.\n * - Accepts a single object whose keys match ReactToolCallRenderer's fields: { name, args, render, agentId? }.\n * - Derives `args` type from the provided Zod schema.\n * - Ensures the render function param type exactly matches ReactToolCallRenderer<T>[\"render\"]'s param.\n * - For wildcard tools (name: \"*\"), args is optional and defaults to z.any()\n */\ntype RenderProps<T> =\n  | {\n      name: string;\n      args: Partial<T>;\n      status: ToolCallStatus.InProgress;\n      result: undefined;\n    }\n  | {\n      name: string;\n      args: T;\n      status: ToolCallStatus.Executing;\n      result: undefined;\n    }\n  | {\n      name: string;\n      args: T;\n      status: ToolCallStatus.Complete;\n      result: string;\n    };\n\n// Overload for wildcard tools without args\nexport function defineToolCallRenderer(def: {\n  name: \"*\";\n  render: (props: RenderProps<any>) => React.ReactElement;\n  agentId?: string;\n}): ReactToolCallRenderer<any>;\n\n// Overload for regular tools with args\nexport function defineToolCallRenderer<S extends z.ZodTypeAny>(def: {\n  name: string;\n  args: S;\n  render: (props: RenderProps<z.infer<S>>) => React.ReactElement;\n  agentId?: string;\n}): ReactToolCallRenderer<z.infer<S>>;\n\n// Implementation\nexport function defineToolCallRenderer<S extends z.ZodTypeAny>(def: {\n  name: string;\n  args?: S;\n  render: (props: any) => React.ReactElement;\n  agentId?: string;\n}): ReactToolCallRenderer<any> {\n  // For wildcard tools, default to z.any() if no args provided\n  const argsSchema = def.name === \"*\" && !def.args ? z.any() : def.args;\n\n  return {\n    name: def.name,\n    args: argsSchema as any,\n    render: def.render as React.ComponentType<any>,\n    ...(def.agentId ? { agentId: def.agentId } : {}),\n  };\n}\n","import { defineToolCallRenderer } from \"../types/defineToolCallRenderer\";\nimport { useState } from \"react\";\n\nexport const WildcardToolCallRender = defineToolCallRenderer({\n  name: \"*\",\n  render: ({ args, result, name, status }) => {\n    const [isExpanded, setIsExpanded] = useState(false);\n\n    const statusString = String(status) as\n      | \"inProgress\"\n      | \"executing\"\n      | \"complete\";\n    const isActive =\n      statusString === \"inProgress\" || statusString === \"executing\";\n    const isComplete = statusString === \"complete\";\n    const statusStyles = isActive\n      ? \"bg-amber-100 text-amber-800 dark:bg-amber-500/15 dark:text-amber-400\"\n      : isComplete\n        ? \"bg-emerald-100 text-emerald-800 dark:bg-emerald-500/15 dark:text-emerald-400\"\n        : \"bg-zinc-100 text-zinc-800 dark:bg-zinc-700/40 dark:text-zinc-300\";\n\n    return (\n      <div className=\"mt-2 pb-2\">\n        <div className=\"rounded-xl border border-zinc-200/60 dark:border-zinc-800/60 bg-white/70 dark:bg-zinc-900/50 shadow-sm backdrop-blur p-4\">\n          <div\n            className=\"flex items-center justify-between gap-3 cursor-pointer\"\n            onClick={() => setIsExpanded(!isExpanded)}\n          >\n            <div className=\"flex items-center gap-2 min-w-0\">\n              <svg\n                className={`h-4 w-4 text-zinc-500 dark:text-zinc-400 transition-transform ${\n                  isExpanded ? \"rotate-90\" : \"\"\n                }`}\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={2}\n                stroke=\"currentColor\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M8.25 4.5l7.5 7.5-7.5 7.5\"\n                />\n              </svg>\n              <span className=\"inline-block h-2 w-2 rounded-full bg-blue-500\" />\n              <span className=\"truncate text-sm font-medium text-zinc-900 dark:text-zinc-100\">\n                {name}\n              </span>\n            </div>\n            <span\n              className={`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${statusStyles}`}\n            >\n              {String(status)}\n            </span>\n          </div>\n\n          {isExpanded && (\n            <div className=\"mt-3 grid gap-4\">\n              <div>\n                <div className=\"text-xs uppercase tracking-wide text-zinc-500 dark:text-zinc-400\">\n                  Arguments\n                </div>\n                <pre className=\"mt-2 max-h-64 overflow-auto rounded-md bg-zinc-50 dark:bg-zinc-800/60 p-3 text-xs leading-relaxed text-zinc-800 dark:text-zinc-200 whitespace-pre-wrap break-words\">\n                  {JSON.stringify(args ?? {}, null, 2)}\n                </pre>\n              </div>\n\n              {result !== undefined && (\n                <div>\n                  <div className=\"text-xs uppercase tracking-wide text-zinc-500 dark:text-zinc-400\">\n                    Result\n                  </div>\n                  <pre className=\"mt-2 max-h-64 overflow-auto rounded-md bg-zinc-50 dark:bg-zinc-800/60 p-3 text-xs leading-relaxed text-zinc-800 dark:text-zinc-200 whitespace-pre-wrap break-words\">\n                    {typeof result === \"string\"\n                      ? result\n                      : JSON.stringify(result, null, 2)}\n                  </pre>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  },\n});\n"],"mappings":"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","names":["useState","useRef","useEffect","forwardRef","useImperativeHandle","useCallback","useMemo","twMerge","jsx","jsx","jsx","jsxs","jsx","jsx","jsx","jsx","jsxs","useState","twMerge","jsx","React","MemoizedSlotWrapper","jsx","jsxs","useState","useEffect","useRef","useMemo","useCallback","value","twMerge","CopilotChatInput","forwardRef","TextArea","useImperativeHandle","useState","Check","twMerge","React","useCallback","useMemo","createContext","useContext","useMemo","useEffect","useRef","useState","z","React","jsx","useEffect","useRef","useState","useCallback","jsx","jsxs","MCPAppsActivityRenderer","jsx","jsxs","createContext","useMemo","useRef","useEffect","useState","z","copilotkit","useContext","DEFAULT_AGENT_ID","jsx","React","ToolCallRenderer","useMemo","useCallback","jsx","DEFAULT_AGENT_ID","useCallback","useMemo","jsx","DEFAULT_AGENT_ID","useEffect","useEffect","useCallback","useRef","useEffect","React","useRef","useCallback","React","useEffect","useMemo","useEffect","useReducer","DEFAULT_AGENT_ID","UseAgentUpdate","useEffect","useMemo","useCallback","useEffect","useMemo","useState","DEFAULT_AGENT_ID","useMemo","useState","useEffect","suggestions","useCallback","useCallback","useEffect","useMemo","useRef","DEFAULT_AGENT_ID","useMemo","useRef","useCallback","useEffect","React","Fragment","jsx","Fragment","jsx","jsxs","twMerge","CopilotChatAssistantMessage","useState","Check","useMemo","useState","Copy","Check","twMerge","Fragment","jsx","jsxs","useMemo","twMerge","CopilotChatUserMessage","useState","Check","Copy","React","Loader2","jsx","jsxs","React","CopilotChatSuggestionPill","Loader2","React","Fragment","jsx","jsxs","React","DefaultContainer","CopilotChatSuggestionView","React","useEffect","useReducer","twMerge","jsx","jsxs","React","MemoizedAssistantMessage","MemoizedUserMessage","MemoizedActivityMessage","MemoizedCustomMessage","useReducer","useEffect","twMerge","React","useRef","useState","useEffect","twMerge","useState","useEffect","Fragment","jsx","jsxs","useRef","useState","useEffect","twMerge","CopilotChatView","React","DEFAULT_AGENT_ID","randomUUID","TranscriptionErrorCode","useCallback","useEffect","useMemo","useState","jsx","jsxs","DEFAULT_AGENT_ID","useMemo","randomUUID","useState","useEffect","agent","useCallback","TranscriptionErrorCode","CopilotChat","React","useState","X","jsx","jsxs","X","React","CopilotChatToggleButton","useState","useEffect","useRef","useState","useCallback","X","jsx","jsxs","useCallback","CopilotModalHeader","Fragment","jsx","jsxs","useRef","useState","useEffect","CopilotSidebarView","useEffect","useMemo","useRef","useState","Fragment","jsx","jsxs","useRef","useState","useEffect","useMemo","CopilotPopupView","useMemo","jsx","useMemo","useMemo","jsx","useMemo","z","useState","jsx","jsxs"]}